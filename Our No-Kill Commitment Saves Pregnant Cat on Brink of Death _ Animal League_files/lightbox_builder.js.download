function getCurrentPage(){return CURRENT_PAGE}function getPageAnswers(){return PageAnswers}function setPageAnswers(e){PageAnswers=e}function getPageViewSequence(){return PageViewSequence}function setPageViewSequence(){}function getSettings(){return settings}function logger(e){DAPI.log(e,"JS_BOXES_INTERNAL")}function clearFormData(){try{LBOX.hasOwnProperty("SINGLE_PAGE_FORM_DATA")&&LBOX.SINGLE_PAGE_FORM_DATA&&LBOX.SINGLE_PAGE_FORM_DATA.hasOwnProperty(LIGHTBOX_SHORT_ID.toString())&&delete LBOX.SINGLE_PAGE_FORM_DATA[LIGHTBOX_SHORT_ID.toString()]}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"clearFormData")}}function resetBox(){for(var e=0;e<PageViewSequence.length;e++)removePageFromPageAnswers(PageViewSequence[e]),deselectButtonsOnPage(PageViewSequence[e]),clearFieldsSetByPage(PageViewSequence[e]);localStorage.removeItem("prq_results"),SELECTED_BUTTON_FORM_VALUES={},PageAnswers=[],PageViewSequence=[""]}function resetPage(e,t=!0){t&&(removePageFromPageAnswers(e),deselectButtonsOnPage(e),clearFieldsSetByPage(e),clearButtonValuesSetByPage(e)),removeFocusFromButtonsOnPage(e),resetPRQOrginalMergeTags(e)}function checkJqLoaded(){onJqLoaded()}function onScriptsLoaded(){IS_SCRIPTS_LOADED=!0,tryInitScripts()}function onJqLoaded(){"undefined"==typeof LIGHTBOX_GUID?window.setTimeout(onJqLoaded,100):onVarsLoaded()}function checkDocumentReadyState(){try{"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?afterDomLoaded():setTimeout(checkDocumentReadyState,250)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"checkDocumentReadyState")}}function afterDomLoaded(){try{if(!AfterDomLoadedHasRun){AfterDomLoadedHasRun=!0,$("html").attr("lang","en"),body=$("body"),$("head").append(ie9),$("head").append(pgStyle),body.append(bodInsert),modal_loading=$("#modal_loading"),error_bubble=$("#error_bubble"),error_message=$("#error_message"),success_bubble=$("#success_bubble"),success_message=$("#success_message"),warning_bubble=$("#warning_bubble"),warning_message=$("#warning_message"),$("#error_close, #success_close, #warning_close").on(IS_MOBILE?"click":"mousedown",(function(e){let t=$(e.currentTarget),r=error_bubble,s=wasErrorBubbleAlreadyClosed,n=error_message;"success_close"==t.attr("id")&&(r=success_bubble,s=wasSuccessBubbleAlreadyClosed,n=success_message),"warning_close"==t.attr("id")&&(r=warning_bubble,s=wasWarningBubbleAlreadyClosed,n=warning_message),r.hide(),s||(s=!0,r===error_bubble&&$(document).trigger("BOX_CLOSE_ERROR",["","",""]),n.removeAttr("role"))}));try{LBOX.JQUERY_DIGIOH(top).keyup((function(e){27==(e.keyCode?e.keyCode:e.which)&&WIDGET_TYPE&&"inline"!==WIDGET_TYPE&&postMessageCloseBox("button_click")}))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e))}$(window).keyup((function(e){var t,r,s=e.keyCode?e.keyCode:e.which;27==s&&WIDGET_TYPE&&"inline"!==WIDGET_TYPE&&postMessageCloseBox("button_click"),13==s&&("main"==(t=CURRENT_PAGE)&&(t=""),r=!1,$("#"+t+"layout .button_focus_tab_submit").each((function(){var e,s;r||(r=!0,e=t,t&&t.length>1&&-1===t.indexOf("_")&&(e=t+"_"),(s=$(this).attr("id")).indexOf("button")>=0&&settings.hasOwnProperty(s)&&(setButtonMetaDataLayer(settings[s]),addButtonToPageAnswers(t,s)),s.indexOf("button")>=0&&settings.hasOwnProperty(s)&&settings[s].hasOwnProperty("override_form_submit_action")&&settings[s].override_form_submit_action?processSubmitObj({pageName:e,overrideFormSubmitAction:settings[s].override_form_submit_action}):processSubmit(e,!1,!1,!0))})),$("#"+t+"layout .button_focus_tab_close").each((function(){r||(r=!0,postMessageCloseBox("button_click"))})),$("#"+t+"layout .button_focus_tab_redirect").each((function(){var e,t;r||(r=!0,(e=$(this).attr("id"))&&settings.hasOwnProperty(e)&&((t=settings[e]).url&&(0!==t.url.toLowerCase().trim().indexOf("http")&&0!==t.url.toLowerCase().trim().indexOf("mailto")&&(t.url="http://"+t.url),t.hasOwnProperty("redirect_type")&&t.redirect_type||(t.redirect_type="current"),postMessageRedirectParent(t,"button"))))})),$("#"+t+"layout .button_focus_tab_lightbox_open").each((function(){var e,t;r||(r=!0,(e=$(this).attr("id"))&&settings.hasOwnProperty(e)&&((t=settings[e]).lightbox_open&&t.lightbox_open.length>0&&postMessageOpenAnotherBox(t,"button")))})),$("#"+t+"layout .button_focus_tab_change_pages").each((function(){var e,s;r||(r=!0,e=$(this).attr("id"),addButtonToPageAnswers(t,e),e&&settings.hasOwnProperty(e)&&("main_page"==(s=settings[e]).action?changePages("",e,s,"button"):"thank_you_page"==s.action?changePages("thx_",e,s,"button"):0==s.action.indexOf("extra_page_")&&changePages("ep"+s.action.replace("extra_page_","")+"_",e,s,"button")))})))})),tryApplySettings()}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"afterDomLoaded")}}function onVarsLoaded(){DIGIOH_CACHE_VERSION=CACHE_VERSION,LIGHTBOX_OR_VARIATION_GUID=IS_VARIATION?VARIATION_GUID:LIGHTBOX_GUID,STANDARD_OBJ.protocol=PROTOCOL,STANDARD_OBJ.protocol_user_override=PROTOCOL_USER_OVERRIDE,STANDARD_OBJ.widget_type=WIDGET_TYPE,STANDARD_OBJ.cache_version=CACHE_VERSION,STANDARD_OBJ.parent_url=PARENT_URL,STANDARD_OBJ.full_url=FULL_URL||"",STANDARD_OBJ.use_bugsnag=DIGIOH_USE_BUGSNAG,STANDARD_OBJ.use_prq=DIGIOH_PRQ.USE,STANDARD_OBJ.use_console=SHOW_ERRORS,STANDARD_OBJ.is_preview=IS_PREVIEW,STANDARD_OBJ.is_responsive=DIGIOH_USE_RESPONSIVE,STANDARD_OBJ.is_variation=IS_VARIATION,STANDARD_OBJ.user_id=VENDOR_GUID,STANDARD_OBJ.user_guid=VENDOR_GUID,STANDARD_OBJ.user_short_id=VENDOR_SHORT_ID,STANDARD_OBJ.vendor_id=VENDOR_GUID,STANDARD_OBJ.vendor_guid=VENDOR_GUID,STANDARD_OBJ.vendor_short_id=VENDOR_SHORT_ID,STANDARD_OBJ.client_id=CLIENT_GUID,STANDARD_OBJ.client_guid=CLIENT_GUID,STANDARD_OBJ.lightbox_id=LIGHTBOX_GUID,STANDARD_OBJ.lightbox_guid=LIGHTBOX_GUID,STANDARD_OBJ.lightbox_short_id=LIGHTBOX_SHORT_ID,STANDARD_OBJ.lightbox_name=LIGHTBOX_NAME,STANDARD_OBJ.variation_id=VARIATION_GUID,STANDARD_OBJ.variation_guid=VARIATION_GUID,STANDARD_OBJ.variation_short_id=VARIATION_SHORT_ID,STANDARD_OBJ.variation_name=VARIATION_NAME,STANDARD_OBJ.ab_test_id=AB_TEST_GUID,STANDARD_OBJ.ab_test_guid=AB_TEST_GUID,STANDARD_OBJ.ab_test_short_id=AB_TEST_SHORT_ID,STANDARD_OBJ.ab_test_name=AB_TEST_NAME,STANDARD_OBJ.lightbox_or_variation_id=LIGHTBOX_OR_VARIATION_GUID,STANDARD_OBJ.lightbox_or_variation_guid=LIGHTBOX_OR_VARIATION_GUID,STANDARD_OBJ.lightbox_or_variation_short_id=IS_VARIATION?VARIATION_SHORT_ID:LIGHTBOX_SHORT_ID,STANDARD_OBJ.lightbox_or_variation_name=IS_VARIATION?VARIATION_NAME:LIGHTBOX_NAME,STANDARD_OBJ.is_desktop=IS_DESKTOP,STANDARD_OBJ.is_phone=IS_PHONE,STANDARD_OBJ.is_tablet=IS_TABLET,STANDARD_OBJ.is_mobile=IS_MOBILE,registerParentToBoxComm();var e=BOX_CUSTOM_JS.runCustomJsBeforeDOMReady();"boolean"==typeof e&&!1===e?sendMessageToParent({sender:"lightbox",parent_action:"terminate_lightbox",lightbox_id:LIGHTBOX_OR_VARIATION_GUID}):(onScriptsLoaded(),$(document).ready((function(){afterDomLoaded()})),checkDocumentReadyState())}function getEffectsProp(e){try{var t=e.split("."),r="",s=DAPI.GET_EFFECTS(LIGHTBOX_OR_VARIATION_GUID);return null==s||null==s?"":(8==t.length?r=s[t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]]:7==t.length?r=s[t[1]][t[2]][t[3]][t[4]][t[5]][t[6]]:6==t.length?r=s[t[1]][t[2]][t[3]][t[4]][t[5]]:5==t.length?r=s[t[1]][t[2]][t[3]][t[4]]:4==t.length?r=s[t[1]][t[2]][t[3]]:3==t.length?r=s[t[1]][t[2]]:2==t.length&&(r=s[t[1]]),null==r||null==r?"":r)}catch(e){return""}}function existsEffectsProp(e){try{var t=e.split("."),r="",s=DAPI.GET_EFFECTS(LIGHTBOX_OR_VARIATION_GUID);return null==s||null==s?"":(8==t.length?r=s[t[1]][t[2]][t[3]][t[4]][t[5]][t[6]].hasOwnProperty(t[7]):7==t.length?r=s[t[1]][t[2]][t[3]][t[4]][t[5]].hasOwnProperty(t[6]):6==t.length?r=s[t[1]][t[2]][t[3]][t[4]].hasOwnProperty(t[5]):5==t.length?r=s[t[1]][t[2]][t[3]].hasOwnProperty(t[4]):4==t.length?r=s[t[1]][t[2]].hasOwnProperty(t[3]):3==t.length?r=s[t[1]].hasOwnProperty(t[2]):2==t.length&&(r=s.hasOwnProperty(t[1])),r)}catch(t){return BOX_CUSTOM_JS.logError(t,"existsEffectsProp("+e+")"),!1}}function registerParentToBoxComm(){try{if(DAPI)return DAPI.hasOwnProperty("BOXCOMM")||(DAPI.BOXCOMM={}),DAPI.BOXCOMM.hasOwnProperty(LIGHTBOX_SHORT_ID.toString())||(DAPI.BOXCOMM[LIGHTBOX_SHORT_ID.toString()]={hasAfterDomReadyJsFinished:hasAfterDomReadyJsFinished,applyBreakpoint:function(e){onPixelVersionChange(e.page),onResponsiveDimensionChange(e)},runCustomJsBeforeDisplay:function(){return BOX_CUSTOM_JS.runCustomJsBeforeDisplay()}}),!0;setTimeout(registerParentToBoxComm,50)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"registerParentToBoxComm")}}function onResponsiveDimensionChange(e){var t,r,s,n,i,o,a,l,_,g,p,u,m,d,h,c,f,O;try{if(IS_SETTINGS_LOADED&&IS_SCRIPTS_LOADED){if(t=e.width,r=e.height,CURRENT_WIDTH=t,CURRENT_HEIGHT=r,s="",CURRENT_PAGE&&"main"!==CURRENT_PAGE&&(s=CURRENT_PAGE),!settings.hasOwnProperty(s+"responsive")||!settings[s+"responsive"].use)return;n=700,i=500,settings.hasOwnProperty(s+"layout")&&settings[s+"layout"].hasOwnProperty("width")&&settings[s+"layout"].hasOwnProperty("height")?(n=settings[s+"layout"].width,i=settings[s+"layout"].height):(n=settings.layout.width,i=settings.layout.height),o=e.width,a=e.height,DIGIOH_USE_RESPONSIVE?(o>settings[s+"responsive"].width_max?o=settings[s+"responsive"].width_max:o<settings[s+"responsive"].width_min&&(o=settings[s+"responsive"].width_min),a>settings[s+"responsive"].height_max?a=settings[s+"responsive"].height_max:a<settings[s+"responsive"].height_min&&(a=settings[s+"responsive"].height_min)):(o=e.width,a=i),"none"===settings[s+"layout"].border.style||"0"===settings[s+"layout"].border.width||0===settings[s+"layout"].border.width||(o-=2*settings[s+"layout"].border.width,a-=2*settings[s+"layout"].border.width);var y=o-n,b=a-i;for($("#"+s+"layout").width(o),$("#"+s+"layout").height(a),l=settings[s+"responsive"].include_filter||"",_=settings[s+"responsive"].exclude_filter||"",DIGIOH_USE_RESPONSIVE||(l="",_=""),g=0;g<=4;g++)for(p="",0===g&&(p="html"),1===g&&(p="text"),2===g&&(p="button"),3===g&&(p="image"),4===g&&(p="form"),u=1;u<=50;u++){if(m=u,d=s+"responsive","form"===p){if(u<50)continue;m="",""!==s&&(s+="_")}if(!DIGIOH_USE_RESPONSIVE&&settings.hasOwnProperty(s+p+m)&&settings[s+p+m].display){var w=settings[s+p+m].width,P=settings[s+p+m].height,x=settings[s+p+m].x,S=settings[s+p+m].y,I=P,R=getNewElementLeft(d,x,w,oe=w,n,o),T=getNewElementTop(d,S,P,I,i,a),v=oe-w,A=I-P;$("#"+s+p+m+"_wrapper").css({left:R+"px",top:T+"px",width:oe+"px",height:I+"px"})}else if(DIGIOH_USE_RESPONSIVE&&settings.hasOwnProperty(s+p+m)&&settings[s+p+m].display&&-1===_.indexOf(p+m)&&(settings[d]["use_"+p]||l.indexOf(p+m)>=0)){var D=settings[d].content_width,E=settings[d].content_height,C=settings[d].content_font,L=C,k=C,B=0,M=0,U=0,G=0,N=0,H=0,F=0,J=0,j=0,X=1e4,Q=1e4,q=1e4,V=1e4,z=1e4,W=1e4,Y=1e4;if(l.indexOf(p+m)>=0)for(h=l.split(/\r?\n/),c=0;c<h.length;c++)if(h[c].indexOf("|")>0&&h[c].indexOf(":")>0){var K=h[c].split("|"),Z="",ee="",te="",re="";K.length>0&&(Z=K[0]),K.length>1&&(ee=K[1]),K.length>2&&(te=K[2]),K.length>3&&(re=K[3]);var se=ee.split(":"),ne=te.split(":"),ie=re.split(":");Z.trim()===p+m?(3===se.length&&(D=parseInt(se[0].trim()),U=parseInt(se[1].trim()),X=parseInt(se[2].trim())),3===ne.length&&(E=parseInt(ne[0].trim()),G=parseInt(ne[1].trim()),Q=parseInt(ne[2].trim())),3===ie.length&&(C=parseInt(ie[0].trim()),N=parseInt(ie[1].trim()),q=parseInt(ie[2].trim()))):"labels"===Z.trim()?3===ie.length&&(L=parseInt(ie[0].trim()),H=parseInt(ie[1].trim()),V=parseInt(ie[2].trim())):"inputs"===Z.trim()?3===ie.length&&(k=parseInt(ie[0].trim()),F=parseInt(ie[1].trim()),z=parseInt(ie[2].trim())):"opt_in"===Z.trim()?3===ie.length&&(B=parseInt(ie[0].trim()),J=parseInt(ie[1].trim()),W=parseInt(ie[2].trim())):"help_text"===Z.trim()&&3===ie.length&&(M=parseInt(ie[0].trim()),j=parseInt(ie[1].trim()),Y=parseInt(ie[2].trim()))}w=settings[s+p+m].width,P=settings[s+p+m].height,x=settings[s+p+m].x,S=settings[s+p+m].y;var oe=Math.round(w+y*D/100);I=Math.round(P+b*E/100);oe<U&&(oe=U),oe>X&&(oe=X),I<G&&(I=G),I>Q&&(I=Q);R=getNewElementLeft(d,x,w,oe,n,o),T=getNewElementTop(d,S,P,I,i,a),v=oe-w,A=I-P;if($("#"+s+p+m+"_wrapper").css({left:R+"px",top:T+"px",width:oe+"px",height:I+"px"}),"form"===p){if(-1===_.indexOf("labels")){var ae=v/5*(L/100),le=parseInt(settings[s+"labels"].font.size),_e=Math.round(le+ae);_e<H&&(_e=H),_e>V&&(_e=V),$("."+s+"form_labels").css({"font-size":_e+"px"})}if(-1===_.indexOf("inputs")){var ge=v/5*(k/100),pe=parseInt(settings[s+"inputs"].font.size),ue=Math.round(pe+ge);ue<F&&(ue=F),ue>z&&(ue=z),$("."+s+"form_inputs").css({"font-size":ue+"px"})}if(settings.hasOwnProperty(s+"opt_in")&&settings[s+"opt_in"].display&&-1===_.indexOf("opt_in")&&B>0){var me=v/5*(B/100),de=parseInt(settings[s+"opt_in"].font.size),he=Math.round(de+me);he<J&&(he=J),he>W&&(he=W),$("#"+s+"form_input_opt_in_text").css({"font-size":he+"px"})}if(-1===_.indexOf("help_text")&&M>0){var ce=v/5*(M/100),fe=Math.round(11+ce);fe<j&&(fe=j),fe>Y&&(fe=Y),$("."+s+"form_inputs_help").css({"font-size":fe+"px"})}f=A/P,O=Math.round(parseInt(settings[s+"inputs"].height)*(1+f)),"left"==settings[s+"labels"].position&&($("."+s+"form_labels").height(O),$("."+s+"form_labels").css({"line-height":O+"px"})),$("."+s+"form_inputs").height(O)}else if("text"===p||"button"===p){var Oe=v/5*(C/100),ye=parseInt(settings[s+p+m].font.size),be=Math.round(ye+Oe);be<N&&(be=N),be>q&&(be=q),$("#"+s+p+m).css({"font-size":be+"px"})}}}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"onResponsiveDimensionChange")}}function getNewElementLeft(e,t,r,s,n,i){var o,a,l=settings[e].content_alignment_x||"center",_=t;return"left"===l?_=t:"center"===l?(o=i-n,a=s-r,_=Math.round(t+.5*o-.5*a)):"right"===l&&(_=i-(n-r-t)-s),_}function getNewElementTop(e,t,r,s,n,i){var o,a,l=settings[e].content_alignment_y||"top",_=t;return"top"===l?_=t:"center"===l?(o=i-n,a=s-r,_=Math.round(t+.5*o-.5*a)):"bottom"===l&&(_=i-(n-r-t)-s),_}function sendMessageToParent(e){try{LBOX.receiveMessageFromIframe(e,LIGHTBOX_OR_VARIATION_GUID)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"sendMessageToParent")}}function receiveMessageFromParent(e){var t,r;e&&e.hasOwnProperty("message")&&logger("(BOX #"+LIGHTBOX_SHORT_ID+") - receiveMessageFromParent: "+e.message),e&&e.hasOwnProperty("sender")&&"lightbox"===e.sender&&e.hasOwnProperty("action")&&("dimensions_changed"===e.action?onResponsiveDimensionChange(e):"pixel_version_changed"===e.action?(t="",e.hasOwnProperty("page")&&(t=e.page),onPixelVersionChange(t)):"before_lightbox_display"===e.action||("after_lightbox_display"===e.action?(e.auto_focus&&($("#form_input_first_name").length?$("#form_input_first_name").focus():$("#form_input_full_name").length?$("#form_input_full_name").focus():$("#form_input_email").length&&$("#form_input_email").focus()),runCustomJsAfterDisplayRetry()):"after_lightbox_submit_success"===e.action?(r=postSubmissionResolution.pop())&&"function"==typeof r.resolve&&r.resolve(!0):"after_lightbox_submit_failure"===e.action?(r=postSubmissionResolution.pop())&&"function"==typeof r.reject&&postSubmissionResolution.reject("submission to keen server error"):"before_lightbox_close"===e.action?BOX_CUSTOM_JS.runCustomJsBeforeClose():"after_lightbox_close"===e.action&&BOX_CUSTOM_JS.runCustomJsAfterClose()))}function runCustomJsAfterDisplayRetry(){hasAfterDomReadyJsFinished?(BOX_CUSTOM_JS.runCustomJsAfterDisplay(),DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()&&DIGIOH_PRQ.tryShowPreservedResultsPage()):setTimeout(runCustomJsAfterDisplayRetry,50)}function runCustomJsLinkedApps(e){var t,r,s;if(null!=CJSAPPS_BOXES&&null!=CJSAPPS_ARR&&CJSAPPS_ARR.length>0){for(t=0;t<CJSAPPS_ARR.length;t++)if(r=CJSAPPS_ARR[t],CJSAPPS_BOXES.hasOwnProperty(r)&&CJSAPPS_BOXES[r].hasOwnProperty(e)&&(!1,s="Before DOM Ready"==e?CJSAPPS_BOXES[r][e](DAPI,STANDARD_OBJ):CJSAPPS_BOXES[r][e](DAPI,STANDARD_OBJ,x),logger("CJSAPPS_BOXES: "+r+", "+e),logger(s),!1===s))return!1;return!0}}function sendMessageToIframe(e,t){LBOX.relayMessageToIframe(e,LIGHTBOX_OR_VARIATION_GUID,t)}function receiveMessageFromIframe(e){e&&e.hasOwnProperty("message")&&logger("(BOX #"+LIGHTBOX_SHORT_ID+") -"+e.message)}function onPixelVersionChange(e){tryInitScripts(),clearSettings(),applySettings(!1,e,!0)}function tryInitScripts(){LBOX.PixelThresholdSettings&&LBOX.PixelThresholdSettings.hasOwnProperty(LIGHTBOX_OR_VARIATION_GUID)&&"object"==typeof LBOX.PixelThresholdSettings[LIGHTBOX_OR_VARIATION_GUID]?(settings=LBOX.PixelThresholdSettings[LIGHTBOX_OR_VARIATION_GUID],IS_SETTINGS_LOADED=!0):DAPI.DIGIOH_LIGHTBOX_SETTINGS&&DAPI.DIGIOH_LIGHTBOX_SETTINGS.hasOwnProperty(LIGHTBOX_OR_VARIATION_GUID)&&LBOX.LZString?("object"==typeof DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID]&&null!==DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID]?settings=DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID]:"string"==typeof DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID]&&DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID].length>50&&DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID].indexOf("{")<0?settings=JSON.parse(LBOX.LZString.decompressFromBase64(DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID])):"string"==typeof DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID]&&DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID].length>50&&DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID].indexOf("{")>=0&&(settings=JSON.parse(DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID])),IS_SETTINGS_LOADED=!0):setTimeout(tryInitScripts,200)}function tryApplySettings(){IS_SETTINGS_LOADED&&IS_SCRIPTS_LOADED?applySettings(!0,""):setTimeout(tryApplySettings,100)}function clearSettings(){if($("#layout").length&&$("#layout").empty(),$("#thxlayout").length&&$("#thxlayout").empty(),$("#ep1layout").length&&$("#ep1layout").empty(),$("#ep2layout").length&&$("#ep2layout").empty(),$("#ep3layout").length&&$("#ep3layout").empty(),$("#ep4layout").length&&$("#ep4layout").empty(),settings.hasOwnProperty("extra_pages")&&settings.extra_pages)for(var e=1;e<=settings.extra_pages.length;e++)settings.extra_pages[e-1]&&1==settings.extra_pages[e-1].on&&$("#ep"+e+"layout").length&&$("#ep"+e+"layout").empty()}function getFormMergeTagsFromString(e){var t,r,s;try{if(t=[],(r=e.split("[FORM_")).length>1)for(s=1;s<r.length;s++)UTIL.stringOrArrayContains(r[s],"]")&&t.push("[FORM_"+r[s].split("]")[0]+"]");return t}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"getFormMergeTagsFromString")}return[]}function getFormMergeTagReplacementValue(e){var t,r;try{var s=LBOX.DIGIOH_LOCAL_STORAGE.getManual("fsdbx"),n="",i="";if((e=e.replace("[","").replace("]","")).indexOf("{BOXID}")>0&&(e=e.split("{BOXID}").join(LIGHTBOX_SHORT_ID.toString())),e.indexOf("_{FALLBACK}")>0&&(e=e.split("_{FALLBACK}").join("")),(t=e.split("_")).length>=3){if("object"==typeof s&&null!==s&&"GLOBAL"===t[1]?n="FIRST"===t[2]&&t.length>3&&"NAME"===t[3]?s.hasOwnProperty("first_name")?s.first_name:"":"LAST"===t[2]&&t.length>3&&"NAME"===t[3]?s.hasOwnProperty("last_name")?s.last_name:"":"OPT"===t[2]&&t.length>3&&"IN"===t[3]?s.hasOwnProperty("opt_in")?s.opt_in:"":"CUSTOM"===t[2]&&t.length>3?s.hasOwnProperty("custom_"+t[3])?s["custom_"+t[3]]:"":s.hasOwnProperty(t[2].toLowerCase())?s[t[2].toLowerCase()]:"":"object"==typeof s&&null!==s&&s.hasOwnProperty(t[1])&&"object"==typeof s[t[1]]&&null!==s[t[1]]&&(n="FIRST"===t[2]&&t.length>3&&"NAME"===t[3]?s[t[1]].hasOwnProperty("first_name")?s[t[1]].first_name:"":"LAST"===t[2]&&t.length>3&&"NAME"===t[3]?s[t[1]].hasOwnProperty("last_name")?s[t[1]].last_name:"":"OPT"===t[2]&&t.length>3&&"IN"===t[3]?s[t[1]].hasOwnProperty("opt_in")?s[t[1]].opt_in:"":"CUSTOM"===t[2]&&t.length>3?s[t[1]].hasOwnProperty("custom_"+t[3])?s[t[1]]["custom_"+t[3]]:"":s[t[1]].hasOwnProperty(t[2].toLowerCase())?s[t[1]][t[2].toLowerCase()]:""),t.length>4&&(e.indexOf("_FIRST_NAME")>0||e.indexOf("_LAST_NAME")>0||e.indexOf("_OPT_IN")>0||e.indexOf("_CUSTOM_")>0))for(r=4;r<t.length;r++)i+=t[r]+"_";else if(t.length>3&&(e.indexOf("_EMAIL")>0||e.indexOf("_PHONE")>0||e.indexOf("_NAME")>0)&&-1===e.indexOf("_FIRST_NAME")&&-1===e.indexOf("_LAST_NAME"))for(r=3;r<t.length;r++)i+=t[r]+"_";return i.length>0&&(i=i.substr(0,i.length-1)),[n,i]}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"getFormMergeTagReplacementValue")}return[]}function replaceSettingsObjFormMergeTags(e,t){var r,s,n,i,o,a,l,_;try{for(r=Object.keys(e),s=0;s<r.length;s++)if("object"==typeof e[r[s]]&&(""===t&&0!==r[s].indexOf("thx")&&0!==r[s].indexOf("ep")||""!==t&&0===r[s].indexOf(t)))replaceSettingsObjFormMergeTags(e[r[s]],t);else if("string"==typeof e[r[s]]&&e[r[s]].indexOf("[FORM_")>=0&&(""===t&&0!==r[s].indexOf("thx")&&0!==r[s].indexOf("ep")||""!==t&&0===r[s].indexOf(t)))for(n=getFormMergeTagsFromString(e[r[s]]),i=0;i<n.length;i++)2===(a=getFormMergeTagReplacementValue(o=n[i])).length&&(l=a[0],_=a[1],e[r[s]]=""!==l?e[r[s]].split(o).join(l):""!==_?e[r[s]].split(o).join(_):e[r[s]].split(o).join(""))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceSettingsObjFormMergeTags")}}function replaceSettingsObjFormMergeTagsAfterChangePages(e){try{$("#"+e+'layout div:contains("[FORM_"), #'+e+'layout span:contains("[FORM_"), #'+e+'layout p:contains("[FORM_"),#'+e+'layout button:contains("[FORM_")').each((function(){var e,t,r,s,n;if($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length||$(this).children().length<2&&0===$(this).find("a").length&&0===$(this).find("button").length&&$(this).find("*").length<2)for(e=getFormMergeTagsFromString($(this).html()),t=0;t<e.length;t++)2===(r=getFormMergeTagReplacementValue(e[t])).length&&(s=r[0],n=r[1],""!==s?$(this).html($(this).html().split(e[t]).join(s)):""!==n?$(this).html($(this).html().split(e[t]).join(n)):$(this).html($(this).html().split(e[t]).join("")))})),$("#"+e+"layout img").each((function(){var e,t,r,s,n;if($(this).attr("src")&&UTIL.stringOrArrayContains($(this).attr("src"),"[FORM_"))for(e=getFormMergeTagsFromString($(this).attr("src")),t=0;t<e.length;t++)2===(r=getFormMergeTagReplacementValue(e[t])).length&&(s=r[0],n=r[1],""!==s?$(this).attr("src",$(this).attr("src").split(e[t]).join(s)):""!==n?$(this).attr("src",$(this).attr("src").split(e[t]).join(n)):$(this).attr("src",$(this).attr("src").split(e[t]).join("")))})),$("#"+e+"layout input, #"+e+"layout textarea,#"+e+"layout select option").each((function(){var e,t,r,s,n;if($(this).val()&&UTIL.stringOrArrayContains($(this).val(),"[FORM_"))for(e=getFormMergeTagsFromString($(this).val()),t=0;t<e.length;t++)2===(r=getFormMergeTagReplacementValue(e[t])).length&&(s=r[0],n=r[1],""!==s?$(this).val($(this).val().split(e[t]).join(s)):""!==n?$(this).val($(this).val().split(e[t]).join(n)):$(this).val($(this).val().split(e[t]).join("")));if("string"==typeof $(this).attr("placeholder")&&UTIL.stringOrArrayContains($(this).attr("placeholder"),"[FORM_"))for(e=getFormMergeTagsFromString($(this).attr("placeholder")),t=0;t<e.length;t++)2===(r=getFormMergeTagReplacementValue(e[t])).length&&(s=r[0],n=r[1],""!==s?$(this).attr("placeholder",$(this).attr("placeholder").split(e[t]).join(s)):""!==n?$(this).attr("placeholder",$(this).attr("placeholder").split(e[t]).join(n)):$(this).attr("placeholder",$(this).attr("placeholder").split(e[t]).join("")));if("string"==typeof $(this).text()&&UTIL.stringOrArrayContains($(this).text(),"[FORM_"))for(e=getFormMergeTagsFromString($(this).text()),t=0;t<e.length;t++)2===(r=getFormMergeTagReplacementValue(e[t])).length&&(s=r[0],n=r[1],""!==s?$(this).text($(this).text().split(e[t]).join(s)):""!==n?$(this).text($(this).text().split(e[t]).join(n)):$(this).text($(this).text().split(e[t]).join("")))})),replaceSettingsObjFormMergeTags(settings,e)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceSettingsObjFormMergeTagsAfterChangePages")}}function applySettings(e,t,r){var s,n,i,o,a,l,_,g;try{if("string"==typeof settings&&settings.length>50&&settings.indexOf("{")<0&&(settings=JSON.parse(LBOX.LZString.decompressFromBase64(settings))),e)for(s=1;s<=customFieldsLimit;s++)if(form_input_obj["pref_form_input_custom"+s]=!1,form_input_obj["form_input_custom"+s]=!1,form_input_obj["thx_form_input_custom"+s]=!1,form_input_obj["ep1_form_input_custom"+s]=!1,form_input_obj["ep2_form_input_custom"+s]=!1,form_input_obj["ep3_form_input_custom"+s]=!1,form_input_obj["ep4_form_input_custom"+s]=!1,settings.hasOwnProperty("extra_pages")&&settings.extra_pages)for(n=5;n<=settings.extra_pages.length;n++)settings.extra_pages[n-1]&&1===settings.extra_pages[n-1].on&&(form_input_obj["ep"+n+"_form_input_custom"+s]=!1);for(i=1,o=1;o<=102;o++){if(a="",1===o)a="";else if(2===o)a="thx";else if(o>=3&&o<=6)a="ep"+(o-2);else if(o>=7){if(!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=o-3||!settings.extra_pages[o-3]||1!==settings.extra_pages[o-3].on)continue;a="ep"+(o-2)}if(""!==a&&!$("#"+a+"layout").length&&($("#layout").after("<div id='"+a+"layout' style='display: none;'></div>"),settings.hasOwnProperty(a+"layout")&&settings[a+"layout"].hasOwnProperty("metadata_kvps")))for(g=0;g<settings[a+"layout"].metadata_kvps.length;g++)settings[a+"layout"].metadata_kvps[g].k&&settings[a+"layout"].metadata_kvps[g].v&&UTIL.trySetAttribute(a+"layout",settings[a+"layout"].metadata_kvps[g],$);for(i=1;i<=50;i++)settings.hasOwnProperty(a+"text"+i)&&settings[a+"text"+i].display||i<=4?$("#"+a+"layout").append("<div id='"+a+"text"+i+"_wrapper'><div id='"+a+"text"+i+"'></div></div>"):i<=4&&$("#"+a+"layout").append("<div id='"+a+"text"+i+"_wrapper' style='display:none;'><div id='"+a+"text"+i+"'></div></div>");for(""===a?$("#"+a+"layout").append("<div id='form_wrapper'><div id='form'></div></div>"):$("#"+a+"layout").append("<div id='"+a+"_form_wrapper'><div id='"+a+"_form'></div></div>"),i=1;i<=50;i++)settings.hasOwnProperty(a+"button"+i)&&settings[a+"button"+i].display?$("#"+a+"layout").append("<div id='"+a+"button"+i+"_wrapper'><button id='"+a+"button"+i+"' class='"+a+"button"+i+"'></button></div>"):i<=4&&$("#"+a+"layout").append("<div id='"+a+"button"+i+"_wrapper' style='display:none;'><button id='"+a+"button"+i+"' class='"+a+"button"+i+"'></button></div>");for(i=1;i<=50;i++)settings.hasOwnProperty(a+"image"+i)&&settings[a+"image"+i].display?$("#"+a+"layout").append("<div id='"+a+"image"+i+"_wrapper'><img id='"+a+"image"+i+"' /></div>"):i<=4&&$("#"+a+"layout").append("<div id='"+a+"image"+i+"_wrapper' style='display:none;'><img id='"+a+"image"+i+"' /></div>");for(i=1;i<=50;i++)settings.hasOwnProperty(a+"html"+i)&&settings[a+"html"+i].display?$("#"+a+"layout").append("<div id='"+a+"html"+i+"_wrapper'><div id='"+a+"html"+i+"'></div></div>"):i<=4&&$("#"+a+"layout").append("<div id='"+a+"html"+i+"_wrapper' style='display:none;'><div id='"+a+"html"+i+"'></div></div>");for(i=1;i<=customFieldsLimit;i++)""!==a||settings.hasOwnProperty("custom"+i)?""===a||settings.hasOwnProperty(a+"_custom"+i)||(settings[a+"_custom"+i]={display:!1}):settings["custom"+i]={display:!1}}if(form_wrapper=$("#form_wrapper"),form=$("#form"),thx_form_wrapper=$("#thx_form_wrapper"),thx_form=$("#thx_form"),ep1_form_wrapper=$("#ep1_form_wrapper"),ep1_form=$("#ep1_form"),ep2_form_wrapper=$("#ep2_form_wrapper"),ep2_form=$("#ep2_form"),ep3_form_wrapper=$("#ep3_form_wrapper"),ep3_form=$("#ep3_form"),ep4_form_wrapper=$("#ep4_form_wrapper"),ep4_form=$("#ep4_form"),CURRENT_WIDTH=settings.layout.width,CURRENT_HEIGHT=settings.layout.height,determineGoogleFonts(),loadExternalFonts(""),replaceSettingsObjFormMergeTags(settings,""),buildStyles(t,r),buildText(),buildForm(),buildButtons(),buildImages(),loadImages(t,r),buildHTML(),buildDynamicItems(),buildCouponsDisplay(),replaceHrefMergeTags(),replaceBrMergeTags(),e){if(DIGIOH_PRQ.init(),preloadImages(),"object"==typeof html_ele.classList&&null!==html_ele.classList&&html_ele.classList.remove("hidden_until_loaded"),$("input").focus((function(){sendMessageToParent({sender:"lightbox",event:"input_focus",lightbox_id:LIGHTBOX_OR_VARIATION_GUID})})),""===a&&$("#layout").length&&settings.layout.hasOwnProperty("metadata_kvps"))for(g=0;g<settings.layout.metadata_kvps.length;g++)settings.layout.metadata_kvps[g].k&&settings.layout.metadata_kvps[g].v&&UTIL.trySetAttribute("layout",settings.layout.metadata_kvps[g],$);if("object"==typeof(l=DAPI.GET_EFFECTS(LIGHTBOX_OR_VARIATION_GUID))&&null!==l&&l.hasOwnProperty("widget_type")&&"string"==typeof l.widget_type&&l.hasOwnProperty(l.widget_type)&&l[l.widget_type].hasOwnProperty("metadata_kvps"))for(_=l[l.widget_type].metadata_kvps,g=0;g<_.length;g++)_[g].k&&_[g].v&&UTIL.trySetAttribute("body",_[g],$);sendMessageToParent({sender:"lightbox",status:"child_messaging_ready",lightbox_id:LIGHTBOX_OR_VARIATION_GUID}),sendMessageToParent({sender:"lightbox",loading_status:"settings_applied",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,widget_type:WIDGET_TYPE})}else t&&(t.indexOf("_")<0&&(t+="_"),changePages(t,t+"form",settings[t+"form"],"form"));BOX_CUSTOM_JS.runCustomJsAfterDOMReady(),hasAfterDomReadyJsFinished=!0,DAPI.BOXCOMM[LIGHTBOX_SHORT_ID.toString()].hasAfterDomReadyJsFinished=!0}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"applySettings")}}function preloadImages(){var e,t,r,s,n,i,o;try{if(e=S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/",(t=boxapi.getWidgetMetadata("box_preload_images"))&&("true"==t||"1"==t||"yes"==t))for(r="",s=1;s<=102;s++){if(1==s)r="";else if(2==s)r="thx";else if(s>=3&&(r="ep"+(s-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=s-3||!settings.extra_pages[s-3]||1!==settings.extra_pages[s-3].on))continue;for(n="||||",i=1;i<=50;i++)settings.hasOwnProperty(r+"button"+i)&&settings[r+"button"+i].display&&(settings[r+"button"+i].hasOwnProperty("background")&&settings[r+"button"+i].background.use_image&&settings[r+"button"+i].background.image.length>20&&n.indexOf("||||"+settings[r+"button"+i].background.image+"||||")<0&&(o=settings[r+"button"+i].background.image,$("body").append("<img src='"+e+o+"' style='display: none;'>"),n+=o+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+r+"button"+i+", "+e+o)),settings[r+"button"+i].hasOwnProperty("background_hover")&&settings[r+"button"+i].background_hover.use_image&&settings[r+"button"+i].background_hover.image.length>20&&n.indexOf("||||"+settings[r+"button"+i].background_hover.image+"||||")<0&&(o=settings[r+"button"+i].background_hover.image,$("body").append("<img src='"+e+o+"' style='display: none;'>"),n+=o+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+r+"button"+i+", "+e+o)),settings[r+"button"+i].hasOwnProperty("background_focus")&&settings[r+"button"+i].background_focus.use_image&&settings[r+"button"+i].background_focus.image.length>20&&n.indexOf("||||"+settings[r+"button"+i].background_focus.image+"||||")<0&&(o=settings[r+"button"+i].background_focus.image,$("body").append("<img src='"+e+o+"' style='display: none;'>"),n+=o+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+r+"button"+i+", "+e+o)),settings[r+"button"+i].hasOwnProperty("background_focus_hover")&&settings[r+"button"+i].background_focus_hover.use_image&&settings[r+"button"+i].background_focus_hover.image.length>20&&n.indexOf("||||"+settings[r+"button"+i].background_focus_hover.image+"||||")<0&&(o=settings[r+"button"+i].background_focus_hover.image,$("body").append("<img src='"+e+o+"' style='display: none;'>"),n+=o+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+r+"button"+i+", "+e+o))),settings.hasOwnProperty(r+"image"+i)&&settings[r+"image"+i].display&&settings[r+"image"+i].src.length>20&&n.indexOf("||||"+settings[r+"image"+i].src+"||||")<0&&(o=settings[r+"image"+i].src,$("body").append("<img src='"+e+o+"' style='display: none;'>"),n+=o+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+r+"image"+i+", "+e+o))}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"preloadImages")}}function buildDynamicItems(){var e,t,r;try{if(DAPI.DIGIOH_DYNAMIC_BOXES)for(e=0;e<DAPI.DIGIOH_DYNAMIC_BOXES.length;e++)DAPI.DIGIOH_DYNAMIC_BOXES[e].BoxID===LIGHTBOX_SHORT_ID&&("jquery"===(t=DAPI.DIGIOH_DYNAMIC_BOXES[e]).SourceType?LBOX.JQUERY_DIGIOH(t.SourceSelector).length?(r="[DTMP]",t.hasOwnProperty("JqueryMethod")&&t.hasOwnProperty("JqueryMethodParam")&&t.JqueryMethodParam&&("attr"===t.JqueryMethod?r=LBOX.JQUERY_DIGIOH(t.SourceSelector).attr(t.JqueryMethodParam):"prop"===t.JqueryMethod?r=LBOX.JQUERY_DIGIOH(t.SourceSelector).prop(t.JqueryMethodParam):"is"===t.JqueryMethod?r=LBOX.JQUERY_DIGIOH(t.SourceSelector).is(t.JqueryMethodParam):"css"===t.JqueryMethod?r=LBOX.JQUERY_DIGIOH(t.SourceSelector).css(t.JqueryMethodParam):"hasClass"===t.JqueryMethod&&(r=LBOX.JQUERY_DIGIOH(t.SourceSelector).hasClass(t.JqueryMethodParam))),t.hasOwnProperty("JqueryMethod")&&("text"===t.JqueryMethod?r=LBOX.JQUERY_DIGIOH(t.SourceSelector).text():"val"===t.JqueryMethod?r=LBOX.JQUERY_DIGIOH(t.SourceSelector).val():"length"===t.JqueryMethod&&(r=LBOX.JQUERY_DIGIOH(t.SourceSelector).length.toString())),"[DTMP]"===r&&(r=LBOX.JQUERY_DIGIOH(t.SourceSelector).html()),runDynamicSourceComparison(t,r)):""!==t.TargetDefault&&replaceDynamicTarget(t,t.TargetDefault):"url"===t.SourceType?("string"!=typeof(r=parent.location.href)&&(r=""),runDynamicSourceComparison(t,r)):"url_param"===t.SourceType&&("string"!=typeof(r=DAPI.UTIL.getUrlParam(t.SourceSelector))&&(r=""),runDynamicSourceComparison(t,r)))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildDynamicItems")}}function runDynamicSourceComparison(e,t){var r,s,n,i,o;try{if("[ANYTHING]"===e.SourceValue)replaceDynamicTarget(e,t,e.TargetDefault);else if("string"==typeof t){if(r=t,s=e.SourceValue,e.CaseSensitive||(r=r.toLowerCase(),s=s.toLowerCase()),n=[],UTIL.stringOrArrayContains(s,",")||UTIL.stringOrArrayContains(s,"|")?n=s.split(",").length>s.split("|").length?s.split(","):s.split("|"):n.push(s),"equals"===e.SourceOperator||"contains"===e.SourceOperator||"starts_with"===e.SourceOperator||"ends_with"===e.SourceOperator){for(i=!1,o=0;o<n.length;o++)if(""!==n[o].trim()){if("equals"===e.SourceOperator&&r===n[o].trim()){replaceDynamicTarget(e,t,e.TargetDefault),i=!0;break}if("contains"===e.SourceOperator&&r.indexOf(n[o].trim())>=0){replaceDynamicTarget(e,t,e.TargetDefault),i=!0;break}if("starts_with"===e.SourceOperator&&0===r.indexOf(n[o].trim())){replaceDynamicTarget(e,t,e.TargetDefault),i=!0;break}if("ends_with"===e.SourceOperator&&-1!==r.indexOf(n[o].trim(),r.length-n[o].trim().length)){replaceDynamicTarget(e,t,e.TargetDefault),i=!0;break}}i||""===e.TargetDefault||replaceDynamicTarget(e,"",e.TargetDefault)}else if(0===e.SourceOperator.indexOf("not_")){for(i=!1,o=0;o<n.length;o++)if(""!==n[o].trim()){if("not_equals"===e.SourceOperator&&r===n[o].trim()){i=!0;break}if("not_contains"===e.SourceOperator&&UTIL.stringOrArrayContains(r,n[o].trim())){i=!0;break}if("not_starts_with"===e.SourceOperator&&0===r.indexOf(n[o].trim())){i=!0;break}if("not_ends_with"===e.SourceOperator&&-1!==r.indexOf(n[o].trim(),r.length-n[o].trim().length)){i=!0;break}}i||replaceDynamicTarget(e,t,e.TargetDefault),i&&""!==e.TargetDefault&&replaceDynamicTarget(e,"",e.TargetDefault)}}else""!==e.TargetDefault&&replaceDynamicTarget(e,"",e.TargetDefault)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runDynamicSourceComparison")}}function replaceDynamicTarget(e,t,r){try{"merge"===e.TargetType?replaceDynamicTargetMerge(e,t,r):UTIL.stringOrArrayContains(e.TargetType,"_custom")?replaceDynamicTargetCustomField(e,t,r):replaceDynamicTargetElement(e,t,r)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceDynamicTarget")}}function replaceDynamicTargetMerge(e,t,r){var s,n,i,o,a,l;try{if("[SOURCE]"===(s=e.TargetValue||"")&&"string"==typeof t&&""!==t?s=t:("[SOURCE]"!==s||"string"==typeof t&&""!==t)&&t&&s||(s=r||""),!s)return;for($('div:contains("'+e.TargetMerge+'")').each((function(){($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length||$(this).children().length<2&&0===$(this).find("a").length&&0===$(this).find("button").length&&$(this).find("*").length<2)&&$(this).html($(this).html().split(e.TargetMerge).join(s))})),$('span:contains("'+e.TargetMerge+'")').each((function(){($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length)&&$(this).html($(this).html().split(e.TargetMerge).join(s))})),$('p:contains("'+e.TargetMerge+'")').each((function(){($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length)&&$(this).html($(this).html().split(e.TargetMerge).join(s))})),$('style:contains("'+e.TargetMerge+'")').each((function(){$(this).children().length<1&&$(this).html($(this).html().split(e.TargetMerge).join(s))})),$('button:contains("'+e.TargetMerge+'")').each((function(){$(this).children().length<1&&$(this).html($(this).html().split(e.TargetMerge).join(s))})),$("img").each((function(){$(this).attr("src")&&UTIL.stringOrArrayContains($(this).attr("src"),e.TargetMerge)&&$(this).attr("src",$(this).attr("src").split(e.TargetMerge).join(s))})),$("input,textarea").each((function(){$(this).val()&&UTIL.stringOrArrayContains($(this).val(),e.TargetMerge)&&$(this).val($(this).val().split(e.TargetMerge).join(s)),"string"==typeof $(this).attr("placeholder")&&UTIL.stringOrArrayContains($(this).attr("placeholder"),e.TargetMerge)&&$(this).attr("placeholder",$(this).attr("placeholder").split(e.TargetMerge).join(s))})),$("select option").each((function(){$(this).val()&&UTIL.stringOrArrayContains($(this).val(),e.TargetMerge)&&$(this).val($(this).val().split(e.TargetMerge).join(s)),$(this).text()&&UTIL.stringOrArrayContains($(this).text(),e.TargetMerge)&&$(this).text($(this).text().split(e.TargetMerge).join(s))})),n=1;n<=102;n++){if(i="",1==n)i="";else if(2==n)i="thx_";else if(n>=3&&n<=6)i="ep"+(n-2)+"_";else if(n>=7&&(i="ep"+(n-2)+"_",!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=n-3||!settings.extra_pages[n-3]||1!==settings.extra_pages[n-3].on))continue;for(settings.hasOwnProperty(i+"form")&&settings[i+"form"].redirect_url&&UTIL.stringOrArrayContains(settings[i+"form"].redirect_url,e.TargetMerge)&&(settings[i+"form"].redirect_url=settings[i+"form"].redirect_url.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].hasOwnProperty("error_text")&&settings[i+"name"].error_text&&UTIL.stringOrArrayContains(settings[i+"name"].error_text,e.TargetMerge)&&(settings[i+"name"].error_text=settings[i+"name"].error_text.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].label&&UTIL.stringOrArrayContains(settings[i+"name"].label,e.TargetMerge)&&(settings[i+"name"].label=settings[i+"name"].label.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].placeholder_full&&UTIL.stringOrArrayContains(settings[i+"name"].placeholder_full,e.TargetMerge)&&(settings[i+"name"].placeholder_full=settings[i+"name"].placeholder_full.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].placeholder_first&&UTIL.stringOrArrayContains(settings[i+"name"].placeholder_first,e.TargetMerge)&&(settings[i+"name"].placeholder_first=settings[i+"name"].placeholder_first.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].placeholder_last&&UTIL.stringOrArrayContains(settings[i+"name"].placeholder_last,e.TargetMerge)&&(settings[i+"name"].placeholder_last=settings[i+"name"].placeholder_last.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].help_full&&UTIL.stringOrArrayContains(settings[i+"name"].help_full,e.TargetMerge)&&(settings[i+"name"].help_full=settings[i+"name"].help_full.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].help_first&&UTIL.stringOrArrayContains(settings[i+"name"].help_first,e.TargetMerge)&&(settings[i+"name"].help_first=settings[i+"name"].help_first.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].help_last&&UTIL.stringOrArrayContains(settings[i+"name"].help_last,e.TargetMerge)&&(settings[i+"name"].help_last=settings[i+"name"].help_last.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].default_full&&UTIL.stringOrArrayContains(settings[i+"name"].default_full,e.TargetMerge)&&(settings[i+"name"].default_full=settings[i+"name"].default_full.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].default_first&&UTIL.stringOrArrayContains(settings[i+"name"].default_first,e.TargetMerge)&&(settings[i+"name"].default_first=settings[i+"name"].default_first.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"name")&&settings[i+"name"].default_last&&UTIL.stringOrArrayContains(settings[i+"name"].default_last,e.TargetMerge)&&(settings[i+"name"].default_last=settings[i+"name"].default_last.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"email")&&settings[i+"email"].hasOwnProperty("error_text")&&settings[i+"email"].error_text&&UTIL.stringOrArrayContains(settings[i+"email"].error_text,e.TargetMerge)&&(settings[i+"email"].error_text=settings[i+"email"].error_text.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"email")&&settings[i+"email"].label&&UTIL.stringOrArrayContains(settings[i+"email"].label,e.TargetMerge)&&(settings[i+"email"].label=settings[i+"email"].label.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"email")&&settings[i+"email"].placeholder&&UTIL.stringOrArrayContains(settings[i+"email"].placeholder,e.TargetMerge)&&(settings[i+"email"].placeholder=settings[i+"email"].placeholder.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"email")&&settings[i+"email"].help&&UTIL.stringOrArrayContains(settings[i+"email"].help,e.TargetMerge)&&(settings[i+"email"].help=settings[i+"email"].help.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"email")&&settings[i+"email"].default&&UTIL.stringOrArrayContains(settings[i+"email"].default,e.TargetMerge)&&(settings[i+"email"].default=settings[i+"email"].default.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"phone")&&settings[i+"phone"].hasOwnProperty("error_text")&&settings[i+"phone"].error_text&&UTIL.stringOrArrayContains(settings[i+"phone"].error_text,e.TargetMerge)&&(settings[i+"phone"].error_text=settings[i+"phone"].error_text.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"phone")&&settings[i+"phone"].label&&UTIL.stringOrArrayContains(settings[i+"phone"].label,e.TargetMerge)&&(settings[i+"phone"].label=settings[i+"phone"].label.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"phone")&&settings[i+"phone"].placeholder&&UTIL.stringOrArrayContains(settings[i+"phone"].placeholder,e.TargetMerge)&&(settings[i+"phone"].placeholder=settings[i+"phone"].placeholder.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"phone")&&settings[i+"phone"].help&&UTIL.stringOrArrayContains(settings[i+"phone"].help,e.TargetMerge)&&(settings[i+"phone"].help=settings[i+"phone"].help.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"phone")&&settings[i+"phone"].default&&UTIL.stringOrArrayContains(settings[i+"phone"].default,e.TargetMerge)&&(settings[i+"phone"].default=settings[i+"phone"].default.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"opt_in")&&settings[i+"opt_in"].hasOwnProperty("error_text")&&settings[i+"opt_in"].error_text&&UTIL.stringOrArrayContains(settings[i+"opt_in"].error_text,e.TargetMerge)&&(settings[i+"opt_in"].error_text=settings[i+"opt_in"].error_text.split(e.TargetMerge).join(s)),settings.hasOwnProperty(i+"opt_in")&&settings[i+"opt_in"].text&&UTIL.stringOrArrayContains(settings[i+"opt_in"].text,e.TargetMerge)&&(settings[i+"opt_in"].text=settings[i+"opt_in"].text.split(e.TargetMerge).join(s)),a=1;a<=50;a++)(o=i).indexOf("_")>0&&(o=o.split("_")[0]),settings.hasOwnProperty(o+"button"+a)&&settings[o+"button"+a].url&&UTIL.stringOrArrayContains(settings[o+"button"+a].url,e.TargetMerge)&&(settings[o+"button"+a].url=settings[o+"button"+a].url.split(e.TargetMerge).join(s));for(a=1;a<=customFieldsLimit;a++)l=i+"custom"+a,settings.hasOwnProperty(l)&&(settings[l].hasOwnProperty("error_text")&&settings[l].error_text&&UTIL.stringOrArrayContains(settings[l].error_text,e.TargetMerge)&&(settings[l].error_text=settings[l].error_text.split(e.TargetMerge).join(s)),settings[l].label&&UTIL.stringOrArrayContains(settings[l].label,e.TargetMerge)&&(settings[l].label=settings[l].label.split(e.TargetMerge).join(s)),settings[l].placeholder&&UTIL.stringOrArrayContains(settings[l].placeholder,e.TargetMerge)&&(settings[l].placeholder=settings[l].placeholder.split(e.TargetMerge).join(s)),settings[l].help&&UTIL.stringOrArrayContains(settings[l].help,e.TargetMerge)&&(settings[l].help=settings[l].help.split(e.TargetMerge).join(s)),settings[l].default&&UTIL.stringOrArrayContains(settings[l].default,e.TargetMerge)&&(settings[l].default=settings[l].default.split(e.TargetMerge).join(s)))}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceDynamicTargetMerge")}}function replaceDynamicTargetElement(e,t,r){var s,n,i,o;try{if("[SOURCE]"===(s=e.TargetValue||"")&&"string"==typeof t&&""!==t?s=t:("[SOURCE]"!==s||"string"==typeof t&&""!==t)&&t&&s||(s=r||""),!s)return;n=0===(n=e.TargetType).indexOf("main_")?n.split("_")[1]:n.split("_").join(""),i=$("#"+n).attr("id"),settings.hasOwnProperty(i)&&settings[i].display&&(n.indexOf("image")>=0?"string"==typeof s&&s.indexOf("://")>0&&(image_dims[i+"_dynamic"]={width:100,height:100},(o=new Image).onload=function(){image_dims[i+"_dynamic"].width=this.width,image_dims[i+"_dynamic"].height=this.height,resizeImage(image_dims[i+"_dynamic"],$("#"+i+"_wrapper"),$("#"+i),i,settings[i].width,settings[i].height,!0),$("#"+i+"_wrapper").show()},ImageSrcMap[i+"_dynamic"]={img_obj:o,img_src:s,img_element:$("#"+i)},ImageSrcMap[i+"_dynamic"].img_element.attr("src",ImageSrcMap[i+"_dynamic"].img_src),ImageSrcMap[i+"_dynamic"].img_obj.src=ImageSrcMap[i+"_dynamic"].img_src):$("#"+n).html(s))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceDynamicTargetElement")}}function replaceDynamicTargetCustomField(e,t,r){var s,n;try{if("[SOURCE]"===(s=e.TargetValue||"")&&"string"==typeof t&&""!==t?s=t:("[SOURCE]"!==s||"string"==typeof t&&""!==t)&&t&&s||(s=r||""),!s)return;n=0===(n=e.TargetType).indexOf("main_")?"form_input_"+n.split("_")[1]:n.split("_")[0]+"_form_input_"+n.split("_")[1],$("#"+n).val(s)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceDynamicTargetCustomField")}}function buildCouponsDisplay(){findAndInsertCouponsOnPages("display")}function checkCouponsOnSubmit(){return new Promise(((e,t)=>{"object"==typeof COUPONS_FOR_SUBMIT&&0!=Object.keys(COUPONS_FOR_SUBMIT).length?"boolean"==typeof bypassCoupons&&bypassCoupons?e():findAndInsertCouponsOnPages("submit").then(e).catch(t):e()}))}function findAndInsertCouponsOnPages(e){return new Promise(((t,r)=>{var s,n,i,o;try{s=[];let a=function(e){var t,r;if(e.length>1)for(t=1;t<e.length;t++)UTIL.stringOrArrayContains(e[t],"]")&&((r=e[t].split("]")[0])&&!UTIL.stringOrArrayContains(s,r)&&s.push(r))};if($('div:contains("[COUPON_")').each((function(){if($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length){var e=$(this).html().split("[COUPON_");a(e)}})),$('button:contains("[COUPON_")').each((function(){if($(this).children().length<1){var e=$(this).html().split("[COUPON_");a(e)}})),$("input,select,textarea").each((function(){if(UTIL.stringOrArrayContains($(this).val(),"[COUPON_")){var e=$(this).val().split("[COUPON_");a(e)}})),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - findCouponsOnPages: "+e),logger("mtags ==>"),logger(s),n=[],s.length>0)for(i=0;i<s.length;i++)"display"===e&&(DAPI.hasOwnProperty("COUPON_GROUP_POPULATE_OBJ")&&DAPI.COUPON_GROUP_POPULATE_OBJ.hasOwnProperty(s[i])&&"submit"===DAPI.COUPON_GROUP_POPULATE_OBJ[s[i]]&&!COUPONS_FOR_SUBMIT.hasOwnProperty(s[i])?COUPONS_FOR_SUBMIT[s[i]]=!1:DAPI.hasOwnProperty("COUPON_GROUP_POPULATE_OBJ")&&DAPI.COUPON_GROUP_POPULATE_OBJ.hasOwnProperty(s[i])||(COUPONS_FOR_SUBMIT[s[i]]=!1)),o="",DAPI.hasOwnProperty("COUPON_GROUP_POPULATE_OBJ")?DAPI.COUPON_GROUP_POPULATE_OBJ.hasOwnProperty(s[i])?DAPI.COUPON_GROUP_POPULATE_OBJ[s[i]]===e&&(n.push(insertCouponCodeAsync(s[i],e,"1")),o=" 1"):"submit"===e&&(n.push(insertCouponCodeAsync(s[i],e,"2")),o=" 2"):"submit"===e?(n.push(insertCouponCodeAsync(s[i],e,"3")),o=" 3"):o=" 4 no match",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - findCouponsOnPages: "+e+" ("+s[i]+") section"+o);logger("COUPONS_FOR_SUBMIT ==>"),logger(COUPONS_FOR_SUBMIT),setTimeout((()=>r("rejecting submission after waiting 10 secs")),1e4),Promise.allSettled(n).then(t)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"findCouponsOnPages"),r("findCouponsOnPages "+e.message)}}))}function insertCouponCodeAsync(t,r,s){return new Promise(((n,i)=>{var o,a;try{o=COUPON_BASE_URL+"/Coupon/GetCoupon?user_id="+VENDOR_SHORT_ID+"&coupon_group_id="+t+"&client_id="+CLIENT_GUID,o+="&goat="+LBOX.LZString.compressToBase64(VENDOR_SHORT_ID+CLIENT_GUID).substr(0,32)+LBOX.LZString.compressToBase64((new Date).getTime().toString()),COUPONS_FOR_DISPLAY.hasOwnProperty(t)&&COUPONS_FOR_DISPLAY[t]?(a=COUPONS_FOR_DISPLAY[t],$('div:contains("[COUPON_'+t+']")').each((function(){($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length)&&$(this).html($(this).html().split("[COUPON_"+t+"]").join(a))})),$('button:contains("[COUPON_'+t+']")').each((function(){$(this).children().length<1&&$(this).html($(this).html().split("[COUPON_"+t+"]").join(a))})),$("input,select,textarea").each((function(){UTIL.stringOrArrayContains($(this).val(),"[COUPON_"+t+"]")&&$(this).val($(this).val().split("[COUPON_"+t+"]").join(a))}))):$.ajax({dataType:"jsonp",url:o,success:function(e){if(e&&"object"==typeof e&&null!==e&&e.hasOwnProperty("success")&&e.success)if(e.hasOwnProperty("payload")){logger("(BOX #"+LIGHTBOX_SHORT_ID+") - GetCoupon: SUCCESS ==>"),logger(e);var o=e.payload;COUPONS_FOR_DISPLAY[t]=o,$('div:contains("[COUPON_'+t+']")').each((function(){($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length)&&$(this).html($(this).html().split("[COUPON_"+t+"]").join(o))})),$('button:contains("[COUPON_'+t+']")').each((function(){$(this).children().length<1&&$(this).html($(this).html().split("[COUPON_"+t+"]").join(o))})),$("input,select,textarea").each((function(){UTIL.stringOrArrayContains($(this).val(),"[COUPON_"+t+"]")&&$(this).val($(this).val().split("[COUPON_"+t+"]").join(o))})),postMessageCouponUsed(t,e,"success",r,s,"1",CURRENT_PAGE),n()}else postMessageCouponUsed(t,e,"failure",r,s,"2",CURRENT_PAGE),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - GetCoupon: FAILURE 2 ==>"),logger(e),i("insertCouponCodeAsync GetCoupon: FAILURE 2");else e&&"object"==typeof e&&null!==e?(postMessageCouponUsed(t,e,"failure",r,s,"3",CURRENT_PAGE),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - GetCoupon: FAILURE 3 ==>"),logger(e),i("insertCouponCodeAsync GetCoupon: FAILURE 3")):(postMessageCouponUsed(t,"null","failure",r,s,"4",CURRENT_PAGE),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - GetCoupon: FAILURE 4 ==>"),logger(e),i("insertCouponCodeAsync GetCoupon: FAILURE 4"));COUPONS_FOR_SUBMIT.hasOwnProperty(t)&&(COUPONS_FOR_SUBMIT[t]=!0)},error:function(n,o,a){COUPONS_FOR_SUBMIT.hasOwnProperty(t)&&(COUPONS_FOR_SUBMIT[t]=!0),postMessageCouponUsed(t,{textStatus:o},"error",r,s,"5",CURRENT_PAGE),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - GetCoupon: FAILURE 5 ==>"),logger(o),DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(a,"insertCouponCodeAsync"),i("insertCouponCodeAsync "+o)}})}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"insertCouponCodeAsync"),i("insertCouponCodeAsync "+e.message)}}))}function replaceHrefMergeTags(){try{$('div:contains("[[LINK|"),p:contains("[[LINK|"),span:contains("[[LINK|")').each((function(){var e,t;if(($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length)&&(e=$(this).html().split("[[LINK|")).length>1)for(t=1;t<e.length;t++)if(UTIL.stringOrArrayContains(e[t],"]]")){var r=e[t].split("]]")[0].split("|")[0],s="",n="",i="[[LINK|"+r+"]]";e[t].split("]]")[0].split("|").length>1&&(i="[[LINK|"+r+"|"+(s=e[t].split("]]")[0].split("|")[1])+"]]"),e[t].split("]]")[0].split("|").length>2&&(i="[[LINK|"+r+"|"+s+"|"+(n=e[t].split("]]")[0].split("|")[2])+"]]"),s.length<1&&(s=r),UTIL.stringOrArrayContains(r,"://")||(r="https://"+r),$(this).html($(this).html().split(i).join("<a target='_blank' href='"+r+"' style='"+n+"'>"+s+"</a>"))}}))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceHrefMergeTags")}}function replaceBrMergeTags(){try{$('div:contains("[[BR]]"),p:contains("[[BR]]"),span:contains("[[BR]]")').each((function(){if($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length){var e=$(this).html().split("[[BR]]");e.length>1&&$(this).html(e.join("<br>"))}}))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceBrMergeTags")}}function showLoading(e){var t,r,s=0,n=0;e=DUTIL.getUnfriendlyPagePrefix(e),CURRENT_WIDTH&&CURRENT_HEIGHT?(s=CURRENT_WIDTH,n=CURRENT_HEIGHT):"thx_"===e&&settings.hasOwnProperty("thxlayout")?(s=settings.thxlayout.width,n=settings.thxlayout.height):0===e.indexOf("ep")?(t=DUTIL.getExtraPageNumberFromEPString(e),settings.hasOwnProperty("ep"+t+"layout")?(s=settings["ep"+t+"layout"].width,n=settings["ep"+t+"layout"].height):(s=settings.layout.width,n=settings.layout.height)):(s=settings.layout.width,n=settings.layout.height),r=!1,settings.hasOwnProperty(e+"form")&&settings[e+"form"].hasOwnProperty("loading_image")&&settings[e+"form"].loading_image?"hide"===settings[e+"form"].loading_image?(body.removeClass("loading"),r=!0):"other"===settings[e+"form"].loading_image&&settings[e+"form"].hasOwnProperty("loading_image_custom")&&settings[e+"form"].loading_image_custom&&($("#modal_loading_custom").length?$("#modal_loading_custom").attr("style","position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url("+S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+settings[e+"form"].loading_image_custom+") 50% 50% no-repeat rgba(255,255,255,.1)"):$("#modal_loading").append("<div id='modal_loading_custom' style='position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url("+S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+settings[e+"form"].loading_image_custom+") 50% 50% no-repeat rgba(255,255,255,.1)'></div>"),$("#modal_loading_spinner").hide(),body.addClass("loading"),r=!0):settings.hasOwnProperty(e+"form")&&settings[e+"form"].display&&settings[e+"form"].hasOwnProperty("loading_image")||!DIGIOH_PRQ.USE||!DIGIOH_PRQ.isBoxPRQ()||(body.removeClass("loading"),r=!0),r||($("#modal_loading_custom").length&&$("#modal_loading_custom").hide(),$("#modal_loading_spinner").css("left",Math.round(s/2)-10+"px"),$("#modal_loading_spinner").css("top",Math.round(n/2)-10+"px"),$("#modal_loading_spinner").show(),body.addClass("loading"))}function showLoadingDigioh(){$("#modal_loading_custom").length?$("#modal_loading_custom").attr("style","position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url(https://box.animalleague.org/w37htfhcq2/static/Digioh_Loading_Spinner_Black.gif) 50% 50% no-repeat rgba(255,255,255,.1);background-size: 125px 130px;"):$("#modal_loading").append("<div id='modal_loading_custom' style='position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url(https://box.animalleague.org/w37htfhcq2/static/Digioh_Loading_Spinner_Black.gif) 50% 50% no-repeat rgba(255, 255, 255, .1);background-size: 125px 130px;'></div>"),$("#modal_loading_spinner").hide(),body.addClass("loading")}function showLoadingCustomOrDefault(){for(var e,t="",r=-1;r<100;r++)if(t=-1==r?"":0==r?"thx":"ep"+r,e=DUTIL.getUnfriendlyPagePrefix(t),(""==t||settings.hasOwnProperty(t+"layout"))&&settings.hasOwnProperty(e+"form")&&settings[e+"form"].display&&settings[e+"form"].hasOwnProperty("loading_image")&&"other"===settings[e+"form"].loading_image&&settings[e+"form"].hasOwnProperty("loading_image_custom")&&settings[e+"form"].loading_image_custom)return $("#modal_loading_custom").length?$("#modal_loading_custom").attr("style","position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url("+S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+settings[e+"form"].loading_image_custom+") 50% 50% no-repeat rgba(255,255,255,.1)"):$("#modal_loading").append("<div id='modal_loading_custom' style='position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url("+S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+settings[e+"form"].loading_image_custom+") 50% 50% no-repeat rgba(255,255,255,.1)'></div>"),$("#modal_loading_spinner").hide(),void body.addClass("loading");showLoadingDigioh()}function hideLoading(){body.removeClass("loading")}function determineGoogleFonts(){for(var e,t="",r=1;r<=102;r++){if(1==r)t="";else if(2==r)t="thx";else if(r>=3&&r<=6)t="ep"+(r-2);else if(r>=7&&(t="ep"+(r-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=r-3||!settings.extra_pages[r-3]||1!==settings.extra_pages[r-3].on))continue;for(e=1;e<=50;e++)settings.hasOwnProperty(t+"text"+e)&&settings[t+"text"+e].display&&addGoogleFontToStack(settings[t+"text"+e].font.family),settings.hasOwnProperty(t+"button"+e)&&settings[t+"button"+e].display&&addGoogleFontToStack(settings[t+"button"+e].font.family),settings.hasOwnProperty(t+"button"+e)&&settings[t+"button"+e].display&&addGoogleFontToStack(settings[t+"button"+e].font_hover.family),settings.hasOwnProperty(t+"button"+e)&&settings[t+"button"+e].display&&addGoogleFontToStack(settings[t+"button"+e].font_focus.family)}loadGoogleFontsFromStack()}function loadExternalFonts(e,t){var r,s;try{if(("string"!=typeof e||"main"===e)&&(e=""),UTIL.stringOrArrayContains(e,"_")&&(e=e.split("_")[0]),!t)if(""===e||LoadedCustomFonts.hasOwnProperty(e)){if(LoadedCustomFonts.hasOwnProperty(e)&&!0===LoadedCustomFonts[e])return}else LoadedCustomFonts[e]=!0;for(logger("loadExternalFonts("+e+")"),r=1;r<=50;r++)settings.hasOwnProperty(e+"text"+r)&&settings[e+"text"+r].display&&addCustomFontToStack(settings[e+"text"+r].font.family),settings.hasOwnProperty(e+"button"+r)&&settings[e+"button"+r].display&&addCustomFontToStack(settings[e+"button"+r].font.family),settings.hasOwnProperty(e+"button"+r)&&settings[e+"button"+r].display&&addCustomFontToStack(settings[e+"button"+r].font_hover.family),settings.hasOwnProperty(e+"button"+r)&&settings[e+"button"+r].display&&addCustomFontToStack(settings[e+"button"+r].font_focus.family);""!==(s=e)&&(s+="_"),settings.hasOwnProperty(s+"labels")&&addCustomFontToStack(settings[s+"labels"].font.family),settings.hasOwnProperty(s+"inputs")&&addCustomFontToStack(settings[s+"inputs"].font.family)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"loadExternalFonts")}}function addCustomFontToStack(e){var t,r;try{if(e.indexOf("__custom__")>=0&&e.indexOf("||||")>=0){var s=e.split("||||"),n=s[1],i=s[2],o=S3_BASE_URL+"/custom_fonts/"+i+".css?cb="+CACHE_VERSION;-1===$.inArray(n,basic_fonts)&&-1===$.inArray(n,custom_fonts)&&(custom_fonts.push(n),t=document.head||document.getElementsByTagName("head")[0],(r=document.createElement("link")).type="text/css",r.rel="stylesheet",r.href=o,t.appendChild(r))}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"addCustomFontToStack")}}function addGoogleFontToStack(e){try{var t="";e.indexOf("__google__")>=0?t=e.replace("__google__","").split("'")[1]:e&&-1===e.indexOf("__custom__")&&e.length>10&&-1===$.inArray(e,basic_fonts)&&(t=e.split("'")[1]),t&&t.length>1&&-1===$.inArray(t,google_fonts)&&google_fonts.push(t)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"addGoogleFontToStack")}}function loadGoogleFontsFromStack(){var e,t,r,s,n;try{if(google_fonts.length>0){for(e="https://fonts.googleapis.com/css?family=",t="",r=0;r<google_fonts.length;r++)(t=google_fonts[r]).indexOf(" ")>0&&(t=t.split(" ").join("+")),e+=t,e+=":400,700",r<google_fonts.length-1&&(e+="|");s=document.head||document.getElementsByTagName("head")[0],(n=document.createElement("link")).type="text/css",n.rel="stylesheet",n.href=e+"&display=fallback",s.appendChild(n)}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"loadGoogleFontsFromStack")}}function buildText(){var e,t,r,s;try{for(e="",t=1;t<=102;t++){if(1==t)e="";else if(2==t)e="thx";else if(t>=3&&t<=6)e="ep"+(t-2);else if(t>=7&&(e="ep"+(t-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=t-3||!settings.extra_pages[t-3]||1!==settings.extra_pages[t-3].on))continue;for(r=1;r<=50;r++)if(settings.hasOwnProperty(e+"text"+r)&&settings[e+"text"+r].display&&($("#"+e+"text"+r).html(settings[e+"text"+r].text),settings[e+"text"+r].hasOwnProperty("metadata_kvps")))for(s=0;s<settings[e+"text"+r].metadata_kvps.length;s++)settings[e+"text"+r].metadata_kvps[s].k&&settings[e+"text"+r].metadata_kvps[s].v&&UTIL.trySetAttribute(e+"text"+r,settings[e+"text"+r].metadata_kvps[s],$)}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildText")}}function buildHTMLItemAndEvalJSFromHtml(n,t){var o,s,f,i,e,r;try{if(!(settings.hasOwnProperty(t)&&settings[t]&&settings[t].hasOwnProperty("display")&&settings[t].hasOwnProperty("html")&&settings[t].display&&settings[t].html))return;if(-1===settings[t].html.indexOf("script"))n.html(settings[t].html);else for(o=document.getElementById(t),o.innerHTML=settings[t].html,s=o.getElementsByTagName("script"),f=0;f<s.length;++f)i=s[f],i.innerHTML&&i.innerHTML.length>0?eval(i.innerHTML):i.hasAttribute("src")&&(e=i.getAttribute("src"),"string"==typeof e&&e.indexOf("//")>=0&&(r=document.createElement("script"),r.setAttribute("type","text/javascript"),r.setAttribute("src",e),r.async=!0,document.getElementsByTagName("head")[0].appendChild(r)))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildHTMLItemAndEvalJSFromHtml")}}function buildHTML(){var e,t,r,s;try{for(e="",t=1;t<=102;t++){if(1==t)e="";else if(2==t)e="thx";else if(t>=3&&t<=6)e="ep"+(t-2);else if(t>=7&&(e="ep"+(t-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=t-3||!settings.extra_pages[t-3]||1!==settings.extra_pages[t-3].on))continue;for(r=1;r<=50;r++)if(settings.hasOwnProperty(e+"html"+r)&&settings[e+"html"+r].display&&(buildHTMLItemAndEvalJSFromHtml($("#"+e+"html"+r),e+"html"+r),settings[e+"html"+r].hasOwnProperty("metadata_kvps")))for(s=0;s<settings[e+"html"+r].metadata_kvps.length;s++)settings[e+"html"+r].metadata_kvps[s].k&&settings[e+"html"+r].metadata_kvps[s].v&&UTIL.trySetAttribute(e+"html"+r,settings[e+"html"+r].metadata_kvps[s],$)}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildHTML")}}function buildForm(){var e,t;try{if(using_form=settings.hasOwnProperty("form")&&settings.form.display,using_form_thx=settings.hasOwnProperty("thxlayout")&&settings.hasOwnProperty("thx_form")&&settings.thx_form.display,using_form_ep1=settings.hasOwnProperty("ep1layout")&&settings.hasOwnProperty("ep1_form")&&settings.ep1_form.display,using_form_ep2=settings.hasOwnProperty("ep2layout")&&settings.hasOwnProperty("ep2_form")&&settings.ep2_form.display,using_form_ep3=settings.hasOwnProperty("ep3layout")&&settings.hasOwnProperty("ep3_form")&&settings.ep3_form.display,using_form_ep4=settings.hasOwnProperty("ep4layout")&&settings.hasOwnProperty("ep4_form")&&settings.ep4_form.display,using_form){for(form.empty(),buildFormName("",form),buildFormEmail("",form),buildFormPhone("",form),t=1;t<=customFieldsLimit;t++)buildFormCustomN("","custom"+t,form);buildFormOptIn("",form)}if(using_form_thx){for(thx_form.empty(),buildFormName("thx",thx_form),buildFormEmail("thx",thx_form),buildFormPhone("thx",thx_form),t=1;t<=customFieldsLimit;t++)buildFormCustomN("thx","thx_custom"+t,thx_form);buildFormOptIn("thx",thx_form)}if(using_form_ep1){for(ep1_form.empty(),buildFormName("ep1",ep1_form),buildFormEmail("ep1",ep1_form),buildFormPhone("ep1",ep1_form),t=1;t<=customFieldsLimit;t++)buildFormCustomN("ep1","ep1_custom"+t,ep1_form);buildFormOptIn("ep1",ep1_form)}if(using_form_ep2){for(ep2_form.empty(),buildFormName("ep2",ep2_form),buildFormEmail("ep2",ep2_form),buildFormPhone("ep2",ep2_form),t=1;t<=customFieldsLimit;t++)buildFormCustomN("ep2","ep2_custom"+t,ep2_form);buildFormOptIn("ep2",ep2_form)}if(using_form_ep3){for(ep3_form.empty(),buildFormName("ep3",ep3_form),buildFormEmail("ep3",ep3_form),buildFormPhone("ep3",ep3_form),t=1;t<=customFieldsLimit;t++)buildFormCustomN("ep3","ep3_custom"+t,ep3_form);buildFormOptIn("ep3",ep3_form)}if(using_form_ep4){for(ep4_form.empty(),buildFormName("ep4",ep4_form),buildFormEmail("ep4",ep4_form),buildFormPhone("ep4",ep4_form),t=1;t<=customFieldsLimit;t++)buildFormCustomN("ep4","ep4_custom"+t,ep4_form);buildFormOptIn("ep4",ep4_form)}if(!using_form&&$("#form_wrapper").length&&(form_wrapper.hide(),form.hide()),!using_form_thx&&$("#thx_form_wrapper").length&&(thx_form_wrapper.hide(),thx_form.hide()),!using_form_ep1&&$("#ep1_form_wrapper").length&&(ep1_form_wrapper.hide(),ep1_form.hide()),!using_form_ep2&&$("#ep2_form_wrapper").length&&(ep2_form_wrapper.hide(),ep2_form.hide()),!using_form_ep3&&$("#ep3_form_wrapper").length&&(ep3_form_wrapper.hide(),ep3_form.hide()),!using_form_ep4&&$("#ep4_form_wrapper").length&&(ep4_form_wrapper.hide(),ep4_form.hide()),settings.hasOwnProperty("extra_pages"))for(e=5;e<=100;e++)if("",!(settings.extra_pages.length<e)&&settings.extra_pages[e-1]&&1===settings.extra_pages[e-1].on)if("ep"+e,settings.hasOwnProperty("ep"+e+"layout")&&settings.hasOwnProperty("ep"+e+"_form")&&settings["ep"+e+"_form"].display){for($("#ep"+e+"_form").length&&$("#ep"+e+"_form").empty(),buildFormName("ep"+e,$("#ep"+e+"_form")),buildFormEmail("ep"+e,$("#ep"+e+"_form")),buildFormPhone("ep"+e,$("#ep"+e+"_form")),t=1;t<=customFieldsLimit;t++)buildFormCustomN("ep"+e,"ep"+e+"_custom"+t,$("#ep"+e+"_form"));buildFormOptIn("ep"+e,$("#ep"+e+"_form"))}else $("#ep"+e+"_form_wrapper").length&&($("#ep"+e+"_form_wrapper").hide(),$("#ep"+e+"_form").hide());initFormInputs()}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildForm")}}function buildButtons(){var e,t,r,s;try{for(e="",t=1;t<=102;t++){if(1==t)e="";else if(2==t)e="thx";else if(t>=3&&t<=6)e="ep"+(t-2);else if(t>=7&&(e="ep"+(t-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=t-3||!settings.extra_pages[t-3]||1!==settings.extra_pages[t-3].on))continue;for(r=1;r<=50;r++)if(settings.hasOwnProperty(e+"button"+r)&&settings[e+"button"+r].display){if(buildButtonN($("#"+e+"button"+r),$("#"+e+"button"+r+"_wrapper"),e+"button"+r,settings[e+"button"+r],""===e?"":e+"_"),settings[e+"button"+r].hasOwnProperty("metadata_kvps"))for(s=0;s<settings[e+"button"+r].metadata_kvps.length;s++)settings[e+"button"+r].metadata_kvps[s].k&&settings[e+"button"+r].metadata_kvps[s].v&&-1===settings[e+"button"+r].metadata_kvps[s].k.indexOf("[")&&UTIL.trySetAttribute(e+"button"+r,settings[e+"button"+r].metadata_kvps[s],$);("string"!=typeof $("#"+e+"button"+r).attr("aria-label")||$("#"+e+"button"+r).attr("aria-label").length<1)&&("submit"==settings[e+"button"+r].action?$("#"+e+"button"+r).attr("aria-label","Submit Modal Form"):"close"==settings[e+"button"+r].action?$("#"+e+"button"+r).attr("aria-label","Close Modal"):"url"==settings[e+"button"+r].action?$("#"+e+"button"+r).attr("aria-label","Redirect to URL"):"download"==settings[e+"button"+r].action?$("#"+e+"button"+r).attr("aria-label","Download File"):"lightbox_open"==settings[e+"button"+r].action?$("#"+e+"button"+r).attr("aria-label","Open Another Modal"):settings[e+"button"+r].action.indexOf("_page")>0&&$("#"+e+"button"+r).attr("aria-label","Open Next Modal Page"))}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildButtons")}}function initFormInputs(){var e,t;try{for($("#form_input_full_name").length&&(form_input_full_name=$("#form_input_full_name")),$("#form_input_first_name").length&&(form_input_first_name=$("#form_input_first_name")),$("#form_input_last_name").length&&(form_input_last_name=$("#form_input_last_name")),$("#form_input_email").length&&(form_input_email=$("#form_input_email")),$("#form_input_phone").length&&(form_input_phone=$("#form_input_phone")),$("#form_input_opt_in").length&&(form_input_opt_in=$("#form_input_opt_in")),$("#thx_form_input_full_name").length&&(thx_form_input_full_name=$("#thx_form_input_full_name")),$("#thx_form_input_first_name").length&&(thx_form_input_first_name=$("#thx_form_input_first_name")),$("#thx_form_input_last_name").length&&(thx_form_input_last_name=$("#thx_form_input_last_name")),$("#thx_form_input_email").length&&(thx_form_input_email=$("#thx_form_input_email")),$("#thx_form_input_phone").length&&(thx_form_input_phone=$("#thx_form_input_phone")),$("#thx_form_input_opt_in").length&&(thx_form_input_opt_in=$("#thx_form_input_opt_in")),$("#ep1_form_input_full_name").length&&(ep1_form_input_full_name=$("#ep1_form_input_full_name")),$("#ep1_form_input_first_name").length&&(ep1_form_input_first_name=$("#ep1_form_input_first_name")),$("#ep1_form_input_last_name").length&&(ep1_form_input_last_name=$("#ep1_form_input_last_name")),$("#ep1_form_input_email").length&&(ep1_form_input_email=$("#ep1_form_input_email")),$("#ep1_form_input_phone").length&&(ep1_form_input_phone=$("#ep1_form_input_phone")),$("#ep1_form_input_opt_in").length&&(ep1_form_input_opt_in=$("#ep1_form_input_opt_in")),$("#ep2_form_input_full_name").length&&(ep2_form_input_full_name=$("#ep2_form_input_full_name")),$("#ep2_form_input_first_name").length&&(ep2_form_input_first_name=$("#ep2_form_input_first_name")),$("#ep2_form_input_last_name").length&&(ep2_form_input_last_name=$("#ep2_form_input_last_name")),$("#ep2_form_input_email").length&&(ep2_form_input_email=$("#ep2_form_input_email")),$("#ep2_form_input_phone").length&&(ep2_form_input_phone=$("#ep2_form_input_phone")),$("#ep2_form_input_opt_in").length&&(ep2_form_input_opt_in=$("#ep2_form_input_opt_in")),$("#ep3_form_input_full_name").length&&(ep3_form_input_full_name=$("#ep3_form_input_full_name")),$("#ep3_form_input_first_name").length&&(ep3_form_input_first_name=$("#ep3_form_input_first_name")),$("#ep3_form_input_last_name").length&&(ep3_form_input_last_name=$("#ep3_form_input_last_name")),$("#ep3_form_input_email").length&&(ep3_form_input_email=$("#ep3_form_input_email")),$("#ep3_form_input_phone").length&&(ep3_form_input_phone=$("#ep3_form_input_phone")),$("#ep3_form_input_opt_in").length&&(ep3_form_input_opt_in=$("#ep3_form_input_opt_in")),$("#ep4_form_input_full_name").length&&(ep4_form_input_full_name=$("#ep4_form_input_full_name")),$("#ep4_form_input_first_name").length&&(ep4_form_input_first_name=$("#ep4_form_input_first_name")),$("#ep4_form_input_last_name").length&&(ep4_form_input_last_name=$("#ep4_form_input_last_name")),$("#ep4_form_input_email").length&&(ep4_form_input_email=$("#ep4_form_input_email")),$("#ep4_form_input_phone").length&&(ep4_form_input_phone=$("#ep4_form_input_phone")),$("#ep4_form_input_opt_in").length&&(ep4_form_input_opt_in=$("#ep4_form_input_opt_in")),e=1;e<=customFieldsLimit;e++)if($("#form_input_custom"+e).length&&(form_input_obj["form_input_custom"+e]=$("#form_input_custom"+e)),$("#thx_form_input_custom"+e).length&&(form_input_obj["thx_form_input_custom"+e]=$("#thx_form_input_custom"+e)),$("#ep1_form_input_custom"+e).length&&(form_input_obj["ep1_form_input_custom"+e]=$("#ep1_form_input_custom"+e)),$("#ep2_form_input_custom"+e).length&&(form_input_obj["ep2_form_input_custom"+e]=$("#ep2_form_input_custom"+e)),$("#ep3_form_input_custom"+e).length&&(form_input_obj["ep3_form_input_custom"+e]=$("#ep3_form_input_custom"+e)),$("#ep4_form_input_custom"+e).length&&(form_input_obj["ep4_form_input_custom"+e]=$("#ep4_form_input_custom"+e)),settings.hasOwnProperty("extra_pages"))for(t=5;t<=100;t++)settings.extra_pages.length>=t&&settings.extra_pages[t-1]&&1===settings.extra_pages[t-1].on&&$("#ep"+t+"_form_input_custom"+e).length&&(form_input_obj["ep"+t+"_form_input_custom"+e]=$("#ep"+t+"_form_input_custom"+e))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"initFormInputs")}}function getFirstLastNames(e){var t,r,s,n;try{if(UTIL.isNullOrWhitespace(e))return["",""];if(0==(t=(e=e.trim()).split(" ")).length)return["",""];if(1==t.length)return[t[0],""];if(2==t.length)return[t[0],t[1]];for(r=t[0],s="",n=1;n<t.length;n++)UTIL.isNullOrWhitespace(t[n])||(s+=t[n].trim()+" ");return s.length>0&&(s=s.trim()),[r,s]}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"getFirstLastNames"),["",""]}}function getFullName(e,t){try{if(e=UTIL.isNullOrWhitespace(e)?"":e.trim(),t=UTIL.isNullOrWhitespace(t)?"":t.trim(),e.length>0&&t.length>0)return e+" "+t;if(e.length>0)return e;if(t.length>0)return t}catch(r){return DLOG.tryShowError(r)&&(r.message="DIGIOH_ERROR: lightbox_builder.js -- "+r.message,console.error(r)),BOX_CUSTOM_JS.logError(r,"getFullName"),e+" "+t}}function formatPhoneString(e,t,r="",s){try{let n=t;""!=r&&(n=r);const i=parseInt(t.indexOf("x")),o=parseInt(t.lastIndexOf("x"))+1,a=parseInt(t.length),l=t.substring(0,i),_=t.substring(o,a);let g=n,p="",u=0;if(l&&e.indexOf(l)>-1&&(e=e.replace(l,"")),_&&e.indexOf(_)>-1&&(e=e.replace(_,"")),p=e.replace(/[^0-9]/gi,""),u=p.length,""===p&&""==r)return u="0",g="";settings[s+"phone"].enable_country_code&&settings[s+"phone"].country_code&&i<0&&g.includes("1")&&(g=g.replace("1","x"));for(let e=0;e<g.length;++e)"x"===g.charAt(e)&&p.length>0&&(g=g.substring(0,e)+p[0]+g.substring(e+1),p=p.substring(1));return g}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"formatPhoneString."),""}}function formatPhoneDisplay(e,t,r){try{let s=formatPhoneString(e.val(),t,"",r);s=s.split("x")[0],s.length<t.length&&!$.isNumeric(s[s.length-1])&&(s=s.slice(0,-1)),e.val(s)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"formatPhoneDisplay")}}function formatPhoneSubmit(e,t,r,s){try{if(!e)return{success:!1,message:"Phone number input is required."};let n=formatPhoneString(e,t,r,s);if(n.includes("x")){return{success:!1,message:`Must enter a complete ${(t?t.match(/x/g):r.match(/x/g)||[]).length}-digit phone number.`}}return{success:!0,message:n}}catch(e){const t=`DIGIOH_ERROR: lightbox_builder.js -- ${e.message}`;return DLOG.tryShowError(e)&&(e.message=t,console.error(e)),BOX_CUSTOM_JS.logError(e,"formatPhoneSubmit"),{success:!1,message:"There was an internal error. Please try again later."}}}function setPrefFormInputs(e){var t,r;try{if("thx_"===e)for(pref_form_input_full_name=thx_form_input_full_name,pref_form_input_first_name=thx_form_input_first_name,pref_form_input_last_name=thx_form_input_last_name,pref_form_input_email=thx_form_input_email,pref_form_input_phone=thx_form_input_phone,pref_form_input_opt_in=thx_form_input_opt_in,r=1;r<=customFieldsLimit;r++)form_input_obj["pref_form_input_custom"+r]=form_input_obj["thx_form_input_custom"+r];else if("ep1_"===e)for(pref_form_input_full_name=ep1_form_input_full_name,pref_form_input_first_name=ep1_form_input_first_name,pref_form_input_last_name=ep1_form_input_last_name,pref_form_input_email=ep1_form_input_email,pref_form_input_phone=ep1_form_input_phone,pref_form_input_opt_in=ep1_form_input_opt_in,r=1;r<=customFieldsLimit;r++)form_input_obj["pref_form_input_custom"+r]=form_input_obj["ep1_form_input_custom"+r];else if("ep2_"===e)for(pref_form_input_full_name=ep2_form_input_full_name,pref_form_input_first_name=ep2_form_input_first_name,pref_form_input_last_name=ep2_form_input_last_name,pref_form_input_email=ep2_form_input_email,pref_form_input_phone=ep2_form_input_phone,pref_form_input_opt_in=ep2_form_input_opt_in,r=1;r<=customFieldsLimit;r++)form_input_obj["pref_form_input_custom"+r]=form_input_obj["ep2_form_input_custom"+r];else if("ep3_"===e)for(pref_form_input_full_name=ep3_form_input_full_name,pref_form_input_first_name=ep3_form_input_first_name,pref_form_input_last_name=ep3_form_input_last_name,pref_form_input_email=ep3_form_input_email,pref_form_input_phone=ep3_form_input_phone,pref_form_input_opt_in=ep3_form_input_opt_in,r=1;r<=customFieldsLimit;r++)form_input_obj["pref_form_input_custom"+r]=form_input_obj["ep3_form_input_custom"+r];else if("ep4_"===e)for(pref_form_input_full_name=ep4_form_input_full_name,pref_form_input_first_name=ep4_form_input_first_name,pref_form_input_last_name=ep4_form_input_last_name,pref_form_input_email=ep4_form_input_email,pref_form_input_phone=ep4_form_input_phone,pref_form_input_opt_in=ep4_form_input_opt_in,r=1;r<=customFieldsLimit;r++)form_input_obj["pref_form_input_custom"+r]=form_input_obj["ep4_form_input_custom"+r];else if(0===e.indexOf("ep"))for(t=DUTIL.getExtraPageNumberFromEPString(e),$("#ep"+t+"_form_input_full_name").length&&(pref_form_input_full_name=$("#ep"+t+"_form_input_full_name")),$("#ep"+t+"_form_input_first_name").length&&(pref_form_input_first_name=$("#ep"+t+"_form_input_first_name")),$("#ep"+t+"_form_input_last_name").length&&(pref_form_input_last_name=$("#ep"+t+"_form_input_last_name")),$("#ep"+t+"_form_input_email").length&&(pref_form_input_email=$("#ep"+t+"_form_input_email")),$("#ep"+t+"_form_input_phone").length&&(pref_form_input_phone=$("#ep"+t+"_form_input_phone")),$("#ep"+t+"_form_input_opt_in").length&&(pref_form_input_opt_in=$("#ep"+t+"_form_input_opt_in")),r=1;r<=customFieldsLimit;r++)form_input_obj.hasOwnProperty("ep"+t+"_form_input_custom"+r)&&(form_input_obj["pref_form_input_custom"+r]=form_input_obj["ep"+t+"_form_input_custom"+r]);else for(pref_form_input_full_name=form_input_full_name,pref_form_input_first_name=form_input_first_name,pref_form_input_last_name=form_input_last_name,pref_form_input_email=form_input_email,pref_form_input_phone=form_input_phone,pref_form_input_opt_in=form_input_opt_in,r=1;r<=customFieldsLimit;r++)form_input_obj["pref_form_input_custom"+r]=form_input_obj["form_input_custom"+r]}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"setPrefFormInputs")}}function validateForm(e,t,r,s){var n,i,o,a,l,_,g;try{if("",n=null===t||"string"!=typeof t||"main"===t?"":t,("object"!=typeof e||null===e)&&(e={}),"boolean"!=typeof r&&(r=!1),"boolean"!=typeof s&&(s=!1),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - validateForm("+n+", "+r+")"),setPrefFormInputs(n),settings.hasOwnProperty(n+"name")&&settings[n+"name"].display)if("full"==settings[n+"name"].mode){if((!e.hasOwnProperty("name")||s)&&(e.name=pref_form_input_full_name.val().trim()),!r){if(settings[n+"name"].require&&0==e.name.length)return settings[n+"name"].hasOwnProperty("error_text")&&settings[n+"name"].error_text?showError(n,"name",settings[n+"name"].error_text):showError(n,"name",settings[n+"name"].label+" is required."),!1;if(e.name.length>100)return settings[n+"name"].hasOwnProperty("error_text")&&settings[n+"name"].error_text?showError(n,"name",settings[n+"name"].error_text):showError(n,"name",settings[n+"name"].label+" must be less than 100 characters."),!1}i=getFirstLastNames(e.name),(!e.hasOwnProperty("first_name")||s)&&(e.first_name=i[0]),(!e.hasOwnProperty("last_name")||s)&&(e.last_name=i[1])}else if("first"==settings[n+"name"].mode){if((!e.hasOwnProperty("first_name")||s)&&(e.first_name=pref_form_input_first_name.val().trim()),!r){if(settings[n+"name"].require&&0==e.first_name.length)return settings[n+"name"].hasOwnProperty("error_text")&&settings[n+"name"].error_text?showError(n,"name",settings[n+"name"].error_text):showError(n,"name",settings[n+"name"].label+" is required."),!1;if(e.first_name.length>100)return settings[n+"name"].hasOwnProperty("error_text")&&settings[n+"name"].error_text?showError(n,"name",settings[n+"name"].error_text):showError(n,"name",settings[n+"name"].label+" must be less than 100 characters."),!1}(!e.hasOwnProperty("name")||s)&&(e.name=e.first_name),(!e.hasOwnProperty("last_name")||s)&&(e.last_name="")}else if("both"==settings[n+"name"].mode){if((!e.hasOwnProperty("first_name")||s)&&(e.first_name=pref_form_input_first_name.val().trim()),(!e.hasOwnProperty("last_name")||s)&&(e.last_name=pref_form_input_last_name.val().trim()),!r){if(settings[n+"name"].require&&(0==e.first_name.length||0==e.last_name.length))return settings[n+"name"].hasOwnProperty("error_text")&&settings[n+"name"].error_text?showError(n,"name",settings[n+"name"].error_text):showError(n,"name","First Name and Last Name are both required."),!1;if(e.first_name.length>100)return settings[n+"name"].hasOwnProperty("error_text")&&settings[n+"name"].error_text?showError(n,"name",settings[n+"name"].error_text):showError(n,"name","First Name must be less than 100 characters."),!1;if(e.last_name.length>100)return settings[n+"name"].hasOwnProperty("error_text")&&settings[n+"name"].error_text?showError(n,"name",settings[n+"name"].error_text):showError(n,"name","Last Name must be less than 100 characters."),!1}(!e.hasOwnProperty("name")||s)&&(e.name=getFullName(e.first_name,e.last_name))}if(settings.hasOwnProperty(n+"email")&&settings[n+"email"].display&&((!e.hasOwnProperty("email")||s)&&(e.email=pref_form_input_email.val().trim()),!r)){if(settings[n+"email"].require&&0==e.email.length)return settings[n+"email"].hasOwnProperty("error_text")&&settings[n+"email"].error_text?showError(n,"email",settings[n+"email"].error_text):showError(n,"email",settings[n+"email"].label+" is required."),!1;if(e.email.length>200)return settings[n+"email"].hasOwnProperty("error_text")&&settings[n+"email"].error_text?showError(n,"email",settings[n+"email"].error_text):showError(n,"email",settings[n+"email"].label+" must be less than 100 characters."),!1;if(!DAPI.isValidEmail(e.email)&&(e.email.length>0||0==e.email.length&&settings[n+"email"].require))return settings[n+"email"].hasOwnProperty("error_text")&&settings[n+"email"].error_text?showError(n,"email",settings[n+"email"].error_text):showError(n,"email",settings[n+"email"].label+" is in an invalid format."),!1}if(settings.hasOwnProperty(n+"phone")&&settings[n+"phone"].display){if((!e.hasOwnProperty("phone")||s)&&(e.phone=settings[n+"phone"].enable_country_code&&settings[n+"phone"].country_code?$("#"+n+"form_input_country_code").val()+pref_form_input_phone.val().trim():pref_form_input_phone.val().trim()),!boxapi.getFieldMetadata(n,"phone","phone_submit")&&settings[n+"phone"].hasOwnProperty("submit_format")&&(settings[n+"phone"].hasOwnProperty("display_format")&&settings[n+"phone"].display_format||settings[n+"phone"].enable_country_code)&&settings[n+"phone"].submit_format){e.phone;let t=formatPhoneSubmit(settings[n+"phone"].enable_country_code?e.phone:pref_form_input_phone.val().trim(),settings[n+"phone"].display_format,settings[n+"phone"].submit_format,n);if(!t.success&&!r&&settings[n+"phone"].require)return showError(n,"phone",t.message),!1;t.success&&t.message&&(e.phone=t.message)}if(!r){if(settings[n+"phone"].require&&0==e.phone.length)return settings[n+"phone"].hasOwnProperty("error_text")&&settings[n+"phone"].error_text?showError(n,"phone",settings[n+"phone"].error_text):showError(n,"phone",settings[n+"phone"].label+" is required."),!1;if(settings[n+"phone"].require&&!settings[n+"phone"].submit_format&&settings[n+"phone"].enable_country_code&&settings[n+"phone"].country_code&&(e.phone.length<8||e.phone.length>15))return settings[n+"phone"].hasOwnProperty("error_text")&&settings[n+"phone"].error_text?showError(n,"phone",settings[n+"phone"].error_text):showError(n,"phone",settings[n+"phone"].label+" must be between 8 to 15 characters."),!1;if(e.phone.length>20)return settings[n+"phone"].hasOwnProperty("error_text")&&settings[n+"phone"].error_text?showError(n,"phone",settings[n+"phone"].error_text):showError(n,"phone",settings[n+"phone"].label+" must be less than 20 characters."),!1;if(settings[n+"phone"].require&&settings[n+"phone"].hasOwnProperty("validation")&&settings[n+"phone"].validation&&e.phone.length>0){if(e.phone=e.phone.replace(/\D/g,""),"phone_10"===settings[n+"phone"].validation&&10!==e.phone.length)return settings[n+"phone"].hasOwnProperty("error_text")&&settings[n+"phone"].error_text?showError(n,"phone",settings[n+"phone"].error_text):showError(n,"phone",settings[n+"phone"].label+" must be 10 digits."),!1;if("phone_usa"===settings[n+"phone"].validation){if(10===e.phone.length&&(e.phone="1"+e.phone),11!==e.phone.length||0!==e.phone.indexOf("1"))return settings[n+"phone"].hasOwnProperty("error_text")&&settings[n+"phone"].error_text?showError(n,"phone",settings[n+"phone"].error_text):showError(n,"phone",settings[n+"phone"].label+" must be 11 digits and start with 1."),!1}else{if("phone_any"===settings[n+"phone"].validation&&11!==e.phone.length)return settings[n+"phone"].hasOwnProperty("error_text")&&settings[n+"phone"].error_text?showError(n,"phone",settings[n+"phone"].error_text):showError(n,"phone",settings[n+"phone"].label+" must be 11 digits."),!1;if("phone_eu"===settings[n+"phone"].validation){if(o=(settings[n+"phone"].submit_format.match(/x/g)||[]).length,e.phone.length!==o)return settings[n+"phone"].hasOwnProperty("error_text")&&settings[n+"phone"].error_text?showError(n,"phone",settings[n+"phone"].error_text):showError(n,"phone",settings[n+"phone"].label+" must be "+o+" digits."),!1}else if("phone_i8n"===settings[n+"phone"].validation&&(e.phone.length<8||e.phone.length>15))return settings[n+"phone"].hasOwnProperty("error_text")&&settings[n+"phone"].error_text?showError(n,"phone",settings[n+"phone"].error_text):showError(n,"phone",settings[n+"phone"].label+"  must be min 8 to max 15 digits."),!1}}}}for(a=1;a<=customFieldsLimit;a++)if(pref_form_input_customN=form_input_obj["pref_form_input_custom"+a],settings.hasOwnProperty(n+"custom"+a)&&settings[n+"custom"+a].display){if((!e.hasOwnProperty("custom_"+a)||s)&&settings[n+"custom"+a].hasOwnProperty("field_type")&&"datedrop"!==settings[n+"custom"+a].field_type&&"radio"!==settings[n+"custom"+a].field_type&&pref_form_input_customN&&pref_form_input_customN.length)pref_form_input_customN.val()&&"object"==typeof pref_form_input_customN.val()?(e["custom_"+a]=pref_form_input_customN.val().join(","),0===e["custom_"+a].indexOf(",")&&(e["custom_"+a]=e["custom_"+a].substr(1))):e["custom_"+a]=pref_form_input_customN.val();else if((!e.hasOwnProperty("custom_"+a)||s)&&settings[n+"custom"+a].hasOwnProperty("field_type")&&"radio"==settings[n+"custom"+a].field_type&&(e["custom_"+a]=$("input[name="+n+"form_input_custom"+a+"]:checked").length?$("input[name="+n+"form_input_custom"+a+"]:checked").val():"",!r&&settings[n+"custom"+a].require&&!e["custom_"+a]))return settings[n+"custom"+a].hasOwnProperty("error_text")&&settings[n+"custom"+a].error_text?showError(n,"custom"+a,settings[n+"custom"+a].error_text):showError(n,"custom"+a,settings[n+"custom"+a].label+" is required."),!1;if(!(l=evaluateCustomNCheckbox(e,n,""+a,r,LBOX.INTEGRATION_MAP,LIGHTBOX_OR_VARIATION_GUID),l&&(_=evalCustomNDatedrop(e,n,""+a,r),_)))return!1;if(!r){if(settings[n+"custom"+a].hasOwnProperty("field_type")&&"hidden"!==settings[n+"custom"+a].field_type&&"checkbox"!==settings[n+"custom"+a].field_type&&"radio"!==settings[n+"custom"+a].field_type&&"datedrop"!==settings[n+"custom"+a].field_type&&settings[n+"custom"+a].require&&0==e["custom_"+a].length)return settings[n+"custom"+a].hasOwnProperty("error_text")&&settings[n+"custom"+a].error_text?showError(n,"custom"+a,settings[n+"custom"+a].error_text):showError(n,"custom"+a,settings[n+"custom"+a].label+" is required."),!1;if(e["custom_"+a]&&e["custom_"+a].length>0&&"textarea"===settings[n+"custom"+a].field_type&&settings[n+"custom"+a].hasOwnProperty("textarea_max_length")&&settings[n+"custom"+a].textarea_max_length){let t=parseInt(settings[n+"custom"+a].textarea_max_length);if((t<=0||t>1e4)&&(t=1e3),e["custom_"+a].length>t)return showError(n,"custom"+a,settings[n+"custom"+a].label+" must be less than "+t+" characters."),!1}else if(e["custom_"+a]&&e["custom_"+a].length>5e3)return settings[n+"custom"+a].hasOwnProperty("error_text")&&settings[n+"custom"+a].error_text?showError(n,"custom"+a,settings[n+"custom"+a].error_text):showError(n,"custom"+a,settings[n+"custom"+a].label+" must be less than 5000 characters."),!1;if(settings[n+"custom"+a].hasOwnProperty("validation")&&settings[n+"custom"+a].validation&&e["custom_"+a].length>0&&("hidden"===settings[n+"custom"+a].field_type||"textbox"===settings[n+"custom"+a].field_type||"textarea"===settings[n+"custom"+a].field_type))if("email_basic"===settings[n+"custom"+a].validation){if(!DAPI.isValidEmail(e["custom_"+a]))return settings[n+"custom"+a].hasOwnProperty("error_text")&&settings[n+"custom"+a].error_text?showError(n,"custom"+a,settings[n+"custom"+a].error_text):showError(n,"custom"+a,settings[n+"custom"+a].label+" is not a valid Email."),!1}else if("phone_10"===settings[n+"custom"+a].validation){if(e["custom_"+a]=e["custom_"+a].replace(/\D/g,""),10!==e["custom_"+a].length)return settings[n+"custom"+a].hasOwnProperty("error_text")&&settings[n+"custom"+a].error_text?showError(n,"custom"+a,settings[n+"custom"+a].error_text):showError(n,"custom"+a,settings[n+"custom"+a].label+" must be 10 digits."),!1}else if("phone_usa"===settings[n+"custom"+a].validation){if(e["custom_"+a]=e["custom_"+a].replace(/\D/g,""),10===e["custom_"+a].length&&0!==e["custom_"+a].indexOf("1")&&(e["custom_"+a]="1"+e["custom_"+a]),11!==e["custom_"+a].length||0!==e["custom_"+a].indexOf("1"))return settings[n+"custom"+a].hasOwnProperty("error_text")&&settings[n+"custom"+a].error_text?showError(n,"custom"+a,settings[n+"custom"+a].error_text):showError(n,"custom"+a,settings[n+"custom"+a].label+" must be 11 digits and start with 1."),!1}else if("phone_any"===settings[n+"custom"+a].validation){if(e["custom_"+a]=e["custom_"+a].replace(/\D/g,""),11!==e["custom_"+a].length)return settings[n+"custom"+a].hasOwnProperty("error_text")&&settings[n+"custom"+a].error_text?showError(n,"custom"+a,settings[n+"custom"+a].error_text):showError(n,"custom"+a,settings[n+"custom"+a].label+" must be 11 digits."),!1}else if("phone_eu"===settings[n+"custom"+a].validation){if(e["custom_"+a]=e["custom_"+a].replace(/\D/g,""),e["custom_"+a].length<12||e["custom_"+a].length>13)return settings[n+"custom"+a].hasOwnProperty("error_text")&&settings[n+"custom"+a].error_text?showError(n,"custom"+a,settings[n+"custom"+a].error_text):showError(n,"custom"+a,settings[n+"custom"+a].label+" must be 12 or 13 digits."),!1}else if("phone_i8n"===settings[n+"custom"+a].validation&&(e["custom_"+a]=e["custom_"+a].replace(/\D/g,""),e["custom_"+a].length<8||e["custom_"+a].length>15))return settings[n+"custom"+a].hasOwnProperty("error_text")&&settings[n+"custom"+a].error_text?showError(n,"custom"+a,settings[n+"custom"+a].error_text):showError(n,"custom"+a,settings[n+"custom"+a].label+" must be min 8 to max 15 digits."),!1}}else settings.hasOwnProperty(n+"custom"+a)&&!e.hasOwnProperty("custom_"+a)&&pref_form_input_customN&&pref_form_input_customN.length?pref_form_input_customN.val()&&"object"==typeof pref_form_input_customN.val()?(e["custom_"+a]=pref_form_input_customN.val().join(","),0===e["custom_"+a].indexOf(",")&&(e["custom_"+a]=e["custom_"+a].substr(1))):e["custom_"+a]=pref_form_input_customN.val():settings.hasOwnProperty(n+"custom"+a)&&!e.hasOwnProperty("custom_"+a)&&settings[n+"custom"+a].hasOwnProperty("field_type")&&"datedrop"===settings[n+"custom"+a].field_type&&$("#"+n+"form_input_custom"+a+"_datedrop_yyyy").length&&evalCustomNDatedrop(e,n,""+a,!0);if(settings.hasOwnProperty(n+"opt_in")&&settings[n+"opt_in"].display&&((!e.hasOwnProperty("opt_in")||s)&&(e.opt_in=pref_form_input_opt_in[0].checked?"true":"false"),!r&&settings[n+"opt_in"].require&&"false"==e.opt_in))return settings[n+"opt_in"].hasOwnProperty("error_text")&&settings[n+"opt_in"].error_text?showError(n,"opt_in",settings[n+"opt_in"].error_text):showError(n,"opt_in","Checkbox is required."),!1;if(boxapi.setFormData(e),e=setFormDataLayer(n,e),DIGIOH_PRQ.isResultsPagePRQ(n))for(g in e)e.hasOwnProperty(g)&&"string"==typeof e[g]&&e[g].indexOf("[PRQ:")>=0&&(logger("replaceCustomFieldMergeTagPRQ: "+g+"="+e[g]),e[g]=DIGIOH_PRQ.replaceMergeTagsPRQ(e[g]),logger("replaceCustomFieldMergeTagPRQ: "+g+"="+e[g]));return e}catch(t){return DLOG.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),BOX_CUSTOM_JS.logError(t,"validateForm"),e}}function setFormDataLayer(e,t){var r,s,n,i,o;try{for(r=e,""!==e&&e||(r="main_"),r.indexOf("_")<0&&(r+="_"),t.hasOwnProperty("name")&&(t[r+"name"]=t.name),t.hasOwnProperty("first_name")&&(t[r+"first_name"]=t.first_name),t.hasOwnProperty("last_name")&&(t[r+"last_name"]=t.last_name),t.hasOwnProperty("email")&&(t[r+"email"]=t.email),t.hasOwnProperty("phone")&&(t[r+"phone"]=t.phone),t.hasOwnProperty("opt_in")&&(t[r+"opt_in"]=t.opt_in),o=1;o<=customFieldsLimit;o++)t.hasOwnProperty("custom_"+o)&&""!==t["custom_"+o]&&null!==t["custom_"+o]&&void 0!==t["custom_"+o]&&(t[r+"custom_"+o]=t["custom_"+o]),t.hasOwnProperty("custom_"+o)&&null!==t["custom_"+o]&&void 0!==t["custom_"+o]&&t["custom_"+o].toString().length>0?addCustomFieldToPageAnswers(e,e+"custom_"+o,t["custom_"+o].toString(),"form"):removeCustomFieldFromPageAnswers(e,e+"custom_"+o,"form");if("object"!=typeof(s=LBOX.DIGIOH_LOCAL_STORAGE.getManual("fsdbx"))||!s)return t;for(n="",i=1;i<=102;i++)if(i<=100?n="ep"+i+"_":101===i?n="thx_":102===i&&(n="main_"),n!==r)for(s.hasOwnProperty(n+"name")&&(t[n+"name"]=s[n+"name"]),s.hasOwnProperty(n+"first_name")&&(t[n+"first_name"]=s[n+"first_name"]),s.hasOwnProperty(n+"last_name")&&(t[n+"last_name"]=s[n+"last_name"]),s.hasOwnProperty(n+"email")&&(t[n+"email"]=s[n+"email"]),s.hasOwnProperty(n+"phone")&&(t[n+"phone"]=s[n+"phone"]),s.hasOwnProperty(n+"opt_in")&&(t[n+"opt_in"]=s[n+"opt_in"]),o=1;o<=customFieldsLimit;o++)s.hasOwnProperty(n+"custom_"+o)&&(t[n+"custom_"+o]=s[n+"custom_"+o]);else for(s.hasOwnProperty(n+"name")&&s[n+"name"]&&(!t.hasOwnProperty(n+"name")||!t[n+"name"])&&(t[n+"name"]=s[n+"name"]),s.hasOwnProperty(n+"first_name")&&s[n+"first_name"]&&(!t.hasOwnProperty(n+"first_name")||!t[n+"first_name"])&&(t[n+"first_name"]=s[n+"first_name"]),s.hasOwnProperty(n+"last_name")&&s[n+"last_name"]&&(!t.hasOwnProperty(n+"last_name")||!t[n+"last_name"])&&(t[n+"last_name"]=s[n+"last_name"]),s.hasOwnProperty(n+"email")&&s[n+"email"]&&(!t.hasOwnProperty(n+"email")||!t[n+"email"])&&(t[n+"email"]=s[n+"email"]),s.hasOwnProperty(n+"phone")&&s[n+"phone"]&&(!t.hasOwnProperty(n+"phone")||!t[n+"phone"])&&(t[n+"phone"]=s[n+"phone"]),s.hasOwnProperty(n+"opt_in")&&""!==s[n+"opt_in"]&&(!t.hasOwnProperty(n+"opt_in")||""==t[n+"opt_in"])&&(t[n+"opt_in"]=s[n+"opt_in"]),o=1;o<=customFieldsLimit;o++)s.hasOwnProperty(n+"custom_"+o)&&""!==s[n+"custom_"+o]&&(!t.hasOwnProperty(n+"custom_"+o)||""==t[n+"custom_"+o])&&(t[n+"custom_"+o]=s[n+"custom_"+o]);for(s.hasOwnProperty("name")&&s.name&&(!t.hasOwnProperty("name")||!t.name)&&(t.name=s.name),s.hasOwnProperty("first_name")&&s.first_name&&(!t.hasOwnProperty("first_name")||!t.first_name)&&(t.first_name=s.first_name),s.hasOwnProperty("last_name")&&s.last_name&&(!t.hasOwnProperty("last_name")||!t.last_name)&&(t.last_name=s.last_name),s.hasOwnProperty("email")&&s.email&&(!t.hasOwnProperty("email")||!t.email)&&(t.email=s.email),s.hasOwnProperty("phone")&&s.phone&&(!t.hasOwnProperty("phone")||!t.phone)&&(t.phone=s.phone),s.hasOwnProperty("opt_in")&&""!==s.opt_in&&(!t.hasOwnProperty("opt_in")||""==t.opt_in)&&(t.opt_in=s.opt_in),o=1;o<=customFieldsLimit;o++)s.hasOwnProperty("custom_"+o)&&""!==s["custom_"+o]&&(!t.hasOwnProperty("custom_"+o)||""==t["custom_"+o])&&(t["custom_"+o]=s["custom_"+o]);return t}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"setFormDataLayer"),t}}function evalCustomNDatedrop(e,t,r,s){var n,i,o,a,l;try{if(settings[n=t+"custom"+r].hasOwnProperty("field_type")&&"datedrop"===settings[n].field_type){var _=$("#"+t+"form_input_custom"+r+"_datedrop_yyyy").val(),g=$("#"+t+"form_input_custom"+r+"_datedrop_mm").val(),p=$("#"+t+"form_input_custom"+r+"_datedrop_dd").val(),u="";u=settings[n].datedrop.custom_format&&!UTIL.isNullOrWhitespace(settings[n].datedrop.custom_format)?settings[n].datedrop.custom_format:settings[n].datedrop.output_format?settings[n].datedrop.output_format:"MM-dd-yyyy",i="",u.indexOf("-")>0&&u.indexOf("-")<=7?i="-":u.indexOf("/")>0&&u.indexOf("/")<=7?i="/":u.indexOf(".")>0&&u.indexOf(".")<=7&&(i=".");var m="MM",d="dd",h="yyyy",c=u.split(i);for(o=0;o<c.length;o++)UTIL.stringOrArrayContains(c[o],"M")?m=c[o]:UTIL.stringOrArrayContains(c[o],"d")?d=c[o]:UTIL.stringOrArrayContains(c[o],"y")&&(h=c[o]);if(UTIL.stringOrArrayContains(u,"MM")&&1==g.length?g="0"+g:!UTIL.stringOrArrayContains(u,"MM")&&UTIL.stringOrArrayContains(u,"M")&&2==g.length&&0===g.indexOf("0")?g=g.substring(1):0==g.length&&(g="MM"),UTIL.stringOrArrayContains(u,"dd")&&1==p.length?p="0"+p:!UTIL.stringOrArrayContains(u,"dd")&&UTIL.stringOrArrayContains(u,"d")&&2==p.length&&0===p.indexOf("0")?p=p.substring(1):0==p.length&&(p="dd"),!UTIL.stringOrArrayContains(u,"yyyy")&&UTIL.stringOrArrayContains(u,"yy")&&(4==_.length&&(_=_.substring(2)),0==_.length&&(_="yy")),a=!1,""!==g&&"mm"!==g.toLowerCase()&&""!==p&&"dd"!==p.toLowerCase()&&""!==_&&"yyyy"!==_.toLowerCase()&&"yy"!==_.toLowerCase()&&"y"!==_.toLowerCase()&&(a=!0),l="",a||settings[n].require?u==m+i+d+i+h?(e["custom_"+r]=g+i+p+i+_,l="1"):u==d+i+m+i+h?(e["custom_"+r]=p+i+g+i+_,l="2"):u==h+i+m+i+d?(e["custom_"+r]=_+i+g+i+p,l="3"):(e["custom_"+r]=$("#"+t+"form_input_custom"+r+"_datedrop_mm").val()+"-"+$("#"+t+"form_input_custom"+r+"_datedrop_dd").val()+"-"+$("#"+t+"form_input_custom"+r+"_datedrop_yyyy").val(),l="4"):(e["custom_"+r]="",l="0"),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - evalCustomNDatedrop: "+e["custom_"+r]+" (case "+l+")"),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - output_format="+u+", mm_format="+m+", dd_format="+d+", yyyy_format="+h+", sep="+i),!s){if(settings[n].require&&(!g||"mm"==g.toLowerCase()||"m"==g.toLowerCase())||settings[n].require&&(!p||"dd"==p.toLowerCase()||"d"==p.toLowerCase())||settings[n].require&&(!_||"yyyy"==_.toLowerCase()||"yy"==_.toLowerCase()||"y"==_.toLowerCase()))return settings[n].require?settings[n].hasOwnProperty("error_text")&&settings[n].error_text?showError(t,"custom"+r,settings[n].error_text):showError(t,"custom"+r,settings[n].label+" is required."):settings[n].hasOwnProperty("error_text")&&settings[n].error_text?showError(t,"custom"+r,settings[n].error_text):showError(t,"custom"+r,settings[n].label+" invalid date."),!1;if(a){if(settings[n].datedrop.min_age){var f=(new Date).getFullYear(),O=parseInt($("#"+t+"form_input_custom"+r+"_datedrop_yyyy").val()),y=parseInt(settings[n].datedrop.min_age);if(f-O<y)return settings[n].hasOwnProperty("error_text")&&settings[n].error_text?showError(t,"custom"+r,settings[n].error_text):showError(t,"custom"+r,"You must be "+y+" years old."),!1}if(settings[n].datedrop.max_age){f=(new Date).getFullYear(),O=parseInt($("#"+t+"form_input_custom"+r+"_datedrop_yyyy").val());var b=parseInt(settings[n].datedrop.max_age);if(f-O>b)return settings[n].hasOwnProperty("error_text")&&settings[n].error_text?showError(t,"custom"+r,settings[n].error_text):showError(t,"custom"+r,"You are over "+b+" years old."),!1}}}}return!0}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"evalCustomNDatedrop"),!1}}function evaluateCustomNCheckbox(e,t,r,s){var n,i;try{return!(settings[n=t+"custom"+r].hasOwnProperty("field_type")&&"checkbox"===settings[n].field_type&&(i=document.getElementById(t+"form_input_custom"+r),i&&i.checked?(e["custom_"+r]="string"==typeof settings[n].checkbox.checkedval?"[BLANK]"===settings[n].checkbox.checkedval?"":""===settings[n].checkbox.checkedval?"true":settings[n].checkbox.checkedval:"true",settings[n].checkbox.integration_id&&boxapi.addBoxIntegration(settings[n].checkbox.integration_id)):(e["custom_"+r]="string"==typeof settings[n].checkbox.uncheckedval?"[BLANK]"===settings[n].checkbox.uncheckedval?"":""===settings[n].checkbox.uncheckedval?"false":settings[n].checkbox.uncheckedval:"false",settings[n].checkbox.integration_id&&boxapi.removeBoxIntegration(settings[n].checkbox.integration_id)),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - evaluateCustomNCheckbox(custom_"+r+") ==> "+e["custom_"+r]),!s&&settings[n].require&&!i.checked))||(settings[n].hasOwnProperty("error_text")&&settings[n].error_text?showError(t,"custom"+r,settings[n].error_text):showError(t,"custom"+r,settings[n].label+" is required."),!1)}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"evaluateCustomNCheckbox"),!1}}function showError(e,t,r){var s,n,i;if(autoClose=!0,boxapi.findMetadata&&(s=boxapi.findMetadata("auto_close_error_message")).length>0)for(n=0;n<s.length&&(autoClose=s[n].mdVal,"box"!=s[n].mdLevel);n++);"string"==typeof e&&void 0===t&&void 0===r&&(settings.layout.width,settings.fullscreen&&settings.fullscreen.use?(i=window.innerWidth-90,error_bubble.css("width",i+"px")):CURRENT_WIDTH&&(CURRENT_WIDTH,error_bubble.width(CURRENT_WIDTH-90)),error_message.html(e),error_bubble.show(),$(document).trigger("BOX_SHOW_ERROR",[e,t,r]),$("#error_message").attr("role","status"),wasErrorBubbleAlreadyClosed=!1,autoClose&&window.setTimeout((function(){error_bubble.hide(),wasErrorBubbleAlreadyClosed||(wasErrorBubbleAlreadyClosed=!0,$(document).trigger("BOX_CLOSE_ERROR",[e,t,r]),$("#error_message").removeAttr("role"))}),4e3),!settings[e+"inputs"]||settings[e+"inputs"].error_position.indexOf("top_and_inline")<0)||(e=DUTIL.getUnfriendlyPagePrefix(e),(!t||""===t||!settings.hasOwnProperty(e+t)||!settings[e+"inputs"].hasOwnProperty("error_position")||settings[e+"inputs"].error_position.indexOf("top")>=0||settings[e+"inputs"].error_position.indexOf("top_and_inline")>=0)&&(settings.layout.width,settings.fullscreen&&settings.fullscreen.use?(i=window.innerWidth-90,error_bubble.css("width",i+"px")):CURRENT_WIDTH&&(CURRENT_WIDTH,error_bubble.width(CURRENT_WIDTH-90)),error_message.html(r),error_bubble.show(),$(document).trigger("BOX_SHOW_ERROR",[e,t,r]),$("#error_message").attr("role","status"),wasErrorBubbleAlreadyClosed=!1,autoClose&&window.setTimeout((function(){error_bubble.hide(),wasErrorBubbleAlreadyClosed||(wasErrorBubbleAlreadyClosed=!0,$(document).trigger("BOX_CLOSE_ERROR",[e,t,r]),$("#error_message").removeAttr("role"))}),4e3),!settings[e+"inputs"]||settings[e+"inputs"].error_position.indexOf("top_and_inline")<0))||(""!==t&&settings[e+"inputs"].hasOwnProperty("error_position")&&settings[e+"inputs"].error_position.indexOf("inline")>=0||settings[e+"inputs"].error_position.indexOf("top_and_inline"))&&(showInlineError(e,t,r),$(document).trigger("BOX_SHOW_ERROR",[e,t,r]),$("#error_message").attr("role","status"),wasErrorBubbleAlreadyClosed=!1)}function showSuccess(e){if(autoClose=!0,"string"==typeof e){if(settings.fullscreen&&settings.fullscreen.use){var t=window.innerWidth-90;success_bubble.css("width",t+"px")}else CURRENT_WIDTH&&success_bubble.width(CURRENT_WIDTH-90);return success_message.html(e),success_bubble.show(),success_message.attr("role","status"),wasSuccessBubbleAlreadyClosed=!1,void(autoClose&&window.setTimeout((function(){success_bubble.hide(),wasSuccessBubbleAlreadyClosed||(wasSuccessBubbleAlreadyClosed=!0,success_message.removeAttr("role"))}),4e3))}}function showWarning(e){if(autoClose=!0,"string"==typeof e){if(settings.fullscreen&&settings.fullscreen.use){var t=window.innerWidth-90;warning_bubble.css("width",t+"px")}else CURRENT_WIDTH&&warning_bubble.width(CURRENT_WIDTH-90);return warning_message.html(e),warning_bubble.show(),warning_message.attr("role","status"),wasWarningBubbleAlreadyClosed=!1,void(autoClose&&window.setTimeout((function(){warning_bubble.hide(),wasWarningBubbleAlreadyClosed||(wasWarningBubbleAlreadyClosed=!0,warning_message.removeAttr("role"))}),4e3))}}function showInlineError(e,t,r){e=DUTIL.getUnfriendlyPagePrefix(e),"name"===t||t.indexOf("_name")>0?($("#"+e+"form_input_full_name_help").length&&$("#"+e+"form_input_full_name_help").hide(),$("#"+e+"form_input_first_name_help").length&&$("#"+e+"form_input_first_name_help").hide(),$("#"+e+"form_input_last_name_help").length&&$("#"+e+"form_input_last_name_help").hide(),$("#"+e+"form_input_name_error_text").html(r).show(),$("#"+e+"form_input_full_name,#"+e+"form_input_first_name,#"+e+"form_input_last_name").addClass(e+"form_inputs_error"),$("#"+e+"form_input_full_name,#"+e+"form_input_first_name,#"+e+"form_input_last_name").focus((function(){$("#"+e+"form_input_name_error_text").hide(),$("#"+e+"form_input_full_name,#"+e+"form_input_first_name,#"+e+"form_input_last_name").removeClass(e+"form_inputs_error"),settings[e+"name"].display_help&&($("#"+e+"form_input_full_name_help").length&&$("#"+e+"form_input_full_name_help").show(),$("#"+e+"form_input_first_name_help").length&&$("#"+e+"form_input_first_name_help").show(),$("#"+e+"form_input_last_name_help").length&&$("#"+e+"form_input_last_name_help").show())}))):"email"===t?($("#"+e+"form_input_email_help").length&&$("#"+e+"form_input_email_help").hide(),$("#"+e+"form_input_email_error_text").html(r).show(),$("#"+e+"form_input_email").addClass(e+"form_inputs_error"),$("#"+e+"form_input_email").focus((function(){$("#"+e+"form_input_email_error_text").hide(),$("#"+e+"form_input_email").removeClass(e+"form_inputs_error"),settings[e+"email"].display_help&&$("#"+e+"form_input_email_help").length&&$("#"+e+"form_input_email_help").show()}))):"phone"===t?($("#"+e+"form_input_phone_help").length&&$("#"+e+"form_input_phone_help").hide(),$("#"+e+"form_input_phone_error_text").html(r).show(),$("#"+e+"form_input_phone").addClass(e+"form_inputs_error"),$("#"+e+"form_input_country_code").addClass(e+"form_inputs_error"),$("#"+e+"form_input_phone").focus((function(){$("#"+e+"form_input_phone_error_text").hide(),$("#"+e+"form_input_phone").removeClass(e+"form_inputs_error"),$("#"+e+"form_input_country_code").removeClass(e+"form_inputs_error"),settings[e+"phone"].display_help&&$("#"+e+"form_input_phone_help").length&&$("#"+e+"form_input_phone_help").show()}))):"opt_in"===t?($("#"+e+"form_input_opt_in_error_text").html(r).show(),$("#"+e+"form_input_opt_in").change((function(){$("#"+e+"form_input_opt_in_error_text").hide()}))):0===t.indexOf("custom")&&($("#"+e+"form_input_"+t+"_help").length&&$("#"+e+"form_input_"+t+"_help").hide(),$("#"+e+"form_input_"+t+"_error_text").html(r).show(),"checkbox"===settings[e+t].field_type?$("#"+e+"form_input_"+t).change((function(){$("#"+e+"form_input_"+t+"_error_text").hide()})):"radio"===settings[e+t].field_type?$("#"+e+"form_input_"+t+"_radio_wrapper input[type=radio]").change((function(){$("#"+e+"form_input_"+t+"_error_text").hide()})):"datedrop"===settings[e+t].field_type?($("#"+e+"form_input_"+t+"_wrapper ."+e+"form_inputs").addClass(e+"form_inputs_error"),$("#"+e+"form_input_"+t+"_wrapper ."+e+"form_inputs").focus((function(){$("#"+e+"form_input_"+t+"_error_text").hide(),$("#"+e+"form_input_"+t+"_wrapper ."+e+"form_inputs").removeClass(e+"form_inputs_error"),settings[e+t].display_help&&$("#"+e+"form_input_"+t+"_wrapper ."+e+"form_inputs_help").show()}))):($("#"+e+"form_input_"+t).addClass(e+"form_inputs_error"),$("#"+e+"form_input_"+t).focus((function(){$("#"+e+"form_input_"+t+"_error_text").hide(),$("#"+e+"form_input_"+t).removeClass(e+"form_inputs_error"),settings[e+t].display_help&&$("#"+e+"form_input_"+t+"_help").length&&$("#"+e+"form_input_"+t+"_help").show()}))))}function checkReCaptchaOnSubmit(){return new Promise(((t,r)=>{if(DAPI.isCaptchaEnabled(LIGHTBOX_GUID))if(DAPI.isReCaptchaSolved){if(DAPI.isReCaptchaTested)return DAPI.isReCaptchaValid&&DAPI.isReCaptchaSolved&&t(),void r("Captcha is not valid");try{$.ajax({dataType:"json",url:SUBMIT_BASE_URL+"/Keen/ReCaptchaCheck",success:function(e){e&&"object"==typeof e&&null!==e&&e.hasOwnProperty("success")&&e.success?(logger("(BOX #"+LIGHTBOX_SHORT_ID+") - checkReCaptchaOnSubmit: SUCCESS ==>"),logger(e),DAPI.isReCaptchaTested=!0,DAPI.isReCaptchaValid=!0,processSubmitLock=!1,t()):(logger("(BOX #"+LIGHTBOX_SHORT_ID+") - checkReCaptchaOnSubmit: FAILURE 1 ==>"),logger(e),DAPI.isReCaptchaTested=!0,DAPI.isReCaptchaValid=!1,processSubmitLock=!1,r("checkReCaptchaOnSubmit: FAILURE 1"))},error:function(t,s,n){logger("(BOX #"+LIGHTBOX_SHORT_ID+") - checkReCaptchaOnSubmit: FAILURE 2 ==>"),logger(s),DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(n,"checkReCaptchaOnSubmit"),DAPI.isReCaptchaTested=!0,DAPI.isReCaptchaValid=!1,processSubmitLock=!1,r("checkReCaptchaOnSubmit: FAILURE 2")}})}catch(e){logger("(BOX #"+LIGHTBOX_SHORT_ID+") - checkReCaptchaOnSubmit: FAILURE 3 ==>"),logger(e.message),DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"checkReCaptchaOnSubmit"),DAPI.isReCaptchaTested=!0,DAPI.isReCaptchaValid=!1,processSubmitLock=!1,r("checkReCaptchaOnSubmit: FAILURE 3")}}else r("Captcha not checked");else t()}))}function processSubmit(e,t,r,s){try{"string"!=typeof e&&(e=CURRENT_PAGE),"boolean"!=typeof t&&(t=!1),"boolean"!=typeof r&&(r=!1),"boolean"!=typeof s&&(s=!0)}catch(n){e=CURRENT_PAGE,t=!1,r=!1,s=!0}return processSubmitObj({pageName:e,hideLoadingSpinner:t,bypassCoupons:r,useSubmitLock:s})}function processSubmitObj(e){var t,r,s,n,i,o,a=CURRENT_PAGE;return("object"!=typeof e||null===e)&&(e={}),e&&e.hasOwnProperty("pageName")&&"string"==typeof e.pageName&&(a=e.pageName),t=!1,e&&e.hasOwnProperty("hideLoadingSpinner")&&"boolean"==typeof e.hideLoadingSpinner&&(t=e.hideLoadingSpinner),!1,e&&e.hasOwnProperty("bypassCoupons")&&"boolean"==typeof e.bypassCoupons&&e.bypassCoupons,r=!0,e&&e.hasOwnProperty("useSubmitLock")&&"boolean"==typeof e.useSubmitLock&&(r=e.useSubmitLock),s="",e&&e.hasOwnProperty("overrideFormSubmitAction")&&"string"==typeof e.overrideFormSubmitAction&&(s=e.overrideFormSubmitAction),!a.startsWith("ep")&&"thx"!==a||a.endsWith("_")?"main"===a&&(a=""):a+="_",n=settings[a+"form"],i="",n&&(i=n.after_submit),o=new Promise(((o,l)=>{if(void 0!==r&&r){if(processSubmitLock)return logger("processSubmitLock"),l(new Error("Submit lock is active")),!1;processSubmitLock=!0,setTimeout((function(){processSubmitLock=!1}),1e3)}else r=!1;checkReCaptchaOnSubmit(e).then((()=>checkCouponsOnSubmit(e))).then((function(){var r,_,g,p,u,m,d,h,c,f,O,y,b=!1;if(using_form&&""===a||using_form_thx&&"thx_"===a||using_form_ep1&&"ep1_"===a||using_form_ep2&&"ep2_"===a||using_form_ep3&&"ep3_"===a||using_form_ep4&&"ep4_"===a||0===a.indexOf("ep")){if(0===a.indexOf("ep")&&(r=DUTIL.getExtraPageNumberFromEPString(a),!settings.hasOwnProperty("ep"+r+"layout")||!settings.hasOwnProperty("ep"+r+"_form")||!settings["ep"+r+"_form"].display))return void o(!0);settings.hasOwnProperty(a+"form")&&settings[a+"form"].hasOwnProperty("override_integration")&&"other"===settings[a+"form"].override_integration&&settings[a+"form"].hasOwnProperty("override_integration_choices")&&settings[a+"form"].override_integration_choices?(LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]=settings[a+"form"].override_integration_choices+",override",logger("processSubmitObj: pref="+a+", override_integration="+settings[a+"form"].override_integration)):settings.hasOwnProperty(a+"form")&&settings[a+"form"].hasOwnProperty("override_integration")&&"skip"===settings[a+"form"].override_integration||settings.hasOwnProperty(a+"form")&&!settings[a+"form"].hasOwnProperty("override_integration")&&DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()&&!DIGIOH_PRQ.isResultsPagePRQ(a)?(LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]="0",b=!0,logger("processSubmitObj: pref="+a+", override_integration="+settings[a+"form"].override_integration)):LBOX.INTEGRATION_MAP.hasOwnProperty(LIGHTBOX_OR_VARIATION_GUID)&&((LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID].toString().indexOf("override")>=0||"0"===LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID])&&delete LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID],logger("processSubmitObj: pref="+a+", override_integration=run_all")),DIGIOH_PRQ.isResultsPagePRQ(a)&&LBOX.INTEGRATION_MAP.hasOwnProperty(LIGHTBOX_OR_VARIATION_GUID)&&LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID].indexOf("[PRQ:")>=0&&(logger("replaceIntegrationMapMergeTagPRQ: "+LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]),LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]=DIGIOH_PRQ.replaceMergeTagsPRQ(LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]),logger("replaceIntegrationMapMergeTagPRQ: "+LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]));var w="",P=validateForm({},a,!0,!0),x=BOX_CUSTOM_JS.runCustomJsBeforeFormValidation(P);if("boolean"==typeof x&&!1===x)return l(new Error("BeforeFormValidation Failed")),!1;if("string"==typeof x&&x.trim().length>0)return showError("","",x),l(new Error("BeforeFormValidation Failed")),!1;if("boolean"==typeof(w="object"==typeof x&&null!==x?x:validateForm({},a,!1,!0))&&!1===w&&l(new Error("Native Form Validation Failed")),logger("data_with_validation ==>"),logger(w),"object"==typeof w&&null!==w){if(_=BOX_CUSTOM_JS.runCustomJsAfterFormValidation(w),logger("customJsResAfterFormValidation ==>"),logger(_),"boolean"==typeof _&&!1===_)return l(new Error("AfterFormValidation Failed")),!1;if("string"==typeof _&&_.trim().length>0)return showError("","",_),l(new Error("AfterFormValidation Failed : "+_)),!1;"object"==typeof _&&null!==_&&(w=_),g=w,("boolean"!=typeof t||!1===t)&&showLoading(a),p="";try{for(u in g)g.hasOwnProperty(u)&&(m=UTIL.getCleanQueryStringValue(g[u]),0===u.indexOf("custom_")?(c=a+"custom"+u.split("_")[1],f="_c"+u.split("_")[1],settings.hasOwnProperty(c)&&settings[c].display&&settings[c].hasOwnProperty("label")&&""!==settings[c].label?(p+=f.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"=",p+=settings[c].label.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"|",p+=m):(settings.hasOwnProperty(c)&&settings[c].display||"&"!==m)&&(p+=f.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"=",p+="Custom Field "+u.split("_")[1]+"|",p+=m)):u.indexOf("_custom_")>0&&(0===u.indexOf("main_")||0===u.indexOf("thx_")||0===u.indexOf("ep"))?(d="",h="",0===u.indexOf("main_")?(d="",h="Main Page"):0===u.indexOf("thx_")?(d="thx_",h="Thank You Page"):0===u.indexOf("ep")&&(d="ep"+DUTIL.getExtraPageNumberFromEPString(u)+"_",h="Extra Page "+DUTIL.getExtraPageNumberFromEPString(u)),c=d+"custom"+u.split("_")[2],f="_"+u.split("_")[0]+"_"+u.split("_")[2],settings.hasOwnProperty(c)&&settings[c].display&&settings[c].hasOwnProperty("label")&&""!==settings[c].label?(p+=f.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"=",p+=settings[c].label.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"|",p+=m):(settings.hasOwnProperty(c)&&settings[c].display||"&"!==m)&&(p+=f.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"=",p+=h+" Custom Field "+u.split("_")[2]+"|",p+=m)):(f=u,"email"==u?f="_e":"name"==u?f="_n":"first_name"==u?f="_fn":"last_name"==u?f="_ln":"phone"==u?f="_p":"opt_in"==u?f="_oi":(0===u.indexOf("main_")||0===u.indexOf("thx_")||0===u.indexOf("ep")&&u.indexOf("_")>0)&&(f="_"+u),p+=f.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"=",p+=m))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"processSubmitObj_query"),l(e)}if("boolean"==typeof(O=BOX_CUSTOM_JS.runCustomJsBeforeSubmit(g))&&!1===O)return l(new Error("customJsBeforeSubmit false")),!1;if("string"==typeof O&&O.trim().length>0)return showError("","",O),l(new Error("customJsBeforeSubmit Failed")),!1;if("object"==typeof O&&null!==O&&(g=O),b?o():postSubmissionResolution.push({resolve:o,reject:l}),""===a)postMessageSubmit(g,p+="_pg=main",using_form,a,b);else if(a.indexOf("_")>0){switch(p+="_pg="+a.split("_")[0],a){case"thx_":using_form=using_form_thx;break;case"ep1_":using_form=using_form_ep1;break;case"ep2_":using_form=using_form_ep2;break;case"ep3_":using_form=using_form_ep3;break;case"ep4_":using_form=using_form_ep4;break;default:if(0===a.indexOf("ep")){let e=DUTIL.getExtraPageNumberFromEPString(a);using_form=settings.hasOwnProperty("ep"+e+"layout")&&settings.hasOwnProperty("ep"+e+"_form")&&settings["ep"+e+"_form"].display}}void 0!==using_form&&postMessageSubmit(g,p,using_form,a,b)}else postMessageSubmit(g,p+="_pg="+a,using_form,a,b);if("boolean"==typeof(y=BOX_CUSTOM_JS.runCustomJsAfterSubmit(g))&&!1===y)return l(new Error("AfterFormSubmit Failed")),!1;e&&e.hasOwnProperty("resetBox")&&e.resetBox&&resetBox(),n&&"lightbox_open"==i&&n.lightbox_open&&n.lightbox_open.length>0?window.setTimeout((function(){hideLoading();var e={};e.lightbox_open=n.lightbox_open,postMessageOpenAnotherBox(e,"form")}),50):"redirect"!=i&&afterSubmit(a,s)}}else o("nothing to submit")})).catch((e=>{l(e)}))})),"redirect"===i&&o.then((()=>{afterSubmit(a,s)})),submissionPromises.push(o),o.catch((e=>{if(DLOG.tryShowError(e))if("object"==typeof e&&null!==e)e.message="Submission failed due to ==> "+(e.message||JSON.stringify(e)),console.log(e.message);else{let t="Submission failed due to ==> "+e;console.log(t)}else DLOG.tryShowError("Submission failed due to ==> "+("object"==typeof e&&null!==e?e.message:e));BOX_CUSTOM_JS.logError(e,"submission failed")})),o}function afterSubmit(e,t){var r,s,n;try{"string"!=typeof t&&(t=""),r=settings[e+"form"].after_submit,t.length>4&&(r=t),logger("afterSubmit_submitAction: pref="+e+", action="+r),"main_page"===r?window.setTimeout((function(){hideLoading(),changePages("","form",settings.form,"form",!1)}),400):"thank_you_page"===r?window.setTimeout((function(){hideLoading(),changePages("thx_",e+"form",settings[e+"form"],"form",!1)}),400):0===r.indexOf("extra_page_")?(s=r.replace("extra_page_",""),window.setTimeout((function(){hideLoading(),changePages("ep"+s+"_",e+"form",settings[e+"form"],"form",!1)}),300)):"redirect"==r&&settings[e+"form"].redirect_url?(hideLoading(),(n={}).url=0===settings[e+"form"].redirect_url.toLowerCase().trim().indexOf("http")||0===settings[e+"form"].redirect_url.toLowerCase().trim().indexOf("mailto")?settings[e+"form"].redirect_url:"http://"+settings[e+"form"].redirect_url,n.redirect_type=settings[e+"form"].hasOwnProperty("redirect_type")&&settings[e+"form"].redirect_type?settings[e+"form"].redirect_type:"current",postMessageRedirectParent(n,"form")):"close"==r?window.setTimeout((function(){hideLoading(),postMessageCloseBox("form_submit")}),400):"nothing"==r?window.setTimeout((function(){hideLoading()}),400):window.setTimeout((function(){hideLoading(),postMessageCloseBox("form_submit")}),400)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"afterSubmit")}}function changePages(e,t,r,s,n=!0){var i,o,a;try{if(logger("changePages: "+e),"branch"!==s&&r&&"back"!==r.action&&("none"!==(i=getPageBranchingAction(CURRENT_PAGE,"eval_after"))&&DUTIL.getPlainPref(i)!=DUTIL.getPlainPref(e)))return logger("pageBranchAfterDisplay="+i+", curr="+CURRENT_PAGE+", next="+e),void changePages(i,t,r,"branch");if("none"!==(o=getPageBranchingAction(e,"eval_before"))&&DUTIL.getPlainPref(o)!=DUTIL.getPlainPref(e)&&r&&"back"!==r.action)return logger("pageBranchBeforeDisplay="+o+", curr="+CURRENT_PAGE+", next="+e),void changePages(o,t,r,"branch");DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()?(logger("changePages: isResultsPage="+(a=DIGIOH_PRQ.isResultsPagePRQ(e))),DIGIOH_PRQ.HasResultsLoaded?changePagesMiddle(e,t,r,s,a,n):(DIGIOH_PRQ.HasResultsLoaded=!0,a&&showLoading(),DIGIOH_PRQ.loadProductData((function(i){hideLoading(),i||showError("Unable to load Quiz Data.  Please make sure your sheet is valid: "+arrayFilePRQURL),changePagesMiddle(e,t,r,s,a,n)})))):(logger("changePages: DIGIOH_PRQ.USE="+DIGIOH_PRQ.USE+", DIGIOH_PRQ.isBoxPRQ()="+DIGIOH_PRQ.isBoxPRQ()),changePagesMiddle(e,t,r,s,!1))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"changePages")}}function changePagesMiddle(e,t,r,s,n,i=!0){var o,a,l,_;try{if(i&&deselectButtonsOnPage(e),o=JSON.parse(JSON.stringify(PageAnswers)),i&&removeJumpedPagesFromPageAnswers(e),logger("changePagesMiddle: "+e),logger("is_prq_results_page: "+n),logger("PageAnswers: "+JSON.stringify(PageAnswers)),a={},DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ())if(l=boxapi.getPageMetadata(e,"skip_calc_results"))logger("calcResultsPRQ: "+e+" | skipping due to page metadata skip_calc_results="+l);else if(a=DIGIOH_PRQ.calcResultsPRQ(),n&&(localStorage.setItem("prq_results",JSON.stringify({page:DUTIL.getPlainPref(e),answers:PageAnswers,pageview_sequence:PageViewSequence})),a&&a.action&&"extra_page"==a.action&&a.extra_page&&e!=a.extra_page))return logger("DIGIOH_PRQ.calcResultsPRQ() ==> action_override="+a.extra_page+", curr="+CURRENT_PAGE+", next="+e),void changePages(a.extra_page,t,r,"outcome.results.extra_page");if("boolean"==typeof(_=BOX_CUSTOM_JS.runCustomJsBeforeChangePages(DUTIL.getFriendlyPagePrefix(CURRENT_PAGE),DUTIL.getFriendlyPagePrefix(e),t,r,s))&&!1===_)return PageAnswers=JSON.parse(JSON.stringify(o)),!1;"back_btn"!==s&&PageViewSequence.length>0&&PageViewSequence[PageViewSequence.length-1]!==DUTIL.getPlainPref(e)&&PageViewSequence.push(DUTIL.getPlainPref(e)),0===CURRENT_WIDTH&&(CURRENT_WIDTH=settings.layout.width),0===CURRENT_HEIGHT&&(CURRENT_HEIGHT=settings.layout.height),DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()&&(DIGIOH_PRQ.trackPrqAnswer(CURRENT_PAGE),DIGIOH_PRQ.trackPrqPage(e)),n&&(DIGIOH_PRQ.trackPrqResult(e),DIGIOH_PRQ.buildTextPRQ(e),DIGIOH_PRQ.buildImagePRQ(e),DIGIOH_PRQ.buildHTMLPRQ(e),DIGIOH_PRQ.buildButtonPRQ(e),DIGIOH_PRQ.buildFormPRQ(e)),changePagesFinish(e,t,r,s,n,a)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"changePagesMiddle")}}function changePagesFinish(e,t,r,s,n,i){var o,a,l,_,g,p;try{e=DUTIL.getUnfriendlyPagePrefix(e);var u=CURRENT_PAGE,m=0,d=0;if("thx_"===e&&settings.hasOwnProperty("thxlayout")?(m=settings.thxlayout.width,d=settings.thxlayout.height,CURRENT_PAGE="thx",buildStyles("thx",!0),loadImages("thx",!0),loadExternalFonts("thx",!0),replaceSettingsObjFormMergeTagsAfterChangePages("thx")):"ep1_"===e&&settings.hasOwnProperty("ep1layout")?(m=settings.ep1layout.width,d=settings.ep1layout.height,CURRENT_PAGE="ep1",buildStyles("ep1",!0),loadImages("ep1",!0),loadExternalFonts("ep1",!0),replaceSettingsObjFormMergeTagsAfterChangePages("ep1")):"ep2_"===e&&settings.hasOwnProperty("ep2layout")?(m=settings.ep2layout.width,d=settings.ep2layout.height,CURRENT_PAGE="ep2",buildStyles("ep2",!0),loadImages("ep2",!0),loadExternalFonts("ep2",!0),replaceSettingsObjFormMergeTagsAfterChangePages("ep2")):"ep3_"===e&&settings.hasOwnProperty("ep3layout")?(m=settings.ep3layout.width,d=settings.ep3layout.height,CURRENT_PAGE="ep3",buildStyles("ep3",!0),loadImages("ep3",!0),loadExternalFonts("ep3",!0),replaceSettingsObjFormMergeTagsAfterChangePages("ep3")):"ep4_"===e&&settings.hasOwnProperty("ep4layout")?(m=settings.ep4layout.width,d=settings.ep4layout.height,CURRENT_PAGE="ep4",buildStyles("ep4",!0),loadImages("ep4",!0),loadExternalFonts("ep4",!0),replaceSettingsObjFormMergeTagsAfterChangePages("ep4")):0===e.indexOf("ep")?(o=DUTIL.getExtraPageNumberFromEPString(e),settings.hasOwnProperty("ep"+o+"layout")&&(m=settings["ep"+o+"layout"].width,d=settings["ep"+o+"layout"].height,CURRENT_PAGE="ep"+o,buildStyles("ep"+o,!0),loadImages("ep"+o,!0),loadExternalFonts("ep"+o,!0),replaceSettingsObjFormMergeTagsAfterChangePages("ep"+o))):(m=settings.layout.width,d=settings.layout.height,CURRENT_PAGE="main",buildStyles("",!0),loadImages("",!0),loadExternalFonts("",!0),replaceSettingsObjFormMergeTagsAfterChangePages("")),a="responsive","main"!==CURRENT_PAGE&&(a=CURRENT_PAGE+a),settings.hasOwnProperty(a)&&settings[a].use||(CURRENT_WIDTH=m,CURRENT_HEIGHT=d),l=!1,settings.hasOwnProperty(DUTIL.getPlainPref(e)+"responsive")&&settings[DUTIL.getPlainPref(e)+"responsive"].use&&(l=!0),"inline"===WIDGET_TYPE&&l&&postMessageChangePages(e,m,d,CURRENT_WIDTH,CURRENT_HEIGHT,DUTIL.getFriendlyPagePrefix(u),DUTIL.getFriendlyPagePrefix(e),t,r,s),setTimeout((function(){var n,i;if("inline"===WIDGET_TYPE&&l||postMessageChangePages(e,m,d,CURRENT_WIDTH,CURRENT_HEIGHT,DUTIL.getFriendlyPagePrefix(u),DUTIL.getFriendlyPagePrefix(e),t,r,s),"thx_"===e&&settings.hasOwnProperty("thxlayout")){if($("#layout").hide(),settings.hasOwnProperty("thxlayout")&&$("#thxlayout").length&&$("#thxlayout").show(),settings.hasOwnProperty("extra_pages"))for(i=1;i<=100;i++)settings.extra_pages.length>=i&&settings.extra_pages[i-1]&&1===settings.extra_pages[i-1].on&&settings.hasOwnProperty("ep"+i+"layout")&&$("#ep"+i+"layout").length&&$("#ep"+i+"layout").hide();settings.hasOwnProperty("ep1layout")&&$("#ep1layout").length&&$("#ep1layout").hide(),settings.hasOwnProperty("ep2layout")&&$("#ep2layout").length&&$("#ep2layout").hide(),settings.hasOwnProperty("ep3layout")&&$("#ep3layout").length&&$("#ep3layout").hide(),settings.hasOwnProperty("ep4layout")&&$("#ep4layout").length&&$("#ep4layout").hide()}else if(0===e.indexOf("ep")){if(n=DUTIL.getExtraPageNumberFromEPString(e),settings.hasOwnProperty("ep"+n+"layout")){if($("#layout").hide(),settings.hasOwnProperty("thxlayout")&&$("#thxlayout").length&&$("#thxlayout").hide(),settings.hasOwnProperty("extra_pages"))for(i=1;i<=100;i++)settings.extra_pages.length>=i&&settings.extra_pages[i-1]&&1===settings.extra_pages[i-1].on&&i.toString()!=n&&settings.hasOwnProperty("ep"+i+"layout")&&$("#ep"+i+"layout").length&&$("#ep"+i+"layout").hide();settings.hasOwnProperty("ep1layout")&&$("#ep1layout").length&&$("#ep1layout").hide(),settings.hasOwnProperty("ep2layout")&&$("#ep2layout").length&&$("#ep2layout").hide(),settings.hasOwnProperty("ep3layout")&&$("#ep3layout").length&&$("#ep3layout").hide(),settings.hasOwnProperty("ep4layout")&&$("#ep4layout").length&&$("#ep4layout").hide(),$("#ep"+n+"layout").show()}}else{if($("#layout").show(),settings.hasOwnProperty("thxlayout")&&$("#thxlayout").length&&$("#thxlayout").hide(),settings.hasOwnProperty("extra_pages"))for(i=1;i<=100;i++)settings.extra_pages.length>=i&&settings.extra_pages[i-1]&&1===settings.extra_pages[i-1].on&&settings.hasOwnProperty("ep"+i+"layout")&&$("#ep"+i+"layout").length&&$("#ep"+i+"layout").hide();settings.hasOwnProperty("ep1layout")&&$("#ep1layout").length&&$("#ep1layout").hide(),settings.hasOwnProperty("ep2layout")&&$("#ep2layout").length&&$("#ep2layout").hide(),settings.hasOwnProperty("ep3layout")&&$("#ep3layout").length&&$("#ep3layout").hide(),settings.hasOwnProperty("ep4layout")&&$("#ep4layout").length&&$("#ep4layout").hide()}}),100),n){let t="";i&&i.action&&"redirect_url"==i.action&&i.redirect_url&&(t=DIGIOH_PRQ.replaceMergeTagsPRQ(i.redirect_url,!0));let r="";t||(r=DIGIOH_PRQ.getQuizResultsURL());let s=boxapi.getPageMetadata(CURRENT_PAGE,"form_autosubmit"),n=null!==s&&"false"!==s;(_=DAPI.getDataLayer())&&localStorage.setItem("prq_form_data",LBOX.LZString.compressToBase64(JSON.stringify(_)));let o=function(){let s=getEffectsProp("effects.quiz.settings.ResultRedirectDelay");(void 0===typeof s||""===s)&&(s=2),s=parseInt(s);var n=(boxapi.getWidgetMetadata("prq_results_spinner")||"").toLowerCase().trim();t?(logger("DIGIOH_PRQ.calcResultsPRQ() ==> action_override="+t+", curr="+CURRENT_PAGE+", next="+e),("true"==n||"1"==n||"yes"==n||"on"==n)&&showLoadingCustomOrDefault(),setTimeout((function(){top.location.href=t}),1e3*s)):r.length>10&&"Redirect_To_External_URL"==getEffectsProp("effects.quiz.settings.ResultsPageType")?(("true"==n||"1"==n||"yes"==n||"on"==n)&&showLoadingCustomOrDefault(),setTimeout((function(){DIGIOH_PRQ.redirectToQuizResults(r)}),1e3*s)):"Digioh_Results_Page"==getEffectsProp("effects.quiz.settings.ResultsPageType")&&(("true"==n||"1"==n||"yes"==n||"on"==n)&&showLoadingCustomOrDefault(),setTimeout((function(){DIGIOH_PRQ.displayQuizLocalResultsPage()}),1e3*s))};n?logger("PRQ Core: skipping auto-submit in Core because form_autosubmit App is installed on Page = "+CURRENT_PAGE):(logger("PRQ Core: auto-submitting form on results Page = "+CURRENT_PAGE),g=!0,p=DUTIL.getPlainPref(CURRENT_PAGE),settings.hasOwnProperty(p+"layout")&&settings[p+"layout"].hasOwnProperty("prq_preserve_results_page")&&settings[p+"layout"].prq_preserve_results_page&&(g=!1),processSubmitObj({pageName:CURRENT_PAGE,hideLoadingSpinner:!0,useSubmitLock:!1,resetBox:g})),Promise.allSettled(submissionPromises).then((()=>{o()})).catch((e=>{BOX_CUSTOM_JS.logError(e,e.message)}))}BOX_CUSTOM_JS.runCustomJsAfterChangePages(DUTIL.getFriendlyPagePrefix(u),DUTIL.getFriendlyPagePrefix(e),t,r,s)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"changePagesFinish")}}function postMessageChangePages(e,t,r,s,n,i,o,a,l,_){sendMessageToParent({sender:"lightbox",child_action:"change_pages",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,width:t,height:r,width_prev:s,height_prev:n,page_prefix:e,previous_page:i,new_page:o,el_name:a,ui_source:_})}function postMessageCloseBox(e){sendMessageToParent({sender:"lightbox",child_action:"close_lightbox",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,trigger:e});try{setTimeout((function(){boxapi.closeBox(),logger("postMessageCloseBox:  boxapi.closeBox()")}),150)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"postMessageCloseBox")}$(document).trigger("BOX_CLOSE",[boxapi.getId(),boxapi.getPageName(),e])}function postMessageRedirectParent(e,t){var r=BOX_CUSTOM_JS.runCustomJsBeforeRedirect(e,t);if("boolean"==typeof r&&!1===r)return!1;sendMessageToParent({sender:"lightbox",child_action:"redirect_parent",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,url:e.url,ui_trigger:t,redirect_type:e.redirect_type}),BOX_CUSTOM_JS.runCustomJsAfterRedirect(e,t)}function postMessageOpenAnotherBox(e,t){var r=BOX_CUSTOM_JS.runCustomJsBeforeOpenAnotherBox(e.lightbox_open,t);if("boolean"==typeof r&&!1===r)return!1;sendMessageToParent({sender:"lightbox",child_action:"lightbox_open",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,lightbox_open:e.lightbox_open,ui_trigger:t}),BOX_CUSTOM_JS.runCustomJsAfterOpenAnotherBox(e.lightbox_open,t)}function postMessageSubmit(t,r,s,n,i){var o,a,l,_,g,p=LBOX.LZString.compressToBase64(JSON.stringify(t)),u=LBOX.LZString.compressToBase64(r),m={};if(DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()&&(m=JSON.parse(JSON.stringify(DIGIOH_PRQ.getSubmissionData()))),m.form=JSON.parse(JSON.stringify(t)),m.analytics=JSON.parse(JSON.stringify(DAPI.GET_ANALYTICS().VARS)),DAPI.CONFIG.hasOwnProperty("NAMED_CUSTOM_FIELDS")&&DAPI.CONFIG.NAMED_CUSTOM_FIELDS.length>0){for(o={},a=0;a<DAPI.CONFIG.NAMED_CUSTOM_FIELDS.length;a++){l=DAPI.CONFIG.NAMED_CUSTOM_FIELDS[a];try{l.Name&&0==l.Name.indexOf("custom_")&&l.Key&&t.hasOwnProperty(l.Name)&&""!==t[l.Name]&&null!==t[l.Name]&&(o[l.Key]="string"==l.Type?t[l.Name].toString():"int"==l.Type?parseInt(t[l.Name].toString()):"float"==l.Type?parseFloat(t[l.Name].toString()):"bool"==l.Type?!0===t[l.Name]||"true"===t[l.Name].toString().toLowerCase()||1===t[l.Name]||"yes"===t[l.Name].toString().toLowerCase()||"on"===t[l.Name].toString().toLowerCase():"array"==l.Type?t[l.Name].toString().split(","):t[l.Name])}catch(t){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),BOX_CUSTOM_JS.logError(t,"postMessageSubmit => NAMED_CUSTOM_FIELDS")}}m.named_custom_fields=o}"object"==typeof(_=getEffectsProp("effects.quiz"))&&null!=_&&(g=DIGIOH_PRQ.getQuizResultsURL(),_.settings&&"Digioh_Results_Page"==_.settings.ResultsPageType&&(g=top.location.href.indexOf("?")>0?top.location.href+"&digioh_local_quiz_results="+LBOX.LZString.compressToBase64(g):top.location.href+"?digioh_local_quiz_results="+LBOX.LZString.compressToBase64(g)),m.hasOwnProperty("prq")&&"object"==typeof m.prq&&null!=m.prq&&(m.prq.results_url=g)),sendMessageToParent({sender:"lightbox",child_action:"register_analytics_submit",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,submission:p,post_to_keen:u,form_display:s,page_prefix:n,skip_submit:i,extra:m})}function postMessageCouponUsed(e,t,r,s,n,i,o){sendMessageToParent({sender:"lightbox",child_action:"coupon_used",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,coupon_meta_data:{coupon_group_id:e,coupon_value:t,success_or_error:r,populate_on:s,code_section_trigger:n,code_section_response:i,pref:o}})}function processDownload(){sendMessageToParent({sender:"lightbox",child_action:"download_file",lightbox_id:LIGHTBOX_OR_VARIATION_GUID})}function setButtonMetaDataLayer(e){try{if(e.hasOwnProperty("metadata_kvps"))for(var t=0;t<e.metadata_kvps.length;t++)e.metadata_kvps[t].k&&e.metadata_kvps[t].v&&0==e.metadata_kvps[t].k.indexOf("[")&&e.metadata_kvps[t].k.indexOf("]")>0&&(DAPI.setDataLayerValue(e.metadata_kvps[t].k.split(" ").join("").replace("[","").replace("]","").toLowerCase(),e.metadata_kvps[t].v),DAPI.setDataLayerValue(e.metadata_kvps[t].k.split(" ").join("").replace("[","").replace("]","").toLowerCase(),e.metadata_kvps[t].v,boxapi.getId()))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"setButtonMetaDataLayer")}}function removePageFromPageAnswers(e){e=DUTIL.getPlainPref(e);var t=0,r=!1;for(t=0;t<PageAnswers.length;t++)if(PageAnswers[t].page==e){r=!0;break}r&&PageAnswers.splice(t,1)}function addButtonToPageAnswers(e,t){var r,s,n,i,o,a;for(e=DUTIL.getPlainPref(e),r=0,s=!1,r=0;r<PageAnswers.length;r++)if(PageAnswers[r].page==e){s=!0;break}if(n=parseInt(t.split("utton")[1]),i="",settings.hasOwnProperty(t)&&settings[t].text&&(i=settings[t].text),s){for(o=0,a=!1,o=0;o<PageAnswers[r].entries.length;o++)if("button"==PageAnswers[r].entries[o].type&&PageAnswers[r].entries[o].num==n){a=!0;break}a?(PageAnswers[r].entries[o].type="button",PageAnswers[r].entries[o].num=n,PageAnswers[r].entries[o].value=i,PageAnswers[r].entries[o].src=e+"button"+n):PageAnswers[r].entries.push({type:"button",num:n,value:i,src:e+"button"+n})}else PageAnswers.push({page:e,entries:[{type:"button",num:n,value:i,src:e+"button"+n}]})}function removeButtonFromPageAnswers(e,t){e=DUTIL.getPlainPref(e);var r=parseInt(t.split("utton")[1]),s=0;for(s=0;s<PageAnswers.length;s++)PageAnswers[s].page==e&&(PageAnswers[s].entries=PageAnswers[s].entries.filter((e=>"button"!==e.type||e.num!==r)))}function resetPRQOrginalMergeTags(e){try{if(boxapi.mergeTagOriginalsPRQ){if(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals){let t=Object.keys(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals);t.length&&t.forEach((function(t){if("all"===e||t.split("button")[0]===DUTIL.getPlainPref(e)){let e=Object.keys(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t]);e.length&&e.forEach((function(e){if("text"==e&&boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].hasOwnProperty("text")&&(settings[t].text=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].text,$("#"+t).length&&$("#"+t).html(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].text)),"url"==e&&boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].hasOwnProperty("url")&&(settings[t].url=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].url),"selected_value"==e&&boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].hasOwnProperty("selected_value")&&(settings[t].selected_value=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].selected_value),"metadata_kvps"==e&&boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].hasOwnProperty("metadata_kvps")&&boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].metadata_kvps.length==settings[t].metadata_kvps.length){for(var r=0;r<settings[t].metadata_kvps.length;r++)if($("#"+t).length&&(settings[t].metadata_kvps[r].k!=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].metadata_kvps[r].k||settings[t].metadata_kvps[r].v!=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].metadata_kvps[r].v))try{$("#"+t).removeAttr(settings[t].metadata_kvps[r].k)}catch(e){}settings[t].metadata_kvps=JSON.parse(JSON.stringify(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[t].metadata_kvps))}}))}}))}if(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals){let t=Object.keys(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals);t.length&&t.forEach((function(t){if("all"===e||t.split("html")[0]===DUTIL.getPlainPref(e)){Object.keys(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[t]).forEach((function(e){if("html"==e&&boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[t].hasOwnProperty("html")&&(settings[t].html=boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[t].html,$("#"+t).length&&$("#"+t).html(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[t].html),"metadata_kvps"==e&&boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[t].hasOwnProperty("metadata_kvps")&&boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[t].metadata_kvps.length==settings[t].metadata_kvps.length)){for(var r=0;r<settings[t].metadata_kvps.length;r++)if($("#"+t).length&&(settings[t].metadata_kvps[r].k!=boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[t].metadata_kvps[r].k||settings[t].metadata_kvps[r].v!=boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[t].metadata_kvps[r].v))try{$("#"+t).removeAttr(settings[t].metadata_kvps[r].k)}catch(e){}settings[t].metadata_kvps=JSON.parse(JSON.stringify(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[t].metadata_kvps))}}))}}))}if(boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals){let t=Object.keys(boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals);t.length&&t.forEach((function(t){if("all"===e||t.split("text")[0]===DUTIL.getPlainPref(e)){let e=Object.keys(boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[t]);e.length&&e.forEach((function(e){if("metadata_kvps"==e&&boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[t].hasOwnProperty("metadata_kvps")&&boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[t].metadata_kvps.length==settings[t].metadata_kvps.length){for(var r=0;r<settings[t].metadata_kvps.length;r++)if($("#"+t).length&&(settings[t].metadata_kvps[r].k!=boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[t].metadata_kvps[r].k||settings[t].metadata_kvps[r].v!=boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[t].metadata_kvps[r].v))try{$("#"+t).removeAttr(settings[t].metadata_kvps[r].k)}catch(e){}settings[t].metadata_kvps=JSON.parse(JSON.stringify(boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[t].metadata_kvps))}}))}}))}if(boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals){let t=Object.keys(boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals);t.length&&t.forEach((function(t){if("all"===e||t.split("image")[0]===DUTIL.getPlainPref(e)){let e=Object.keys(boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[t]);e.length&&e.forEach((function(e){if("metadata_kvps"==e&&boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[t].hasOwnProperty("metadata_kvps")&&boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[t].metadata_kvps.length==settings[t].metadata_kvps.length){for(var r=0;r<settings[t].metadata_kvps.length;r++)if($("#"+t).length&&(settings[t].metadata_kvps[r].k!=boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[t].metadata_kvps[r].k||settings[t].metadata_kvps[r].v!=boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[t].metadata_kvps[r].v))try{$("#"+t).removeAttr(settings[t].metadata_kvps[r].k)}catch(e){}settings[t].metadata_kvps=JSON.parse(JSON.stringify(boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[t].metadata_kvps))}}))}}))}if(boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals){let t=Object.keys(boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals);t.length&&t.forEach((function(t){if("all"===e||t.split("form")[0]===DUTIL.getUnfriendlyPagePrefix(e)){let e=Object.keys(boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[t]);e.length&&e.forEach((function(e){"redirect_url"==e&&boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[t].hasOwnProperty("redirect_url")&&(settings[t].redirect_url=boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[t].redirect_url)}))}}))}boxapi.mergeTagOriginalsPRQ={buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"resetPRQOrginalMergeTags")}}function addCustomFieldToPageAnswers(e,t,r,s){var n,i,o,a,l;for(logger("addCustomFieldToPageAnswers: pref="+e+", ptn="+t+", val="+r+", src="+s),e=DUTIL.getPlainPref(e),n=0,i=!1,n=0;n<PageAnswers.length;n++)if(PageAnswers[n].page==e){i=!0;break}if(o=parseInt(t.split("ustom")[1].split("_").join("")),i){for(a=0,l=!1,a=0;a<PageAnswers[n].entries.length;a++)if("custom"==PageAnswers[n].entries[a].type&&PageAnswers[n].entries[a].num==o){l=!0;break}l?(PageAnswers[n].entries[a].type="custom",PageAnswers[n].entries[a].num=o,PageAnswers[n].entries[a].value=r,PageAnswers[n].entries[a].src=s):PageAnswers[n].entries.push({type:"custom",num:o,value:r,src:s})}else PageAnswers.push({page:e,entries:[{type:"custom",num:o,value:r,src:s}]})}function removeCustomFieldFromPageAnswers(e,t,r){var s,n;for(e=DUTIL.getPlainPref(e),void 0===r&&(r=""),s=parseInt(t.split("ustom")[1].split("_").join("")),n=0;n<PageAnswers.length;n++)PageAnswers[n].page==e&&(PageAnswers[n].entries=PageAnswers[n].entries.filter((e=>"custom"!==e.type||e.num!==s||r&&e.src!==r)))}function removeJumpedPagesFromPageAnswers(e){e=DUTIL.getPlainPref(e);for(var t=0;t<PageAnswers.length;t++)if(PageAnswers[t].page==e){PageAnswers.length=t;break}}function getPageBranchingAction(e,t){var r,s,n,i,o,a,l,_;if(e=DUTIL.getPlainPref(e),!settings.hasOwnProperty(e+"branching_logic")||0==settings[e+"branching_logic"].length)return"none";for(r=!1,s=0;s<settings[e+"branching_logic"].length;s++)if((n=settings[e+"branching_logic"][s]).hasOwnProperty("branch")&&n.hasOwnProperty("action")&&n.hasOwnProperty("evaluated")&&n.evaluated===t)for(r=!0,logger("branching_start: "+(e||"main")+" (Branch "+(s+1).toString()+")"),i=n.branch,o=0;o<i.length;o++){for(logger("branching_block: "+(e||"main")+" (OR Block "+(o+1).toString()+")"),a=!0,l=0;l<i[o].length&&(logger("branching_block: "+(e||"main")+" (AND Block "+(l+1).toString()+")"),logger("branching_condition_eval: "+(e||"main")+" ("+(a=isBranchingConditionTrue(e,_=i[o][l]))+") for Condition: "+JSON.stringify(_)),a);l++);if(a)return logger("branching_end: "+(e||"main")+" (true) for Branch "+(s+1).toString()+" ("+t+") (action="+n.action+")"),n.action}return r&&logger("branching_end: "+(e||"main")+" (false) for all "+settings[e+"branching_logic"].length.toString()+" Branches"),"none"}function isBranchingConditionTrue(e,t){var r,s=0,n=0,i=[],o=!1;for(s=0;s<PageAnswers.length;s++)if(DUTIL.getPlainPref(PageAnswers[s].page)==DUTIL.getPlainPref(t.q)){for(n=0;n<PageAnswers[s].entries.length;n++)"string"==typeof PageAnswers[s].entries[n].value&&("button"!=PageAnswers[s].entries[n].type||UTIL.stringOrArrayContains(i,"b"+PageAnswers[s].entries[n].num)?"custom"!=PageAnswers[s].entries[n].type||UTIL.stringOrArrayContains(i,PageAnswers[s].entries[n].value.toString().toLowerCase().trim())||i.push(PageAnswers[s].entries[n].value.toString().toLowerCase().trim()):i.push("b"+PageAnswers[s].entries[n].num));o=!0;break}if(!o)return logger("branching_answers_found: (page="+(t.q||"main")+") ==> No answers found for page, so setting page condition eval to false."),!1;if(logger("branching_answers_found: (page="+(t.q||"main")+") ==> "+JSON.stringify(i)),"contains_all"==t.o){if(0==t.a.length)return!1;for(s=0;s<t.a.length;s++)if(!UTIL.stringOrArrayContains(i,t.a[s].toString().toLowerCase().trim()))return!1;return!0}if("contains_only"==t.o){if(0==t.a.length)return!1;for(r=JSON.parse(JSON.stringify(t.a)),s=0;s<r.length;s++)r[s]=r[s].toString().toLowerCase().trim();return r.sort().join(",")===i.sort().join(",")}if("contains_any"==t.o){for(s=0;s<t.a.length;s++)if(UTIL.stringOrArrayContains(i,t.a[s].toString().toLowerCase().trim()))return!0;return!1}if("not_contains_any"==t.o){if(0==t.a.length)return!1;for(s=0;s<t.a.length;s++)if(UTIL.stringOrArrayContains(i,t.a[s].toString().toLowerCase().trim()))return!1;return!0}}function getCustomFieldNamesForPage(e){try{e||(e="main"),e.indexOf("thank_you")>=0&&(e="thx"),e.indexOf("extra_page_")>=0&&(e="ep"+e.split("_")[2]),e.indexOf("_")>=0&&(e=e.replace("_",""));const t="main"==e?"":e,r=e+"_",s=new RegExp("^"+("main"==e?"":e+"_")+"custom(\\d\\d?)"),n=new RegExp("^"+t+"button(\\d\\d?)"),i=/CUSTOM_(\d\d?)\]/,o=[];for(const e of Object.keys(settings)){const t=e.match(s);if(t&&settings[e].display){const e=t[1];o.push("custom_"+e),o.push(r+"custom_"+e);continue}if(e.match(n)){const t=settings[e];if(t.display){if(t.hasOwnProperty("selected_field")&&t.hasOwnProperty("selected_value")&&t.selected_field&&t.selected_value.trim().length>0){const e=t.selected_field;o.push("custom_"+e),o.push(r+"custom_"+e)}const e=t.metadata_kvps||[];for(const t of e){const e=(t.k||"").match(i);if(e){const t=e[1];o.push("custom_"+t)}}}}}return o}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"getCustomFieldNamesForPage"),[]}}function clearFieldsSetByPage(e){try{const t=getCustomFieldNamesForPage(e);for(const r of t)DAPI.removeDataLayerValue(r),DAPI.removeDataLayerValue(r,boxapi.getId()),logger("clearFieldsSetByPage("+e+") - "+r)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"clearFieldsSetByPage")}}function clearButtonValuesSetByPage(e){try{const t=getCustomFieldNamesForPage(e);for(const e of t)SELECTED_BUTTON_FORM_VALUES.hasOwnProperty(e)&&delete SELECTED_BUTTON_FORM_VALUES[e]}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"clearButtonValuesSetByPage")}}function fInvertButtonColors(e){let t=e.css("color"),r=e.css("background-color");e.css("background-color",t),e.css("color",r)}function addButtonData(e,t,r){if(t.hasOwnProperty("selected_field")&&t.selected_field&&t.hasOwnProperty("selected_value")&&t.selected_value.length>0){var s="custom_"+t.selected_field,n=boxapi.getPageName()+"_custom_"+t.selected_field;SELECTED_BUTTON_FORM_VALUES.hasOwnProperty(n)?$.inArray(t.selected_value,SELECTED_BUTTON_FORM_VALUES[n])<0&&SELECTED_BUTTON_FORM_VALUES[n].push(t.selected_value):SELECTED_BUTTON_FORM_VALUES[n]=[t.selected_value],DAPI.setDataLayerValue(s,SELECTED_BUTTON_FORM_VALUES[n].join(",")),DAPI.setDataLayerValue(n,SELECTED_BUTTON_FORM_VALUES[n].join(",")),DAPI.setDataLayerValue(s,SELECTED_BUTTON_FORM_VALUES[n].join(","),LIGHTBOX_SHORT_ID),DAPI.setDataLayerValue(n,SELECTED_BUTTON_FORM_VALUES[n].join(","),LIGHTBOX_SHORT_ID),addCustomFieldToPageAnswers(e,n,SELECTED_BUTTON_FORM_VALUES[n].join(","),r)}}function removeButtonData(e,t){if(t.hasOwnProperty("selected_field")&&t.selected_field&&t.hasOwnProperty("selected_value")&&t.selected_value.length>0){var r="custom_"+t.selected_field,s=boxapi.getPageName()+"_custom_"+t.selected_field;SELECTED_BUTTON_FORM_VALUES.hasOwnProperty(s)&&$.inArray(t.selected_value,SELECTED_BUTTON_FORM_VALUES[s])>=0&&(SELECTED_BUTTON_FORM_VALUES[s]=UTIL.removeFromStringOrArray(SELECTED_BUTTON_FORM_VALUES[s],t.selected_value),DAPI.setDataLayerValue(r,SELECTED_BUTTON_FORM_VALUES[s].join(",")),DAPI.setDataLayerValue(s,SELECTED_BUTTON_FORM_VALUES[s].join(",")),DAPI.setDataLayerValue(r,SELECTED_BUTTON_FORM_VALUES[s].join(","),LIGHTBOX_SHORT_ID),DAPI.setDataLayerValue(s,SELECTED_BUTTON_FORM_VALUES[s].join(","),LIGHTBOX_SHORT_ID)),removeCustomFieldFromPageAnswers(e,s)}}function buildButtonN(e,t,r,s,n){try{if(s.display)if(e.html(s.text),IS_MOBILE||e.hover((function(){$(this).addClass(r+"_hover"),$(document).trigger("BOX_BUTTON_HOVER_IN",[DUTIL.getFriendlyPagePrefix(n),r,s])}),(function(){$(this).removeClass(r+"_hover"),$(document).trigger("BOX_BUTTON_HOVER_OUT",[DUTIL.getFriendlyPagePrefix(n),r,s])})),"download"==s.action&&s.file&&s.file.length>7){var i=S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+s.file;e.wrap('<a style="border: none;" target="_blank" href="'+i+'"></a>'),e.parent().on(IS_MOBILE?"click":"mousedown",(function(e){var t;return $(document).trigger("BOX_BUTTON_CLICK",[DUTIL.getFriendlyPagePrefix(n),r,s]),e.stopPropagation(),setButtonMetaDataLayer(s),"boolean"==typeof(t=BOX_CUSTOM_JS.runCustomJsBeforeDownload(DUTIL.getFriendlyPagePrefix(n),r,s))&&!1===t?(e.preventDefault(),!1):(processDownload(s),BOX_CUSTOM_JS.runCustomJsAfterDownload(DUTIL.getFriendlyPagePrefix(n),r,s),!0)})),e.on(IS_MOBILE?"touchstart":"mousedown",(function(){$(this).addClass(r+"_focus")})).on(IS_MOBILE?"touchend":"mouseup",(function(){$(this).removeClass(r+"_focus"),$(document).trigger("BOX_BUTTON_RELEASE",[DUTIL.getFriendlyPagePrefix(n),r,s])}))}else e.on("focus",(function(){"submit"==s.action?$(this).addClass("button_focus_tab_submit"):"close"==s.action?$(this).addClass("button_focus_tab_close"):"url"==s.action&&s.url?$(this).addClass("button_focus_tab_redirect"):"lightbox_open"==s.action&&s.lightbox_open&&s.lightbox_open.length>0?$(this).addClass("button_focus_tab_lightbox_open"):s.action.indexOf("_page")>0&&$(this).addClass("button_focus_tab_change_pages")})).on("blur",(function(){$(this).hasClass("button_focus_tab_submit")&&$(this).removeClass("button_focus_tab_submit"),$(this).hasClass("button_focus_tab_close")&&$(this).removeClass("button_focus_tab_close"),$(this).hasClass("button_focus_tab_redirect")&&$(this).removeClass("button_focus_tab_redirect"),$(this).hasClass("button_focus_tab_lightbox_open")&&$(this).removeClass("button_focus_tab_lightbox_open"),$(this).hasClass("button_focus_tab_change_pages")&&$(this).removeClass("button_focus_tab_change_pages")})),s.action&&"nothing"!==s.action?e.on(IS_MOBILE?"click":"mousedown",(function(t){var i,o,a;if($(document).trigger("BOX_BUTTON_CLICK",[DUTIL.getFriendlyPagePrefix(n),r,s]),t.stopPropagation(),setButtonMetaDataLayer(s),$(this).addClass(r+"_focus"),"submit"===s.action||"select"===s.action&&!$(this).hasClass(r+"_selected")||"main_page"===s.action||"thank_you_page"===s.action||0===s.action.indexOf("extra_page_")?("select"!==s.action&&""!==s.selected_value&&""!==s.selected_field&&(removePageFromPageAnswers(CURRENT_PAGE),clearFieldsSetByPage(CURRENT_PAGE),clearButtonValuesSetByPage(CURRENT_PAGE)),addButtonToPageAnswers(n,r),s.hasOwnProperty("integration_id")&&s.integration_id&&boxapi.addBoxIntegration(s.integration_id)):"select"===s.action&&$(this).hasClass(r+"_selected")&&(removeButtonFromPageAnswers(n,r),s.hasOwnProperty("integration_id")&&s.integration_id&&boxapi.removeBoxIntegration(s.integration_id)),s.action.indexOf("[PRQ:")>=0)if(s.hasOwnProperty("prq_is_results_button")&&s.prq_is_results_button)if(0==s.action.indexOf("Redirect to [PRQ:")){var l="PRQ:"+(p=s.action.replace("Redirect to ","")).replace("[","").replace("]","").split(":")[1],_=p.split(":").length>2?parseInt(p.split(":")[2].replace("]","")):1,g=DIGIOH_PRQ.getResultCellValuePRQ(l,_);s.url=g,s.action="url"}else if(0==s.action.indexOf("Shopify")||0==s.action.indexOf("Magento")||0==s.action.indexOf("VTEX")){var p,u=s.action.split(" ")[0],m=(l="PRQ:"+(p=s.action.replace(u+" Add to Cart ","")).replace("[","").replace("]","").split(":")[1],_=p.split(":").length>2?parseInt(p.split(":")[2].replace("]","")):1,DIGIOH_PRQ.getResultCellValuePRQ(l,_)),d="",h="";"Shopify"==u?(d="/cart/add?id="+m+"&quantity=1",h="/cart"):"Magento"==u?(d="/cart?product="+m+"&qty=1&headless=true",h="/checkout/cart"):"VTEX"==u&&(d="/checkout/cart/add?sc=1&sku="+m+"&qty=1&seller=1",h="/checkout/#/cart"),showLoading(CURRENT_PAGE),LBOX.JQUERY_DIGIOH("body").append('<iframe src="'+d+'" style="display:none;"/>'),e.off(),setTimeout((()=>{e.text("GO TO CART"),fInvertButtonColors(e),boxapi.hideLoading()}),1500),e.click((function(){window.parent.location.href=h})),addButtonData(n,s,r)}else s.action="submit";else s.action="submit";if("retake_quiz"==s.action){let e="main";s.quiz_retake_start_page&&s.quiz_retake_start_page.length>0&&/^main$|^thx$|^ep\d\d?$/.test(s.quiz_retake_start_page)&&(e=s.quiz_retake_start_page),localStorage.removeItem("prq_results"),resetPRQOrginalMergeTags("all"),resetBox(),boxapi.showPage(e),resetBox()}else"back"==s.action?(addButtonData(n,s,r),PageViewSequence.length>1&&(i=PageViewSequence.pop(),o=PageViewSequence[PageViewSequence.length-1],resetPage(i,!1),resetPage(o,!1),changePages(o,r,s,"back_btn",!1))):"submit"===s.action?(addButtonData(n,s,r),s.hasOwnProperty("override_form_submit_action")&&s.override_form_submit_action?processSubmitObj({pageName:n,overrideFormSubmitAction:s.override_form_submit_action}):processSubmit(n,!1,!1,!0)):"select"===s.action?$(this).hasClass(r+"_selected")?$(this).hasClass(r+"_selected")&&($(this).removeClass(r+"_selected"),$(this).hasClass("button_selected")&&$(this).removeClass("button_selected"),removeButtonData(n,s)):($(this).addClass(r+"_selected"),$(this).hasClass("button_selected")||$(this).addClass("button_selected"),addButtonData(n,s,r)):"close"===s.action?(addButtonData(n,s,r),IS_MOBILE?setTimeout((function(){postMessageCloseBox("button_click")}),150):setTimeout((function(){postMessageCloseBox("button_click")}),10)):"url"===s.action&&s.url?(addButtonData(n,s,r),0!==s.url.toLowerCase().trim().indexOf("http")&&0!==s.url.toLowerCase().trim().indexOf("mailto")&&(s.url="http://"+s.url),s.hasOwnProperty("redirect_type")&&s.redirect_type||(s.redirect_type="current"),postMessageRedirectParent(s,"button")):"lightbox_open"===s.action&&s.lightbox_open&&s.lightbox_open.length>0?(addButtonData(n,s,r),IS_MOBILE?setTimeout((function(){postMessageOpenAnotherBox(s,"button")}),150):setTimeout((function(){postMessageOpenAnotherBox(s,"button")}),10)):"copy"===s.action&&s.copy_text&&s.copy_text.length>0?(addButtonData(n,s,r),$("#"+s.copy_text).length&&$("#"+s.copy_text).text()&&$("#"+s.copy_text).text().length&&(UTIL.copyToClipboard($("#"+s.copy_text).text(),document),showSuccess("Copied to Clipboard: "+$("#"+s.copy_text).text()))):"main_page"===s.action||"thank_you_page"===s.action||0===s.action.indexOf("extra_page_")?(addButtonData(n,s,r),a="","thank_you_page"===s.action?a="thx_":s.action.indexOf("extra_page_")>=0&&(a="ep"+s.action.split("_")[2]+"_"),IS_MOBILE?setTimeout((function(){changePages(a,r,s,"button",!1)}),150):changePages(a,r,s,"button",!1)):"nothing"===s.action&&setButtonMetaDataLayer(s)})):e.on(IS_MOBILE?"click":"mousedown",(function(e){addButtonData(n,s,r),$(document).trigger("BOX_BUTTON_CLICK",[DUTIL.getFriendlyPagePrefix(n),r,s]),e.stopPropagation()})),e.on(IS_MOBILE?"touchstart":"mousedown",(function(){$(this).addClass(r+"_focus")})).on(IS_MOBILE?"touchend":"mouseup",(function(){$(this).removeClass(r+"_focus"),$(document).trigger("BOX_BUTTON_RELEASE",[DUTIL.getFriendlyPagePrefix(n),r,s])}));else e.hide(),t.hide()}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildButtonN")}}function deselectButtonsOnPage(e){try{e=DUTIL.getPlainPref(e),$("#"+e+"layout button").each((function(){var e,t=$(this);t.hasClass("button_selected")&&((e=t.attr("id"))&&t.hasClass(e+"_selected")&&(t.removeClass(e+"_selected"),t.removeClass("button_selected")))}))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"deselectButtonsOnPage")}}function removeFocusFromButtonsOnPage(e){try{e=DUTIL.getPlainPref(e),$("#"+e+"layout button").each((function(){var e=$(this),t=e.attr("id");t&&e.hasClass(t+"_focus")&&e.removeClass(t+"_focus")}))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"removeFocusFromButtonsOnPage")}}function loadImages(e,t){var r,s;try{if(("string"!=typeof e||"main"===e)&&(e=""),UTIL.stringOrArrayContains(e,"_")&&(e=e.split("_")[0]),!t)if(""===e||LoadedPageImages.hasOwnProperty(e)){if(LoadedPageImages.hasOwnProperty(e)&&!0===LoadedPageImages[e])return}else LoadedPageImages[e]=!0;for(logger("loadImages(pref="+e+", force="+t+")"),r=DIGIOH_PRQ.isResultsPagePRQ(e),s=1;s<=50;s++)settings.hasOwnProperty(e+"image"+s)&&(r&&settings[e+"image"+s].hasOwnProperty("prq_is_results_image")&&settings[e+"image"+s].prq_is_results_image&&settings[e+"image"+s].prq_results_src||loadImageN(e+"image"+s,t))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"loadImages")}}function loadImageN(e,t){try{var r=$("#"+e).attr("src"),s=attributeNameMatches($("#"+e),"starts_with","prq_result")||attributeNameMatches($("#"+e),"starts_with","bgimg_replace")||attributeNameMatches($("#"+e),"starts_with","img_dynamic");ImageSrcMap.hasOwnProperty(e)&&(void 0===r||!1===r||!r||t)&&ImageSrcMap[e].img_src.indexOf("[PRQ:")<0&&!s&&(ImageSrcMap.hasOwnProperty(e+"_dynamic")&&ImageSrcMap[e+"_dynamic"].img_src&&ImageSrcMap[e+"_dynamic"].img_src.indexOf("[PRQ:")<0?(logger("loadImageN: "+ImageSrcMap[e+"_dynamic"].img_src),ImageSrcMap[e].img_element.attr("src",ImageSrcMap[e+"_dynamic"].img_src),ImageSrcMap[e].img_obj.src=ImageSrcMap[e+"_dynamic"].img_src):(logger("loadImageN: "+ImageSrcMap[e].img_src),ImageSrcMap[e].img_element.attr("src",ImageSrcMap[e].img_src),ImageSrcMap[e].img_obj.src=ImageSrcMap[e].img_src))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"loadImageN")}}function attributeNameMatches(e,t,r){try{var s=!1;return e.each((function(){$.each(this.attributes,(function(){this.specified&&"starts_with"==t&&0==this.name.indexOf(r)&&(logger("attributeNameMatches: "+this.name+", "+this.value),s=!0)}))})),s}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"attributeNameMatches"),!1}}function buildImages(){var e,t,r,s;try{for(e="",t=1;t<=102;t++){if(1==t)e="";else if(2==t)e="thx";else if(t>=3&&t<=6)e="ep"+(t-2);else if(t>=7&&(e="ep"+(t-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=t-3||!settings.extra_pages[t-3]||1!==settings.extra_pages[t-3].on))continue;for(r=1;r<=50;r++)if(settings.hasOwnProperty(e+"image"+r)&&settings[e+"image"+r].display){if(image_dims.hasOwnProperty(e+"image"+r)||(image_dims[e+"image"+r]={width:100,height:100}),settings[e+"image"+r].hasOwnProperty("metadata_kvps"))for(s=0;s<settings[e+"image"+r].metadata_kvps.length;s++)settings[e+"image"+r].metadata_kvps[s].k&&settings[e+"image"+r].metadata_kvps[s].v&&UTIL.trySetAttribute(e+"image"+r,settings[e+"image"+r].metadata_kvps[s],$);buildImageN(image_dims[e+"image"+r],$("#"+e+"image"+r+"_wrapper"),$("#"+e+"image"+r),e+"image"+r,settings[e+"image"+r])}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildImages")}}function buildImageN(e,t,r,s,n){try{if(n.display&&n.src&&"none"!==n.src&&n.src.length>5){var i=S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+n.src,o=new Image;o.onload=function(){e.width=this.width,e.height=this.height,resizeImage(e,t,r,s,n.width,n.height,!1),t.show()},ImageSrcMap[s]={img_obj:o,img_src:i,img_element:r}}else t.hide()}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildImageN")}}function resizeImage(e,t,r,s,n,i,o){var a,l,_,g,p;try{(a=settings[s]).constrain?(g=n-2*a.border.width-2*a.padding,("none"===a.border.style||"0"===a.border.width||0===a.border.width)&&(g=n-2*a.padding),l=e.height*g/e.width,o&&l<i-2*a.padding-10?(_=(i-2*a.padding-l)/2,r.css({height:"auto","margin-top":Math.round(_)+"px"})):r.css({height:"auto"}),r.width(Math.floor(g))):(g=n-2*a.border.width-2*a.padding,p=i-2*a.border.width-2*a.padding,("none"===a.border.style||"0"===a.border.width||0===a.border.width)&&(g=n-2*a.padding),("none"===a.border.style||"0"===a.border.width||0===a.border.width)&&(p=i-2*a.padding),r.width(Math.floor(g)),r.height(Math.floor(p)))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"resizeImage")}}function getBorderStyle(e){var t="";return void 0===e.style||null===e.style||"none"===e.style||"0"===e.width||0===e.width?(t+="border-style: none;",t+="border-width: 0px;"):(t+="border-color: "+e.color+";",t+="border-style: "+e.style+";",t+="border-width: "+e.width+"px;",t+="border-radius: "+e.radius+"px;"),t}function getBackgroundStyle(e,t){var r,s,n=!0;if("string"==typeof t&&(t.indexOf("button")>=0||t.indexOf("layout")>=0)&&$("#"+t).length&&(attributeNameMatches($("#"+t),"starts_with","prq_result")||attributeNameMatches($("#"+t),"starts_with","bgimg_replace")||attributeNameMatches($("#"+t),"starts_with","img_dynamic"))&&(n=!1),r="",e.use_image&&e.image.length>3&&"none"!=e.image){if(s=S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+e.image,e.image.startsWith("[PRQ")){var i="PRQ:"+e.image.replace("[","").replace("]","").split(":")[1],o=e.image.split(":").length>2?parseInt(e.image.split(":")[2].replace("]","")):1,a=DIGIOH_PRQ.getResultCellValuePRQ(i,o);logger("getBackgroundStyle=="+e.image+", headerName="+i+", rowIdx="+o+", getResultCellValuePRQ="+a),a&&0==a.indexOf("http")&&(s=a,r+="background-size: contain !important;")}n&&(settings.fullscreen&&settings.fullscreen.use&&t.indexOf("layout")>=0?"full"===settings.fullscreen.backgroundType&&(r+="background-image: url("+s+");"):r+="background-image: url("+s+");"),r+="background-position: "+e.position+";",r+="background-color: "+e.color+";","stretch"===e.repeat?(r+="-webkit-background-size: cover;",r+="-moz-background-size: cover;",r+="-o-background-size: cover;",r+="background-size: cover;"):"contain"===e.repeat?(r+="-webkit-background-size: contain;",r+="-moz-background-size: contain;",r+="-o-background-size: contain;",r+="background-size: contain;",r+="background-repeat: no-repeat;"):r+="background-repeat: "+e.repeat+";"}else!IS_IE_9_OR_LESS&&e.use_gradient&&e.gradient.length>3?(r+="background: -webkit-gradient(linear, left top, left bottom, from("+e.color+"),to("+e.gradient+"));",r+="background: -webkit-linear-gradient(top, "+e.color+","+e.gradient+");",r+="background: -o-linear-gradient(top, "+e.color+","+e.gradient+");",r+="background: -moz-linear-gradient(top, "+e.color+","+e.gradient+");",r+="background: -ms-linear-gradient(top, "+e.color+","+e.gradient+");",r+="background: linear-gradient(to bottom,"+e.color+","+e.gradient+");"):r+="background: "+e.color+";";return r}function getFontStyle(e){var t,r="",s="";return e.family.indexOf("__google__")>=0?(t=e.family.replace("__google__","")).indexOf(":")>0?(s=t.split(":")[1].split("'")[0],r+="font-family: "+(t=t.split(":")[0])+"';"):r+="font-family: "+t+";":r+=e.family.indexOf("__custom__")>=0?"font-family: "+e.family.split("||||")[1]+";":"font-family: "+e.family+";",s?("Black"==s&&(r+="font-weight: 900;"),"ExtraBold"==s&&(r+="font-weight: 800;"),"Bold"==s&&(r+="font-weight: 700;"),"Light"==s&&(r+="font-weight: 300;"),"ExtraLight"==s&&(r+="font-weight: 200;"),"Thin"==s&&(r+="font-weight: 100;")):r+="font-weight: "+(e.bold?"bold":"normal")+";",r+="font-style:  "+(e.italic?"italic":"normal")+";",r+="text-decoration: "+(e.underline?"underline":"none")+";",r+="text-transform: "+(e.uppercase?"uppercase":"none")+";",r+="text-align: "+e.align+";",r+="font-size: "+e.size+"px;",r+="color: "+e.color+";",e.hasOwnProperty("vspace")&&null!==e.vspace&&""!==e.vspace&&"0"!==e.vspace&&0!==e.vspace&&(r+="line-height: "+e.vspace+"px;"),r}function getWidthStyle(e){return"width: "+e+"px;"}function getWidthPercentStyle(e){return"width: "+e+"%;"}function getHeightStyle(e){return"height: "+e+"px;"}function getHeightPercentStyle(e){return"height: "+e+"%;"}function getLineHeightStyle(e){return"line-height: "+e+"px;"}function getTextAlignStyle(e){return"text-align: "+e+";"}function getDisplayStyle(e){return"display: "+(e?"block":"none")+";"}function getOverflowHiddenStyle(){return"overflow: hidden;"}function getOverflowVisibleStyle(){return"overflow: visible;"}function getFloatLeftStyle(){return"float: left;"}function getFloatRightStyle(){return"float: right;"}function getPositionAbsoluteStyle(){return"position: absolute;"}function getGeneralStyle(e,t){return e.split("'").join("")+": "+t.split("'").join('"').split(";").join("")+";"}function getLeftStyle(e){return"left: "+e+"px;"}function getTopStyle(e){return"top: "+e+"px;"}function getLeftTopWidthHeightStyle(e){var t="";return t+="left: "+e.x+"px;",t+="top: "+e.y+"px;",(t+="width: "+e.width+"px;")+"height: "+e.height+"px;"}function getTextElementLeftTopWidthHeightStyle(e){var t="";return t+="left: "+e.x+"px;",t+="top: "+e.y+"px;",(t+="width: "+(e.width+5)+"px;")+"height: "+e.height+"px;"}function getZindexStyle(e){return"z-index: "+e+";"}function getCursorStyle(e){return"cursor: "+e+";"}function centerWrapperLayout(e){var t,r="",s=0;if("full"===settings.fullscreen.backgroundType||"split_top"===settings.fullscreen.backgroundType||"split_bottom"===settings.fullscreen.backgroundType)s=(window.innerWidth-settings[e+"layout"].width)/2;else{r+="display: grid;",r+="grid-area: "+("split_left"===settings.fullscreen.backgroundType?"1 / 2":"1 / 1")+";",r+="grid-column :"+("split_left"===settings.fullscreen.backgroundType?"2":"1")+";",r+="grid-row:1;";var n=parseInt(settings.fullscreen.backgroundWidth.replace("vw","")),i=settings[e+"layout"].width,o=100-n;(s=(window.innerWidth*o/100-i)/2)<0&&(s=0)}if(s<0&&(s=0),settings[e+"layout"].height>window.innerHeight?(t=(settings[e+"layout"].height-window.innerHeight)/2,window.innerHeight<600&&(t=10)):t=(window.innerHeight-settings[e+"layout"].height)/2,r+="position:absolute;",r+="left:"+s+"px;","split_top"===settings.fullscreen.backgroundType?r+="bottom:0px !important;":"split_bottom"===settings.fullscreen.backgroundType?r+="top:0px !important;":["full","split_left","split_right"].includes(settings.fullscreen.backgroundType)?r+="top:"+(t=`calc(50vh - ${settings[e+"layout"].height/2}px)`)+";":r+="top:"+t+"px;","full"!==settings.fullscreen.backgroundType){let e=settings.fullscreen.backgroundWidth?100-parseInt(settings.fullscreen.backgroundWidth.replace("vw","")):50;0===e&&(e=100),r+="width: "+e+"vw;",r+="height: 100%;",r+="box-sizing: border-box;"}if("split_top"===settings.fullscreen.backgroundType||"split_bottom"===settings.fullscreen.backgroundType){let e=settings.fullscreen.backgroundHeight?100-parseInt(settings.fullscreen.backgroundHeight.replace("vw","")):50;e>0&&(r+="height:"+e+"% !important;")}return r}function wrapLayoutContent(e){var t,r,s=e+"layout-wrapper",n=$("#"+e+"layout"),i=$('<div id="'+s+'"></div>');if($("#"+s).length>0)return void $("#"+s).attr("style",centerWrapperLayout(e));n.children().appendTo(i),n.append(i),!settings[e+"layout"].background.use_image||"full"===settings.fullscreen.backgroundType||(t=$('<div id="'+e+'layout-background"></div>'),r=S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+settings[e+"layout"].background.image,n.append(t),n.parent().css("display","grid"),t.css({display:"grid","background-image":"url("+r+")","background-size":"stretch"===settings[e+"layout"].background.repeat||"contain"===settings[e+"layout"].background.repeat?"stretch"==settings[e+"layout"].background.repeat?"cover":settings[e+"layout"].background.repeat:"","background-position":settings[e+"layout"].background.position,"background-repeat":"stretch"!==settings[e+"layout"].background.repeat&&"contain"!==settings[e+"layout"].background.repeat?settings[e+"layout"].background.repeat:"no-repeat",height:settings.fullscreen.backgroundHeight,width:settings.fullscreen.backgroundWidth,"grid-column":"split_left"===settings.fullscreen.backgroundType?"1":"2","grid-row":"1","grid-area":"split_right"===settings.fullscreen.backgroundType?"1/3":"1"}),"split_top"===settings.fullscreen.backgroundType?t.css({top:"0px",position:"absolute"}):"split_bottom"===settings.fullscreen.backgroundType&&t.css({bottom:"0px",position:"absolute"}),("split_bottom"===settings.fullscreen.backgroundType||"split_top"===settings.fullscreen.backgroundType)&&parseInt(settings.fullscreen.backgroundHeight.replace("vh",""))>60&&n.css("overflow-y","auto"),n.css({"background-image":"none !important",display:"grid","grid-template-columns":"split_left"===settings.fullscreen.backgroundType?"0fr 1fr":"1fr 1fr"})),i.attr("style",centerWrapperLayout(e));let o=document.getElementById("bubble_container");o&&(o.style.width="100vw")}function buildStyles(e,t){var r,s,n,i,o,a;try{if(r="",("string"!=typeof e||"main"===e)&&(e=""),UTIL.stringOrArrayContains(e,"_")&&(e=e.split("_")[0]),""===e||BuiltExtraPageStyles.hasOwnProperty(e)){if(BuiltExtraPageStyles.hasOwnProperty(e)&&!0===BuiltExtraPageStyles[e]&&!t)return}else BuiltExtraPageStyles[e]=!0;if(""===e?$("#element_styles").remove():$("#element_styles_"+e).remove(),logger("buildStyles("+e+")"),""===e&&(r+=".float_left {",r+=getFloatLeftStyle(),r+="} ",r+=".float_right {",r+=getFloatRightStyle(),r+="} "),r+="#"+e+"layout {",r+=getBorderStyle(settings[e+"layout"].border),r+=getBackgroundStyle(settings[e+"layout"].background,e+"layout"),settings[e+"layout"].hasOwnProperty("width")&&settings[e+"layout"].hasOwnProperty("height")?"none"===settings[e+"layout"].border.style||"0"===settings[e+"layout"].border.width||0===settings[e+"layout"].border.width?settings.hasOwnProperty("fullscreen")&&settings.fullscreen.use?((window.innerHeight-settings[e+"layout"].height)/2<0&&(r+="overflow-y:auto !important;"),r+="width:100vw !important;",r+="height:100vh !important;",r+="position:relative;",r+="box-sizing: border-box;",settings[e+"layout"].background.use_image&&"full"===settings.fullscreen.backgroundType?(r+="background-size:cover !important; ",r+="background-repeat:no-repeat !important;"):(r+="background-size: "+settings[e+"layout"].background.repeat=="stretch"||"contain"===settings[e+"layout"].background.repeat?"stretch"==settings[e+"layout"].background.repeat?"cover":settings[e+"layout"].background.repeat:";",r+="background-repeat:"+settings[e+"layout"].background.repeat!="stretch"&&"contain"!==settings[e+"layout"].background.repeat?settings[e+"layout"].background.repeat:"no-repeat;"),wrapLayoutContent(e)):(r+=getWidthStyle(settings[e+"layout"].width),r+=getHeightStyle(settings[e+"layout"].height)):settings.hasOwnProperty("fullscreen")&&settings.fullscreen.use?((window.innerHeight-settings[e+"layout"].height)/2<0&&(r+="overflow-y:auto !important;"),r+="width:100vw !important;",r+="height:100vh !important;",r+="position:relative;",r+="box-sizing: border-box;",settings[e+"layout"].background.use_image&&"full"===settings.fullscreen.backgroundType?(r+="background-size:cover !important; ",r+="background-repeat:no-repeat !important;"):(r+="background-size: "+settings[e+"layout"].background.repeat=="stretch"||"contain"===settings[e+"layout"].background.repeat?"stretch"==settings[e+"layout"].background.repeat?"cover":settings[e+"layout"].background.repeat:";",r+="background-repeat:"+settings[e+"layout"].background.repeat!="stretch"&&"contain"!==settings[e+"layout"].background.repeat?settings[e+"layout"].background.repeat:"no-repeat;"),wrapLayoutContent(e)):(r+=getWidthStyle(settings[e+"layout"].width-2*settings[e+"layout"].border.width),r+=getHeightStyle(settings[e+"layout"].height-2*settings[e+"layout"].border.width)):"none"===settings.layout.border.style||"0"===settings.layout.border.width||0===settings.layout.border.width?(r+=getWidthStyle(settings.layout.width),r+=getHeightStyle(settings.layout.height)):(r+=getWidthStyle(settings.layout.width-2*settings.layout.border.width),r+=getHeightStyle(settings.layout.height-2*settings.layout.border.width)),r+=getOverflowHiddenStyle(),r+=getGeneralStyle("margin","0"),r+=getGeneralStyle("padding","0"),settings[e+"layout"].hasOwnProperty("css_kvps"))for(n=0;n<settings[e+"layout"].css_kvps.length;n++)settings[e+"layout"].css_kvps[n].k&&settings[e+"layout"].css_kvps[n].v&&(settings[e+"layout"].css_kvps[n].v.indexOf("important")<0&&(settings[e+"layout"].css_kvps[n].v+=" !important"),r+=getGeneralStyle(settings[e+"layout"].css_kvps[n].k,settings[e+"layout"].css_kvps[n].v));for(r+="} ",settings.hasOwnProperty("fullscreen")&&settings.fullscreen.use&&(r+="#"+e+"layout-wrapper {",r+=centerWrapperLayout(e),r+="}"),s=1;s<=50;s++){if(settings.hasOwnProperty(e+"text"+s)&&settings[e+"text"+s].display){if(r+="#"+e+"text"+s+"_wrapper {",r+=getDisplayStyle(settings[e+"text"+s].display),r+=getPositionAbsoluteStyle(),r+=getZindexStyle(4500),r+=getTextElementLeftTopWidthHeightStyle(settings[e+"text"+s]),settings[e+"text"+s].hasOwnProperty("wrapper_css_kvps"))for(n=0;n<settings[e+"text"+s].wrapper_css_kvps.length;n++)settings[e+"text"+s].wrapper_css_kvps[n].k&&settings[e+"text"+s].wrapper_css_kvps[n].v&&(settings[e+"text"+s].wrapper_css_kvps[n].v.indexOf("important")<0&&(settings[e+"text"+s].wrapper_css_kvps[n].v+=" !important"),r+=getGeneralStyle(settings[e+"text"+s].wrapper_css_kvps[n].k,settings[e+"text"+s].wrapper_css_kvps[n].v));if(r+="} ",r+="#"+e+"text"+s+" {",r+=getFontStyle(settings[e+"text"+s].font),settings[e+"text"+s].hasOwnProperty("css_kvps"))for(n=0;n<settings[e+"text"+s].css_kvps.length;n++)settings[e+"text"+s].css_kvps[n].k&&settings[e+"text"+s].css_kvps[n].v&&(r+=getGeneralStyle(settings[e+"text"+s].css_kvps[n].k,settings[e+"text"+s].css_kvps[n].v));r+="} "}if(settings.hasOwnProperty(e+"button"+s)&&settings[e+"button"+s].display){if(r+="#"+e+"button"+s+"_wrapper {",r+=getDisplayStyle(settings[e+"button"+s].display),r+=getPositionAbsoluteStyle(),r+=getLeftTopWidthHeightStyle(settings[e+"button"+s]),r+=getZindexStyle(9e3),settings[e+"button"+s].hasOwnProperty("wrapper_css_kvps"))for(n=0;n<settings[e+"button"+s].wrapper_css_kvps.length;n++)settings[e+"button"+s].wrapper_css_kvps[n].k&&settings[e+"button"+s].wrapper_css_kvps[n].v&&(settings[e+"button"+s].wrapper_css_kvps[n].v.indexOf("important")<0&&(settings[e+"button"+s].wrapper_css_kvps[n].v+=" !important"),r+=getGeneralStyle(settings[e+"button"+s].wrapper_css_kvps[n].k,settings[e+"button"+s].wrapper_css_kvps[n].v));if(r+="} ",r+="."+e+"button"+s+" {",r+=getFontStyle(settings[e+"button"+s].font),r+=getBorderStyle(settings[e+"button"+s].border),r+=getBackgroundStyle(settings[e+"button"+s].background,e+"button"+s),r+=getWidthPercentStyle(100),r+=getHeightPercentStyle(100),r+=getCursorStyle("pointer"),r+=getZindexStyle(9e3),r+=getGeneralStyle("position","relative"),settings[e+"button"+s].hasOwnProperty("css_kvps"))for(n=0;n<settings[e+"button"+s].css_kvps.length;n++)settings[e+"button"+s].css_kvps[n].k&&settings[e+"button"+s].css_kvps[n].v&&(r+=getGeneralStyle(settings[e+"button"+s].css_kvps[n].k,settings[e+"button"+s].css_kvps[n].v));if(r+="} ",r+="."+e+"button"+s+"_hover {",r+=getFontStyle(settings[e+"button"+s].font_hover),r+=getBorderStyle(settings[e+"button"+s].border_hover),r+=getBackgroundStyle(settings[e+"button"+s].background_hover,e+"button"+s),r+=getCursorStyle("pointer"),settings[e+"button"+s].hasOwnProperty("css_kvps_hover"))for(n=0;n<settings[e+"button"+s].css_kvps_hover.length;n++)settings[e+"button"+s].css_kvps_hover[n].k&&settings[e+"button"+s].css_kvps_hover[n].v&&(r+=getGeneralStyle(settings[e+"button"+s].css_kvps_hover[n].k,settings[e+"button"+s].css_kvps_hover[n].v));if(r+="} ",settings.hasOwnProperty(e+"button"+s)&&"select"===settings[e+"button"+s].action){if(r+="."+e+"button"+s+"_selected {",r+=getFontStyle(settings[e+"button"+s].font_focus),r+=getBorderStyle(settings[e+"button"+s].border_focus),r+=getBackgroundStyle(settings[e+"button"+s].background_focus,e+"button"+s),r+=getCursorStyle("pointer"),settings[e+"button"+s].hasOwnProperty("css_kvps_focus"))for(n=0;n<settings[e+"button"+s].css_kvps_focus.length;n++)settings[e+"button"+s].css_kvps_focus[n].k&&settings[e+"button"+s].css_kvps_focus[n].v&&(r+=getGeneralStyle(settings[e+"button"+s].css_kvps_focus[n].k,settings[e+"button"+s].css_kvps_focus[n].v));if(r+="} ",r+="."+e+"button"+s+"_hover."+e+"button"+s+"_selected {",settings[e+"button"+s].hasOwnProperty("font_focus_hover")&&(r+=getFontStyle(settings[e+"button"+s].font_focus_hover)),settings[e+"button"+s].hasOwnProperty("border_focus_hover")&&(r+=getBorderStyle(settings[e+"button"+s].border_focus_hover)),settings[e+"button"+s].hasOwnProperty("background_focus_hover")&&(r+=getBackgroundStyle(settings[e+"button"+s].background_focus_hover,e+"button"+s)),r+=getCursorStyle("pointer"),settings[e+"button"+s].hasOwnProperty("css_kvps_focus_hover"))for(n=0;n<settings[e+"button"+s].css_kvps_focus_hover.length;n++)settings[e+"button"+s].css_kvps_focus_hover[n].k&&settings[e+"button"+s].css_kvps_focus_hover[n].v&&(r+=getGeneralStyle(settings[e+"button"+s].css_kvps_focus_hover[n].k,settings[e+"button"+s].css_kvps_focus_hover[n].v));r+="} "}else{if(r+="."+e+"button"+s+"_focus {",r+=getFontStyle(settings[e+"button"+s].font_focus),r+=getBorderStyle(settings[e+"button"+s].border_focus),r+=getBackgroundStyle(settings[e+"button"+s].background_focus,e+"button"+s),r+=getCursorStyle("pointer"),settings[e+"button"+s].hasOwnProperty("css_kvps_focus"))for(n=0;n<settings[e+"button"+s].css_kvps_focus.length;n++)settings[e+"button"+s].css_kvps_focus[n].k&&settings[e+"button"+s].css_kvps_focus[n].v&&(r+=getGeneralStyle(settings[e+"button"+s].css_kvps_focus[n].k,settings[e+"button"+s].css_kvps_focus[n].v));r+="} "}}if(settings.hasOwnProperty(e+"image"+s)&&settings[e+"image"+s].display){if(r+="#"+e+"image"+s+"_wrapper {",r+=getDisplayStyle(settings[e+"image"+s].display),r+=getPositionAbsoluteStyle(),r+=getZindexStyle(4500),r+=getLeftTopWidthHeightStyle(settings[e+"image"+s]),r+=getTextAlignStyle("center"),settings[e+"image"+s].hasOwnProperty("wrapper_css_kvps"))for(n=0;n<settings[e+"image"+s].wrapper_css_kvps.length;n++)settings[e+"image"+s].wrapper_css_kvps[n].k&&settings[e+"image"+s].wrapper_css_kvps[n].v&&(settings[e+"image"+s].wrapper_css_kvps[n].v.indexOf("important")<0&&(settings[e+"image"+s].wrapper_css_kvps[n].v+=" !important"),r+=getGeneralStyle(settings[e+"image"+s].wrapper_css_kvps[n].k,settings[e+"image"+s].wrapper_css_kvps[n].v));if(r+="} ",r+="#"+e+"image"+s+" {",r+=getBorderStyle(settings[e+"image"+s].border),r+=getGeneralStyle("padding",settings[e+"image"+s].padding+"px"),settings[e+"image"+s].width>=settings[e+"image"+s].height?(r+=getGeneralStyle("max-width",settings[e+"image"+s].width+"px"),r+=getGeneralStyle("max-height",settings[e+"image"+s].width+"px")):(r+=getGeneralStyle("max-width",settings[e+"image"+s].height+"px"),r+=getGeneralStyle("max-height",settings[e+"image"+s].height+"px")),settings[e+"image"+s].hasOwnProperty("css_kvps"))for(n=0;n<settings[e+"image"+s].css_kvps.length;n++)settings[e+"image"+s].css_kvps[n].k&&settings[e+"image"+s].css_kvps[n].v&&(r+=getGeneralStyle(settings[e+"image"+s].css_kvps[n].k,settings[e+"image"+s].css_kvps[n].v));r+="} "}if(settings.hasOwnProperty(e+"html"+s)&&settings[e+"html"+s].display){if(r+="#"+e+"html"+s+"_wrapper {",r+=getDisplayStyle(settings[e+"html"+s].display),r+=getPositionAbsoluteStyle(),r+=getZindexStyle(4500),r+=getLeftTopWidthHeightStyle(settings[e+"html"+s]),settings[e+"html"+s].hasOwnProperty("wrapper_css_kvps"))for(n=0;n<settings[e+"html"+s].wrapper_css_kvps.length;n++)settings[e+"html"+s].wrapper_css_kvps[n].k&&settings[e+"html"+s].wrapper_css_kvps[n].v&&(settings[e+"html"+s].wrapper_css_kvps[n].v.indexOf("important")<0&&(settings[e+"html"+s].wrapper_css_kvps[n].v+=" !important"),r+=getGeneralStyle(settings[e+"html"+s].wrapper_css_kvps[n].k,settings[e+"html"+s].wrapper_css_kvps[n].v));if(r+="} ",r+="#"+e+"html"+s+" {",settings[e+"html"+s].hasOwnProperty("css_kvps"))for(n=0;n<settings[e+"html"+s].css_kvps.length;n++)settings[e+"html"+s].css_kvps[n].k&&settings[e+"html"+s].css_kvps[n].v&&(r+=getGeneralStyle(settings[e+"html"+s].css_kvps[n].k,settings[e+"html"+s].css_kvps[n].v));r+="} "}}if(""!==e&&(e+="_"),settings.hasOwnProperty(e+"form")){r+="#"+e+"form_wrapper {",r+=getDisplayStyle(settings[e+"form"].display),r+=getPositionAbsoluteStyle(),r+=getZindexStyle(4500),r+=getLeftTopWidthHeightStyle(settings[e+"form"]),r+="} ",r+="."+e+"form_spacing {",r+=getGeneralStyle("margin-top",settings[e+"inputs"].spacing+"px"),r+="} ",r+="."+e+"form_labels {",r+=getFontStyle(settings[e+"labels"].font),r+=getOverflowHiddenStyle(),r+="} ",settings[e+"labels"].hasOwnProperty("font_subtext")&&(r+="."+e+"form_labels_subtext {",r+=getFontStyle(settings[e+"labels"].font_subtext),r+=getOverflowHiddenStyle(),r+="} "),r+="."+e+"form_labels_left {",r+=getFloatLeftStyle(),r+=getWidthPercentStyle(settings[e+"labels"].width),r+=getHeightStyle(settings[e+"inputs"].height),r+=getLineHeightStyle(settings[e+"inputs"].height),r+="} ",r+="."+e+"form_labels_above {",r+=getFloatRightStyle(),r+=getWidthPercentStyle(100),r+=getGeneralStyle("margin-bottom","5px"),r+="} ",r+="."+e+"form_labels_hide {",r+=getDisplayStyle(!1),r+="} ",r+="."+e+"form_labels_required {",r+=getGeneralStyle("color",settings[e+"labels"].required.color),r+=getGeneralStyle("margin-left","3px"),r+=getGeneralStyle("font-size",("*"==settings[e+"labels"].required.text?parseInt(settings[e+"labels"].font.size)+4:parseInt(settings[e+"labels"].font.size)-2)+"px"),r+="} ",r+="."+e+"form_inputs {",r+=getBorderStyle(settings[e+"inputs"].border),r+=getBackgroundStyle(settings[e+"inputs"].background,e+"inputs"),r+=getFontStyle(settings[e+"inputs"].font),r+=getWidthPercentStyle(100),r+=getHeightStyle(settings[e+"inputs"].height),r+=getOverflowHiddenStyle(),r+=getGeneralStyle("-webkit-box-sizing","border-box"),r+=getGeneralStyle("-moz-box-sizing","border-box"),r+=getGeneralStyle("box-sizing","border-box"),r+=getGeneralStyle("padding-left","5px"),r+=getGeneralStyle("padding-right","5px"),r+="} ",settings[e+"inputs"].hasOwnProperty("placeholder_color")&&(r+="::placeholder {opacity: 1; color:"+settings[e+"inputs"].placeholder_color+"} ",r+=":-ms-input-placeholder {color:"+settings[e+"inputs"].placeholder_color+"} ",r+="::-ms-input-placeholder {color:"+settings[e+"inputs"].placeholder_color+"} "),r+="."+e+"form_inputs_hover {",r+=getBorderStyle(settings[e+"inputs"].border_hover),r+=getBackgroundStyle(settings[e+"inputs"].background_hover,e+"inputs"),r+="} ",r+="."+e+"form_inputs_focus {",r+=getBorderStyle(settings[e+"inputs"].border_focus),r+=getBackgroundStyle(settings[e+"inputs"].background_focus,e+"inputs"),r+="} ",r+="."+e+"form_inputs_error {",r+=getBorderStyle(settings[e+"inputs"].border_error),r+=getBackgroundStyle(settings[e+"inputs"].background_error,e+"inputs"),r+="} ",r+="."+e+"form_inputs_error_text {",r+=getDisplayStyle(!1),r+=getGeneralStyle("text-align","left"),r+=getGeneralStyle("color",settings[e+"inputs"].border_error.color),r+=getGeneralStyle("font-family",settings[e+"labels"].font.family),r+=getGeneralStyle("font-size","11px"),r+=getGeneralStyle("margin-top","2px"),r+=getGeneralStyle("margin-left","2px"),r+=getOverflowHiddenStyle(),r+=getWidthPercentStyle(100),r+="} ",r+="."+e+"form_inputs_help {",r+=getGeneralStyle("text-align","left"),r+=getGeneralStyle("color",settings[e+"labels"].font.color),r+=getGeneralStyle("font-family",settings[e+"labels"].font.family),r+=getGeneralStyle("font-size","11px"),r+=getGeneralStyle("margin-top","2px"),r+=getGeneralStyle("margin-left","2px"),r+=getOverflowHiddenStyle(),r+=getWidthPercentStyle(100),r+="} ",r+="."+e+"form_inputs_wrapper {",r+=getGeneralStyle("padding","0"),r+=getFloatRightStyle(),r+=getOverflowVisibleStyle(),r+=getWidthPercentStyle("left"==settings[e+"labels"].position?98-settings[e+"labels"].width:100),r+="} ",settings.hasOwnProperty(e+"opt_in")&&settings[e+"opt_in"].display&&(r+="#"+e+"form_input_opt_in_wrapper  {",r+="inputs"==settings[e+"opt_in"].align||"left"!=settings[e+"labels"].position?getFloatRightStyle():getFloatLeftStyle(),r+=getWidthPercentStyle("inputs"==settings[e+"opt_in"].align&&"left"==settings[e+"labels"].position?98-settings[e+"labels"].width:100),r+=getGeneralStyle("margin-top",settings[e+"opt_in"].margin+"px"),r+="} ",r+="#"+e+"form_input_opt_in {",r+=getFloatLeftStyle(),r+=getGeneralStyle("margin","0"),r+="} ",r+="#"+e+"form_input_opt_in_text {",r+=getGeneralStyle("margin","0"),r+=getFontStyle(settings[e+"opt_in"].font),r+=getLineHeightStyle(0===settings[e+"opt_in"].font.vspace||"0"===settings[e+"opt_in"].font.vspace||void 0===settings[e+"opt_in"].font.vspace?settings[e+"opt_in"].font.size:settings[e+"opt_in"].font.vspace),r+="} ");var l=0,_=0,g="";for(i=1;i<=customFieldsLimit;i++)o=e+"custom"+i,settings.hasOwnProperty(o)&&settings[o].display&&settings[o].hasOwnProperty("field_type")&&"radio"===settings[o].field_type&&settings[o].radio?(r+="."+e+"form_custom"+i+"_radio_labels {",r+=getLineHeightStyle(0===settings[o].radio.font.vspace||"0"===settings[o].radio.font.vspace||void 0===settings[o].radio.font.vspace?settings[o].radio.font.size:settings[o].radio.font.vspace),r+=getFontStyle(settings[o].radio.font),r+=getGeneralStyle("margin-left","5px"),r+="} ",r+="."+e+"form_custom"+i+"_radio_inputs {",r+=getGeneralStyle("width",settings[o].radio.size+"px"),r+=getGeneralStyle("height",settings[o].radio.size+"px"),r+=getGeneralStyle("margin-top","-3px"),r+=getGeneralStyle("vertical-align","middle"),r+="} "):settings.hasOwnProperty(o)&&settings[o].display&&settings[o].hasOwnProperty("field_type")&&"checkbox"===settings[o].field_type&&settings[o].checkbox?(l++,r+="#"+e+"form_input_custom"+i+"_checkbox_wrapper {","inputs"==settings[o].checkbox.align||"form"==settings[o].checkbox.align&&"left"!=settings[e+"labels"].position?(_=0,r+=getFloatRightStyle(),"inputs"==settings[o].checkbox.align&&"left"==settings[e+"labels"].position?r+=getWidthStyle(Math.floor(settings[e+"form"].width*(100-settings[e+"labels"].width)/100)-7):r+=getWidthStyle(settings[e+"form"].width-2)):"form"==settings[o].checkbox.align&&"left"==settings[e+"labels"].position?(_=0,r+=getFloatLeftStyle(),r+=getWidthStyle(settings[e+"form"].width-2)):"float2col"==settings[o].checkbox.align&&(_++,r+=getFloatLeftStyle(),(a=settings[e+"inputs"].spacing)<10&&(a=10),a>30&&(a=30),_%2==1&&(r+=getGeneralStyle("margin-right",a+"px")),r+=getWidthStyle(Math.floor((settings[e+"form"].width-a-4)/2))),r+=settings[e+"inputs"].hasOwnProperty("checkboxes_margin")&&settings[e+"inputs"].checkboxes_margin&&(1==l||2==l&&"float2col"==settings[o].checkbox.align&&"float2col"==settings[g].checkbox.align)?getGeneralStyle("margin-top",settings[e+"inputs"].spacing+settings[e+"inputs"].checkboxes_margin+"px"):getGeneralStyle("margin-top",settings[e+"inputs"].spacing+"px"),r+="} ",r+="#"+e+"form_input_custom"+i+" {",r+=getFloatLeftStyle(),r+=getGeneralStyle("margin","0"),r+="} ",r+="#"+e+"form_input_custom"+i+"_checkbox_text {",r+=getGeneralStyle("margin","0"),r+=getLineHeightStyle(0===settings[o].checkbox.font.vspace||"0"===settings[o].checkbox.font.vspace||void 0===settings[o].checkbox.font.vspace?settings[o].checkbox.font.size:settings[o].checkbox.font.vspace),r+=getFontStyle(settings[o].checkbox.font),r+="} ",g=o):settings.hasOwnProperty(o)&&settings[o].display&&(!settings[o].hasOwnProperty("field_type")||"hidden"!==settings[o].field_type)&&(_=0,logger("(BOX #"+LIGHTBOX_SHORT_ID+") - "+o+" checkbox not found."));settings[e+"form"].hasOwnProperty("css")&&settings[e+"form"].css&&(r+=settings[e+"form"].css)}UTIL.stringOrArrayContains(e,"_")&&(e=e.split("_")[0]),""===e?$("head").append('<style id="element_styles" type="text/css">'+r+"</style>"):$("head").append('<style id="element_styles_'+e+'" type="text/css">'+r+"</style>")}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildStyles")}}function buildFormName(e,t){var r,s;if(""!==e&&-1===e.indexOf("_")&&(e+="_"),settings.hasOwnProperty(e+"name")&&settings[e+"name"].display&&(r="","hidden"===settings[e+"name"].hidden&&(r="display: none;"),t.append("<div id='"+e+"form_label_name' class='"+e+"form_labels' style='"+r+"'>"+settings[e+"name"].label+"<span id='"+e+"form_label_name_required' class='"+e+"form_labels_required'></span></div>"),settings[e+"name"].require&&settings[e+"labels"].required.text.length>0&&$("#"+e+"form_label_name_required").text(settings[e+"labels"].required.text),settings[e+"name"].hasOwnProperty("label_subtext")&&settings[e+"name"].label_subtext&&$("#"+e+"form_label_name").after("<div id='"+e+"form_label_subtext_name' class='"+e+"form_labels' style='"+r+"'>"+settings[e+"name"].label_subtext+"</div>"),"left"==settings[e+"labels"].position?($("#"+e+"form_label_name").addClass(e+"form_labels_left"),$("#"+e+"form_label_subtext_name").addClass(e+"form_labels_hide").addClass(e+"form_labels_subtext").hide()):"above"==settings[e+"labels"].position?($("#"+e+"form_label_name").addClass(e+"form_labels_above"),$("#"+e+"form_label_subtext_name").addClass(e+"form_labels_above").addClass(e+"form_labels_subtext"),UTIL.isNullOrWhitespace(settings[e+"name"].label)&&$("#"+e+"form_label_name").css({height:"0px"}),UTIL.isNullOrWhitespace(settings[e+"name"].label_subtext)&&$("#"+e+"form_label_subtext_name").css({height:"0px"})):($("#"+e+"form_label_name").addClass(e+"form_labels_hide"),$("#"+e+"form_label_subtext_name").addClass(e+"form_labels_hide").addClass(e+"form_labels_subtext")),"full"==settings[e+"name"].mode?("hidden"!==settings[e+"name"].hidden&&t.append("<label id='"+e+"form_input_name_ada_label' for='"+e+"form_input_full_name' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[e+"name"].label+"</label>"),t.append("<div id='"+e+"form_input_full_name_wrapper' class='"+e+"form_inputs_wrapper' style='"+r+"'><input type='text' id='"+e+"form_input_full_name' class='"+e+"form_inputs' /><div id='"+e+"form_input_full_name_help' class='"+e+"form_inputs_help'></div><div id='"+e+"form_input_name_error_text' class='"+e+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[e+"name"].default_full&&$("#"+e+"form_input_full_name").val(settings[e+"name"].default_full),settings[e+"name"].placeholder_full&&$("#"+e+"form_input_full_name").attr("placeholder",settings[e+"name"].placeholder_full),settings[e+"name"].display_help?$("#"+e+"form_input_full_name_help").text(settings[e+"name"].help_full):$("#"+e+"form_input_full_name_help").hide(),IS_MOBILE||$("#"+e+"form_input_full_name").hover((function(){$(this).addClass(e+"form_inputs_hover")}),(function(){$(this).removeClass(e+"form_inputs_hover")})),$("#"+e+"form_input_full_name").focus((function(){$(this).addClass(e+"form_inputs_focus")})).blur((function(){$(this).removeClass(e+"form_inputs_focus")})),$("#"+e+"form_input_full_name").keypress((function(t){13==t.which&&(t.preventDefault(),processSubmit(e,!1,!1,!0))}))):"first"==settings[e+"name"].mode?("hidden"!==settings[e+"name"].hidden&&t.append("<label id='"+e+"form_input_name_ada_label' for='"+e+"form_input_first_name' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[e+"name"].label+"</label>"),t.append("<div id='"+e+"form_input_first_name_wrapper' class='"+e+"form_inputs_wrapper' style='"+r+"'><input type='text' id='"+e+"form_input_first_name' class='"+e+"form_inputs' /><div id='"+e+"form_input_first_name_help' class='"+e+"form_inputs_help'></div><div id='"+e+"form_input_name_error_text' class='"+e+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[e+"name"].default_first&&$("#"+e+"form_input_first_name").val(settings[e+"name"].default_first),settings[e+"name"].placeholder_first&&$("#"+e+"form_input_first_name").attr("placeholder",settings[e+"name"].placeholder_first),settings[e+"name"].display_help?$("#"+e+"form_input_first_name_help").text(settings[e+"name"].help_first):$("#"+e+"form_input_first_name_help").hide(),IS_MOBILE||$("#"+e+"form_input_first_name").hover((function(){$(this).addClass(e+"form_inputs_hover")}),(function(){$(this).removeClass(e+"form_inputs_hover")})),$("#"+e+"form_input_first_name").focus((function(){$(this).addClass(e+"form_inputs_focus")})).blur((function(){$(this).removeClass(e+"form_inputs_focus")})),$("#"+e+"form_input_first_name").keypress((function(t){13==t.which&&(t.preventDefault(),processSubmit(e,!1,!1,!0))}))):"both"==settings[e+"name"].mode&&("hidden"!==settings[e+"name"].hidden&&t.append("<label id='"+e+"form_input_name_ada_label' for='"+e+"form_input_first_name' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[e+"name"].label+"</label>"),"horizontal"==settings[e+"name"].arrange?(t.append("<div id='"+e+"form_input_first_and_last_name_wrapper' class='"+e+"form_inputs_wrapper' style='"+r+"'>  <div id='"+e+"form_input_first_name_wrapper'><input type='text' id='"+e+"form_input_first_name' class='"+e+"form_inputs' /><div id='"+e+"form_input_first_name_help' class='"+e+"form_inputs_help'></div></div>  <div id='"+e+"form_input_last_name_wrapper'><input type='text' id='"+e+"form_input_last_name' class='"+e+"form_inputs' /><div id='"+e+"form_input_last_name_help' class='"+e+"form_inputs_help'></div></div>  <div id='"+e+"form_input_name_error_text' class='"+e+"form_inputs_error_text'></div>  </div>  <div style='float: none; clear: both;'></div>"),$("#"+e+"form_input_last_name_wrapper").css({float:"right",width:"48%"}),$("#"+e+"form_input_first_name_wrapper").css({float:"left",width:"48%"})):(t.append("<div id='"+e+"form_input_first_and_last_name_wrapper' class='"+e+"form_inputs_wrapper' style='"+r+"'>  <div id='"+e+"form_input_first_name_wrapper'><input type='text' id='"+e+"form_input_first_name' class='"+e+"form_inputs' /><div id='"+e+"form_input_first_name_help' class='"+e+"form_inputs_help'></div></div>  <div id='"+e+"form_input_last_name_wrapper'><input type='text' id='"+e+"form_input_last_name' class='"+e+"form_inputs' /><div id='"+e+"form_input_last_name_help' class='"+e+"form_inputs_help'></div></div>  <div id='"+e+"form_input_name_error_text' class='"+e+"form_inputs_error_text'></div>  </div>  <div style='float: none; clear: both;'></div>"),$("#"+e+"form_input_last_name_wrapper").css({float:"right",width:"100%","margin-top":settings[e+"inputs"].spacing+"px"}),$("#"+e+"form_input_first_name_wrapper").css({float:"right",width:"100%"})),settings[e+"name"].default_last&&$("#"+e+"form_input_last_name").val(settings[e+"name"].default_last),settings[e+"name"].default_first&&$("#"+e+"form_input_first_name").val(settings[e+"name"].default_first),settings[e+"name"].placeholder_last&&$("#"+e+"form_input_last_name").attr("placeholder",settings[e+"name"].placeholder_last),settings[e+"name"].placeholder_first&&$("#"+e+"form_input_first_name").attr("placeholder",settings[e+"name"].placeholder_first),settings[e+"name"].display_help?$("#"+e+"form_input_last_name_help").text(settings[e+"name"].help_last):$("#"+e+"form_input_last_name_help").hide(),settings[e+"name"].display_help?$("#"+e+"form_input_first_name_help").text(settings[e+"name"].help_first):$("#"+e+"form_input_first_name_help").hide(),IS_MOBILE||$("#"+e+"form_input_last_name").hover((function(){$(this).addClass(e+"form_inputs_hover")}),(function(){$(this).removeClass(e+"form_inputs_hover")})),$("#"+e+"form_input_last_name").focus((function(){$(this).addClass(e+"form_inputs_focus")})).blur((function(){$(this).removeClass(e+"form_inputs_focus")})),IS_MOBILE||$("#"+e+"form_input_first_name").hover((function(){$(this).addClass(e+"form_inputs_hover")}),(function(){$(this).removeClass(e+"form_inputs_hover")})),$("#"+e+"form_input_first_name").focus((function(){$(this).addClass(e+"form_inputs_focus")})).blur((function(){$(this).removeClass(e+"form_inputs_focus")})),$("#"+e+"form_input_last_name").keypress((function(t){13==t.which&&(t.preventDefault(),processSubmit(e,!1,!1,!0))})),$("#"+e+"form_input_first_name").keypress((function(t){13==t.which&&(t.preventDefault(),processSubmit(e,!1,!1,!0))}))),settings[e+"name"].hasOwnProperty("metadata_kvps")))for(s=0;s<settings[e+"name"].metadata_kvps.length;s++)settings[e+"name"].metadata_kvps[s].k&&settings[e+"name"].metadata_kvps[s].v&&($("#"+e+"form_input_full_name").length&&UTIL.trySetAttribute(e+"form_input_full_name",settings[e+"name"].metadata_kvps[s],$),$("#"+e+"form_input_first_name").length&&UTIL.trySetAttribute(e+"form_input_first_name",settings[e+"name"].metadata_kvps[s],$),$("#"+e+"form_input_last_name").length&&UTIL.trySetAttribute(e+"form_input_last_name",settings[e+"name"].metadata_kvps[s],$))}function buildFormEmail(e,t){var r,s;if(""!==e&&(e+="_"),settings.hasOwnProperty(e+"email")&&settings[e+"email"].display&&(r="","hidden"===settings[e+"email"].hidden&&(r="display: none;"),"hidden"!==settings[e+"email"].hidden&&t.append("<label id='"+e+"form_input_email_ada_label' for='"+e+"form_input_email' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[e+"email"].label+"</label>"),t.append("<div id='"+e+"form_label_email' class='"+e+"form_labels "+e+"form_spacing' style='"+r+"'>"+settings[e+"email"].label+"<span id='"+e+"form_label_email_required' class='"+e+"form_labels_required'></span></div>"),t.append("<div id='"+e+"form_input_email_wrapper' class='"+e+"form_inputs_wrapper' style='"+r+"'><input type='text' id='"+e+"form_input_email' class='"+e+"form_inputs' /><div id='"+e+"form_input_email_help' class='"+e+"form_inputs_help'></div><div id='"+e+"form_input_email_error_text' class='"+e+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[e+"email"].require&&settings[e+"labels"].required.text.length>0&&$("#"+e+"form_label_email_required").text(settings[e+"labels"].required.text),settings[e+"email"].hasOwnProperty("label_subtext")&&settings[e+"email"].label_subtext&&$("#"+e+"form_label_email").after("<div id='"+e+"form_label_subtext_email' class='"+e+"form_labels' style='"+r+"'>"+settings[e+"email"].label_subtext+"</div>"),"left"==settings[e+"labels"].position?($("#"+e+"form_label_email").addClass(e+"form_labels_left"),$("#"+e+"form_input_email_wrapper").addClass(e+"form_spacing"),$("#"+e+"form_label_subtext_email").addClass(e+"form_labels_hide").addClass(e+"form_labels_subtext").hide()):"above"==settings[e+"labels"].position?($("#"+e+"form_label_email").addClass(e+"form_labels_above"),$("#"+e+"form_label_subtext_email").addClass(e+"form_labels_above").addClass(e+"form_labels_subtext"),UTIL.isNullOrWhitespace(settings[e+"email"].label)&&$("#"+e+"form_label_email").css({height:"0px"}),UTIL.isNullOrWhitespace(settings[e+"email"].label_subtext)&&$("#"+e+"form_label_subtext_email").css({height:"0px"})):($("#"+e+"form_label_email").addClass(e+"form_labels_hide"),$("#"+e+"form_input_email_wrapper").addClass(e+"form_spacing"),$("#"+e+"form_label_subtext_email").addClass(e+"form_labels_hide").addClass(e+"form_labels_subtext")),settings[e+"email"].default&&$("#"+e+"form_input_email").val(settings[e+"email"].default),settings[e+"email"].placeholder&&$("#"+e+"form_input_email").attr("placeholder",settings[e+"email"].placeholder),settings[e+"email"].display_help?$("#"+e+"form_input_email_help").text(settings[e+"email"].help):$("#"+e+"form_input_email_help").hide(),IS_MOBILE||$("#"+e+"form_input_email").hover((function(){$(this).addClass(e+"form_inputs_hover")}),(function(){$(this).removeClass(e+"form_inputs_hover")})),$("#"+e+"form_input_email").focus((function(){$(this).addClass(e+"form_inputs_focus")})).blur((function(){$(this).removeClass(e+"form_inputs_focus")})),$("#"+e+"form_input_email").keypress((function(t){13==t.which&&(t.preventDefault(),processSubmit(e,!1,!1,!0))})),$("#"+e+"form_input_email").length&&settings[e+"email"].hasOwnProperty("metadata_kvps")))for(s=0;s<settings[e+"email"].metadata_kvps.length;s++)settings[e+"email"].metadata_kvps[s].k&&settings[e+"email"].metadata_kvps[s].v&&UTIL.trySetAttribute(e+"form_input_email",settings[e+"email"].metadata_kvps[s],$)}function buildFormPhone(e,t){var r,s,n,i,o;if(""!==e&&(e+="_"),settings.hasOwnProperty(e+"phone")&&settings[e+"phone"].display){if(r="","hidden"===settings[e+"phone"].hidden&&(r="display: none;"),"hidden"!==settings[e+"phone"].hidden&&t.append("<label id='"+e+"form_input_phone_ada_label' for='"+e+"form_input_phone' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[e+"phone"].label+"</label>"),t.append("<div id='"+e+"form_label_phone' class='"+e+"form_labels "+e+"form_spacing' style='"+r+"'>"+settings[e+"phone"].label+"<span id='"+e+"form_label_phone_required' class='"+e+"form_labels_required'></span></div>"),s="<div id='"+e+"form_input_phone_wrapper' class='"+e+"form_inputs_wrapper' style='"+r+"'>",settings[e+"phone"].enable_country_code&&settings[e+"phone"].country_code&&(n=settings[e+"phone"].country_code.split(","),i="<select id='"+e+"form_input_country_code' class='"+e+"form_inputs' style='width: 25%; border-right: none;'>",n.forEach((function(e){"all"!==e.trim()&&(i+="<option value='"+e.trim()+"'>"+e.trim()+"</option>")})),s+=i+="</select>"),s+="<input type='text' id='"+e+"form_input_phone' class='"+e+"form_inputs' autocomplete='"+(settings[e+"phone"].enable_country_code?"tel-national":"tel")+"' inputmode='tel' style='width: "+(settings[e+"phone"].enable_country_code?"75%":"100%")+"; "+(settings[e+"phone"].enable_country_code?"border-left: none;":"")+"' />",s+="<div id='"+e+"form_input_phone_help' class='"+e+"form_inputs_help'></div></div><div style='float: none; clear: both;'></div><div id='"+e+"form_input_phone_error_text' class='"+e+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>",t.append(s),settings[e+"phone"].enable_country_code&&settings[e+"phone"].country_code){let t=$("#"+e+"form_input_phone."+e+"form_inputs")[0],r=$("#"+e+"form_input_country_code."+e+"form_inputs")[0];if(t&&r){let s=settings[e+"inputs"]&&settings[e+"inputs"].border?getBorderStyle(settings[e+"inputs"].border):null;if(s){let e=s.match(/border-radius:\s*([\dpx\s]+)/),n=e?e[1].trim():null;n&&(t.style.borderRadius=`0px ${n} ${n} 0px`,r.style.borderRadius=`${n} 0px 0px ${n}`)}}}if(settings[e+"phone"].require&&settings[e+"labels"].required.text.length>0&&$("#"+e+"form_label_phone_required").text(settings[e+"labels"].required.text),settings[e+"phone"].hasOwnProperty("label_subtext")&&settings[e+"phone"].label_subtext&&$("#"+e+"form_label_phone").after("<div id='"+e+"form_label_subtext_phone' class='"+e+"form_labels' style='"+r+"'>"+settings[e+"phone"].label_subtext+"</div>"),"left"==settings[e+"labels"].position?($("#"+e+"form_label_phone").addClass(e+"form_labels_left"),$("#"+e+"form_input_phone_wrapper").addClass(e+"form_spacing"),$("#"+e+"form_label_subtext_phone").addClass(e+"form_labels_hide").addClass(e+"form_labels_subtext").hide()):"above"==settings[e+"labels"].position?($("#"+e+"form_label_phone").addClass(e+"form_labels_above"),$("#"+e+"form_label_subtext_phone").addClass(e+"form_labels_above").addClass(e+"form_labels_subtext"),UTIL.isNullOrWhitespace(settings[e+"phone"].label)&&$("#"+e+"form_label_phone").css({height:"0px"}),UTIL.isNullOrWhitespace(settings[e+"phone"].label_subtext)&&$("#"+e+"form_label_subtext_phone").css({height:"0px"}).addClass(e+"form_labels_subtext")):($("#"+e+"form_label_phone").addClass(e+"form_labels_hide"),$("#"+e+"form_input_phone_wrapper").addClass(e+"form_spacing"),$("#"+e+"form_label_subtext_phone").addClass(e+"form_labels_hide").addClass(e+"form_labels_subtext")),settings[e+"phone"].default&&$("#"+e+"form_input_phone").val(settings[e+"phone"].default),settings[e+"phone"].placeholder&&$("#"+e+"form_input_phone").attr("placeholder",settings[e+"phone"].placeholder),settings[e+"phone"].display_help?$("#"+e+"form_input_phone_help").text(settings[e+"phone"].help):$("#"+e+"form_input_phone_help").hide(),IS_MOBILE||$("#"+e+"form_input_phone").hover((function(){$(this).addClass(e+"form_inputs_hover")}),(function(){$(this).removeClass(e+"form_inputs_hover")})),$("#"+e+"form_input_phone").focus((function(){$(this).addClass(e+"form_inputs_focus")})).blur((function(){$(this).removeClass(e+"form_inputs_focus")})),$("#"+e+"form_input_phone").keypress((function(t){13==t.which&&(t.preventDefault(),processSubmit(e,!1,!1,!0))})),settings[e+"phone"].enable_country_code&&settings[e+"phone"].country_code?$("#"+e+"form_input_phone").on("input",(function(){let t,r=$(this).val().replace(/\D/g,""),s=$("#"+e+"form_input_country_code").val().replace(/\D/g,"");if(settings[e+"phone"].submit_format){t=(settings[e+"phone"].submit_format.startsWith("+1")||settings[e+"phone"].submit_format.startsWith("1")?settings[e+"phone"].submit_format.replace(/^(\+1|1)/,"x"):settings[e+"phone"].submit_format).split("x").length-1}else t=15;r.length+s.length>t&&(r=r.slice(0,t-s.length)),$(this).val(r)})):$("#"+e+"form_input_phone").length&&!boxapi.getFieldMetadata(e,"phone","phone_display")&&settings[e+"phone"].hasOwnProperty("display_format")&&settings[e+"phone"].display_format&&$("#"+e+"form_input_phone").on("input",(function(){formatPhoneDisplay($(this),settings[e+"phone"].display_format,e)})),$("#"+e+"form_input_phone").length&&settings[e+"phone"].hasOwnProperty("metadata_kvps"))for(o=0;o<settings[e+"phone"].metadata_kvps.length;o++)settings[e+"phone"].metadata_kvps[o].k&&settings[e+"phone"].metadata_kvps[o].v&&UTIL.trySetAttribute(e+"form_input_phone",settings[e+"phone"].metadata_kvps[o],$)}}function buildFormOptIn(e,t){var r,s;if(""!==e&&(e+="_"),settings.hasOwnProperty(e+"opt_in")&&settings[e+"opt_in"].display&&(r="","hidden"===settings[e+"opt_in"].hidden&&(r="display: none;"),t.append("<div id='"+e+"form_input_opt_in_wrapper' style='"+r+"'><input type='checkbox' id='"+e+"form_input_opt_in' /><p id='"+e+"form_input_opt_in_text'>"+settings[e+"opt_in"].text+"</p> <div style='float: none; clear: both;'></div> <div id='"+e+"form_input_opt_in_error_text' class='"+e+"form_inputs_error_text'></div></div>"),settings[e+"opt_in"].font.size<=10?$("#"+e+"form_input_opt_in_text").css({"margin-top":"2px","margin-left":"20px"}):settings[e+"opt_in"].font.size>10&&settings[e+"opt_in"].font.size<14?$("#"+e+"form_input_opt_in_text").css({"margin-top":"1px","margin-left":"20px"}):settings[e+"opt_in"].font.size>=14&&$("#"+e+"form_input_opt_in_text").css({"margin-top":"-1px","margin-left":"20px"}),settings[e+"opt_in"].hasOwnProperty("default")&&"on"===settings[e+"opt_in"].default&&$("#"+e+"form_input_opt_in").prop("checked",!0).attr("checked","checked"),$("#"+e+"form_input_opt_in").keypress((function(e){13==(e.keyCode?e.keyCode:e.which)&&$(this).trigger("click")})),$("#"+e+"form_input_opt_in").change((function(){this.checked?$(this).attr("checked","checked"):$(this).removeAttr("checked")})),$("#"+e+"form_input_opt_in").length&&settings[e+"opt_in"].hasOwnProperty("metadata_kvps")))for(s=0;s<settings[e+"opt_in"].metadata_kvps.length;s++)settings[e+"opt_in"].metadata_kvps[s].k&&settings[e+"opt_in"].metadata_kvps[s].v&&UTIL.trySetAttribute(e+"form_input_opt_in",settings[e+"opt_in"].metadata_kvps[s],$)}function buildFormCustomN(e,t,r){var s,n,i,o,a,l,_,g,p,u,m,d,h,c,f,O,y,b,w;if(e&&""!==e&&-1===e.indexOf("_")&&(e+="_"),s=t,t.indexOf("_")>0&&t.indexOf("custom")>0&&(s=t.split("_")[1]),n=t.split("custom")[1],settings.hasOwnProperty(t)&&settings[t].display){if(settings[t].hasOwnProperty("align")&&"h"==settings[t].align&&settings[t].hasOwnProperty("field_type")&&"radio"!==settings[t].field_type&&"checkbox"!==settings[t].field_type&&"hidden"!==settings[t].field_type){for(r.append("<div id='"+e+"form_float_"+s+"' style=''></div>"),r=$("#"+e+"form_float_"+s),i=1,a=n-1;a>0&&(settings.hasOwnProperty(e+"custom"+a)&&settings[e+"custom"+a].display&&settings[e+"custom"+a].hasOwnProperty("align")&&"h"==settings[e+"custom"+a].align&&settings[e+"custom"+a].hasOwnProperty("field_type")&&"radio"!==settings[e+"custom"+a].field_type&&"checkbox"!==settings[e+"custom"+a].field_type&&"hidden"!==settings[e+"custom"+a].field_type);a--)i++;if(i>1){for(o=settings[e+"form"].width/i-settings[e+"inputs"].spacing*(i-1)/i,a=n;a>n-i;a--)$("#"+e+"form_float_custom"+a).css({width:o+"px",float:"left"}),a>n-i+1&&($("#"+e+"form_float_custom"+a).css({"margin-left":settings[e+"inputs"].spacing+"px"}),$("#"+e+"form_float_custom"+a+"_clear").length&&$("#"+e+"form_float_custom"+a+"_clear").remove());r.after("<div id='"+e+"form_float_"+s+"_clear' style='float:none;clear:both;'></div>")}}if(settings[t].hasOwnProperty("field_type")&&"hidden"!==settings[t].field_type&&"checkbox"!==settings[t].field_type&&"radio"!==settings[t].field_type&&!UTIL.isNullOrWhitespace(settings[t].label)&&r.append("<label id='"+e+"form_input_"+s+"_ada_label' for='"+e+"form_input_"+s+"' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[t].label+"</label>"),settings[t].hasOwnProperty("field_type")&&"textbox"!=settings[t].field_type)if("textarea"==settings[t].field_type)r.append("<div id='"+e+"form_label_"+s+"' class='"+e+"form_labels "+e+"form_spacing'>"+settings[t].label+"<span id='"+e+"form_label_"+s+"_required' class='"+e+"form_labels_required'></span></div>"),r.append("<div id='"+e+"form_input_"+s+"_wrapper' class='"+e+"form_inputs_wrapper'><textarea id='"+e+"form_input_"+s+"' class='"+e+"form_inputs' style='height: "+settings[t].textarea_height+"px; margin-bottom: 0px;'></textarea><div id='"+e+"form_input_"+s+"_help' class='"+e+"form_inputs_help' style='margin-top: 0px;'></div><div id='"+e+"form_input_"+s+"_error_text' class='"+e+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[t].placeholder&&$("#"+e+"form_input_"+s).attr("placeholder",settings[t].placeholder),settings[t].default&&$("#"+e+"form_input_"+s).val(settings[t].default);else if("datepicker"==settings[t].field_type&&settings[t].datepicker)r.append("<div id='"+e+"form_label_"+s+"' class='"+e+"form_labels "+e+"form_spacing'>"+settings[t].label+"<span id='"+e+"form_label_"+s+"_required' class='"+e+"form_labels_required'></span></div>"),r.append("<div id='"+e+"form_input_"+s+"_wrapper' class='"+e+"form_inputs_wrapper'><input type='text' id='"+e+"form_input_"+s+"' class='"+e+"form_inputs' /><div id='"+e+"form_input_"+s+"_help' class='"+e+"form_inputs_help'></div><div id='"+e+"form_input_"+s+"_error_text' class='"+e+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),UTIL.isNullOrWhitespace(settings[t].placeholder)||$("#"+e+"form_input_"+s).attr("placeholder",settings[t].placeholder),initDatepicker(e,t,s);else if("datedrop"==settings[t].field_type&&settings[t].datedrop){r.append("<div id='"+e+"form_label_"+s+"' class='"+e+"form_labels "+e+"form_spacing'>"+settings[t].label+"<span id='"+e+"form_label_"+s+"_required' class='"+e+"form_labels_required'></span></div>"),"MM-dd-yyyy"==settings[t].datedrop.display_format||""==settings[t].datedrop.display_format?(l="<div id='"+e+"form_input_"+s+"_wrapper' class='"+e+"form_inputs_wrapper'>",l+="<div id='"+e+"form_input_"+s+"_datedrop_mm_wrapper'><select id='"+e+"form_input_"+s+"_datedrop_mm' class='"+e+"form_inputs'><option value='MM'>MM</option></select><div id='"+e+"form_input_"+s+"_datedrop_mm_help' class='"+e+"form_inputs_help'></div></div>",l+="<div id='"+e+"form_input_"+s+"_datedrop_dd_wrapper'><select id='"+e+"form_input_"+s+"_datedrop_dd' class='"+e+"form_inputs'><option value='dd'>DD</option></select><div id='"+e+"form_input_"+s+"_datedrop_dd_help' class='"+e+"form_inputs_help'></div></div>",l+="<div id='"+e+"form_input_"+s+"_datedrop_yyyy_wrapper'><select id='"+e+"form_input_"+s+"_datedrop_yyyy' class='"+e+"form_inputs'><option value='yyyy'>YYYY</option></select><div id='"+e+"form_input_"+s+"_datedrop_yyyy_help' class='"+e+"form_inputs_help'></div></div>",l+="<div id='"+e+"form_input_"+s+"_help' class='"+e+"form_inputs_help'></div><div id='"+e+"form_input_"+s+"_error_text' class='"+e+"form_inputs_error_text'></div>",l+="</div>",l+="<div style='float: none; clear: both;'></div>",r.append(l),$("#"+e+"form_input_"+s+"_datedrop_yyyy_wrapper").css({float:"right",width:"38%"}),$("#"+e+"form_input_"+s+"_datedrop_mm_wrapper").css({float:"left",width:"28%","margin-right":"3%"}),$("#"+e+"form_input_"+s+"_datedrop_dd_wrapper").css({float:"left",width:"28%"})):"dd-MM-yyyy"==settings[t].datedrop.display_format?(l="<div id='"+e+"form_input_"+s+"_wrapper' class='"+e+"form_inputs_wrapper'>",l+="<div id='"+e+"form_input_"+s+"_datedrop_dd_wrapper'><select id='"+e+"form_input_"+s+"_datedrop_dd' class='"+e+"form_inputs'><option value='dd'>DD</option></select><div id='"+e+"form_input_"+s+"_datedrop_dd_help' class='"+e+"form_inputs_help'></div></div>",l+="<div id='"+e+"form_input_"+s+"_datedrop_mm_wrapper'><select id='"+e+"form_input_"+s+"_datedrop_mm' class='"+e+"form_inputs'><option value='MM'>MM</option></select><div id='"+e+"form_input_"+s+"_datedrop_mm_help' class='"+e+"form_inputs_help'></div></div>",l+="<div id='"+e+"form_input_"+s+"_datedrop_yyyy_wrapper'><select id='"+e+"form_input_"+s+"_datedrop_yyyy' class='"+e+"form_inputs'><option value='yyyy'>YYYY</option></select><div id='"+e+"form_input_"+s+"_datedrop_yyyy_help' class='"+e+"form_inputs_help'></div></div>",l+="<div id='"+e+"form_input_"+s+"_help' class='"+e+"form_inputs_help'></div><div id='"+e+"form_input_"+s+"_error_text' class='"+e+"form_inputs_error_text'></div>",l+="</div>",l+="<div style='float: none; clear: both;'></div>",r.append(l),$("#"+e+"form_input_"+s+"_datedrop_yyyy_wrapper").css({float:"right",width:"38%"}),$("#"+e+"form_input_"+s+"_datedrop_dd_wrapper").css({float:"left",width:"28%","margin-right":"3%"}),$("#"+e+"form_input_"+s+"_datedrop_mm_wrapper").css({float:"left",width:"28%"})):"yyyy-MM-dd"==settings[t].datedrop.display_format&&(l="<div id='"+e+"form_input_"+s+"_wrapper' class='"+e+"form_inputs_wrapper'>",l+="<div id='"+e+"form_input_"+s+"_datedrop_yyyy_wrapper'><select id='"+e+"form_input_"+s+"_datedrop_yyyy' class='"+e+"form_inputs'><option value='yyyy'>YYYY</option></select><div id='"+e+"form_input_"+s+"_datedrop_yyyy_help' class='"+e+"form_inputs_help'></div></div>",l+="<div id='"+e+"form_input_"+s+"_datedrop_dd_wrapper'><select id='"+e+"form_input_"+s+"_datedrop_dd' class='"+e+"form_inputs'><option value='dd'>DD</option></select><div id='"+e+"form_input_"+s+"_datedrop_dd_help' class='"+e+"form_inputs_help'></div></div>",l+="<div id='"+e+"form_input_"+s+"_datedrop_mm_wrapper'><select id='"+e+"form_input_"+s+"_datedrop_mm' class='"+e+"form_inputs'><option value='MM'>MM</option></select><div id='"+e+"form_input_"+s+"_datedrop_mm_help' class='"+e+"form_inputs_help'></div></div>",l+="<div id='"+e+"form_input_"+s+"_help' class='"+e+"form_inputs_help'></div><div id='"+e+"form_input_"+s+"_error_text' class='"+e+"form_inputs_error_text'></div>",l+="</div>",l+="<div style='float: none; clear: both;'></div>",r.append(l),$("#"+e+"form_input_"+s+"_datedrop_yyyy_wrapper").css({float:"left",width:"38%"}),$("#"+e+"form_input_"+s+"_datedrop_dd_wrapper").css({float:"right",width:"28%"}),$("#"+e+"form_input_"+s+"_datedrop_mm_wrapper").css({float:"right",width:"28%","margin-right":"3%"}));var P=$("#"+e+"form_input_"+s+"_datedrop_yyyy"),x=$("#"+e+"form_input_"+s+"_datedrop_mm"),S=$("#"+e+"form_input_"+s+"_datedrop_dd"),I=settings[t].datedrop.min_date,R=settings[t].datedrop.max_date,T=settings[t].datedrop.default_date,v=!1,A=1900;for(I&&3==I.split("/").length&&4==I.split("/")[2].trim().length&&(A=parseInt(I.split("/")[2].trim())),_=(new Date).getFullYear(),R&&3==R.split("/").length&&4==R.split("/")[2].trim().length&&(_=parseInt(R.split("/")[2].trim())),g="",T&&3==T.split("/").length&&4==T.split("/")[2].trim().length&&(g=parseInt(T.split("/")[2].trim())),p="",T&&3==T.split("/").length&&2==T.split("/")[0].trim().length&&(p=parseInt(T.split("/")[0].trim())),u="",T&&3==T.split("/").length&&2==T.split("/")[1].trim().length&&(u=parseInt(T.split("/")[1].trim())),c=_;c>=A;c--)v||c!==g?P.append("<option value='"+c+"'>"+c+"</option>"):(P.append("<option selected value='"+c+"'>"+c+"</option>"),v=!0);for(v=!1,m="",c=1;c<=12;c++)m=c<10?"0"+c:c,v||c!==p?x.append("<option value='"+c+"'>"+m+"</option>"):(x.append("<option selected value='"+c+"'>"+m+"</option>"),v=!0);for(v=!1,d="",c=1;c<=31;c++)d=c<10?"0"+c:c,v||c!==u?S.append("<option value='"+c+"'>"+d+"</option>"):(S.append("<option selected value='"+c+"'>"+d+"</option>"),v=!0)}else if("dropdown"==settings[t].field_type){if(r.append("<div id='"+e+"form_label_"+s+"' class='"+e+"form_labels "+e+"form_spacing'>"+settings[t].label+"<span id='"+e+"form_label_"+s+"_required' class='"+e+"form_labels_required'></span></div>"),r.append("<div id='"+e+"form_input_"+s+"_wrapper' class='"+e+"form_inputs_wrapper'><select id='"+e+"form_input_"+s+"' class='"+e+"form_inputs'></select><div id='"+e+"form_input_"+s+"_help' class='"+e+"form_inputs_help'></div><div id='"+e+"form_input_"+s+"_error_text' class='"+e+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[t].dropdown_kvps.length>0){var D=$("#"+e+"form_input_"+s),E=settings[t].dropdown_kvps;v=!1;for(c=0;c<E.length;c++)v||!settings[t].default||E[c].k!=settings[t].default&&E[c].v!=settings[t].default?D.append(new Option(E[c].v,E[c].k)):D.append(new Option(E[c].v,E[c].k,!0,!0))}}else if("radio"==settings[t].field_type){if(settings[t].hasOwnProperty("hide_label")&&"show"===settings[t].hide_label&&r.append("<div id='"+e+"form_label_"+s+"' class='"+e+"form_labels "+e+"form_spacing'>"+settings[t].label+"<span id='"+e+"form_label_"+s+"_required' class='"+e+"form_labels_required'></span></div>"),h=e+"form_input_"+s+"_radio_wrapper",r.append("<div id='"+h+"'></div>"),settings[t].radio.kvps.length>0){var C=$("#"+h),L=(E=settings[t].radio.kvps,10);for("number"==typeof settings[t].radio.margin&&(L=settings[t].radio.margin),v=!1,c=0;c<E.length;c++)v||!settings[t].radio.default||E[c].k!=settings[t].radio.default&&E[c].v!=settings[t].radio.default?C.append("<div class='"+e+"form_"+s+"_radio_line_item' style='margin-bottom:"+L+"px;'><input type='radio' class='"+e+"form_"+s+"_radio_inputs' id='"+e+"form_input_"+s+"_"+c+"' name='"+e+"form_input_"+s+"'><label class='"+e+"form_"+s+"_radio_labels' id='"+e+"form_label_"+s+"_"+c+"' for='"+e+"form_input_"+s+"_"+c+"'></label></div>"):C.append("<div class='"+e+"form_"+s+"_radio_line_item' style='margin-bottom:"+L+"px;'><input checked type='radio' class='"+e+"form_"+s+"_radio_inputs' id='"+e+"form_input_"+s+"_"+c+"' name='"+e+"form_input_"+s+"'><label class='"+e+"form_"+s+"_radio_labels' id='"+e+"form_label_"+s+"_"+c+"' for='"+e+"form_input_"+s+"_"+c+"'></label></div>"),$("#"+e+"form_input_"+s+"_"+c).val(E[c].k),$("#"+e+"form_label_"+s+"_"+c).html(E[c].v);(f=settings[e+"inputs"].spacing)>L&&(L=f),$("#"+h).css({"margin-top":L+"px"}),C.append("<div id='"+e+"form_input_"+s+"_error_text' class='"+e+"form_inputs_error_text'></div>"),"h"==settings[t].radio.align&&($("."+e+"form_"+s+"_radio_line_item").css({float:"left","margin-right":"15px"}),C.append("<div style='float:none;clear:both;'></div>")),settings[t].hasOwnProperty("hide_label")&&"show"===settings[t].hide_label&&"left"==settings[e+"labels"].position&&(O=C.height(),$("#"+e+"form_label_"+s).height()<O&&$("#"+e+"form_label_"+s).height(O),setTimeout((function(){var t=C.height();$("#"+e+"form_label_"+s).height()<t&&$("#"+e+"form_label_"+s).height(t)}),1e3))}}else if("checkbox"==settings[t].field_type){r.append("<label id='"+e+"form_input_"+s+"_ada_label' for='"+e+"form_input_"+s+"' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[t].checkbox.text+"</label>"),settings[t].hasOwnProperty("hide_label")&&"show"===settings[t].hide_label&&(y=-1*settings[e+"inputs"].spacing+5,"left"!==settings[e+"labels"].position?r.append("<div id='"+e+"form_label_"+s+"' class='"+e+"form_labels "+e+"form_spacing' style='margin-bottom: "+y+"px;'>"+settings[t].label+"<span id='"+e+"form_label_"+s+"_required' class='"+e+"form_labels_required'></span></div>"):r.append("<div id='"+e+"form_label_"+s+"' class='"+e+"form_labels "+e+"form_spacing'>"+settings[t].label+"<span id='"+e+"form_label_"+s+"_required' class='"+e+"form_labels_required'></span></div>")),r.append("<div id='"+e+"form_input_"+s+"_checkbox_wrapper'><input type='checkbox' id='"+e+"form_input_"+s+"' /><p id='"+e+"form_input_"+s+"_checkbox_text'>"+settings[t].checkbox.text+"</p> <div style='float: none; clear: both;'></div> <div id='"+e+"form_input_"+s+"_error_text' class='"+e+"form_inputs_error_text'></div> </div>"),settings[t].checkbox.font.size<=10?$("#"+e+"form_input_"+s+"_checkbox_text").css({"margin-top":"1px","margin-left":"18px"}):settings[t].checkbox.font.size<=12?$("#"+e+"form_input_"+s+"_checkbox_text").css({"margin-top":"0px","margin-left":"18px"}):settings[t].checkbox.font.size<=14?$("#"+e+"form_input_"+s+"_checkbox_text").css({"margin-top":"-1px","margin-left":"18px"}):(b=14-settings[t].checkbox.font.size+"px",$("#"+e+"form_input_"+s+"_checkbox_text").css({"margin-top":b,"margin-left":"18px"})),settings[t].checkbox.hasOwnProperty("default")&&"on"===settings[t].checkbox.default&&$("#"+e+"form_input_"+s).prop("checked",!0).attr("checked","checked");var k=parseInt(n),B=t.split("custom")[0]+"custom"+(k+1).toString();(k+1).toString();(k===customFieldsLimit||settings.hasOwnProperty(B)&&!settings[B].hasOwnProperty("field_type")||settings.hasOwnProperty(B)&&settings[B].hasOwnProperty("field_type")&&"checkbox"!==settings[B].field_type||settings.hasOwnProperty(B)&&settings[B].hasOwnProperty("field_type")&&"checkbox"===settings[B].field_type&&!(settings[t].checkbox.align.indexOf("float")>=0&&settings[B].checkbox.align.indexOf("float")>=0))&&r.append("<div style='float:none;clear:both;height:1px;width:"+settings[e+"form"].width+"px;' id='"+e+"form_input_"+s+"_checkbox_float_clear' class='checkbox_float_clear'></div>"),$("#"+e+"form_input_"+s).keypress((function(e){13==(e.keyCode?e.keyCode:e.which)&&$(this).trigger("click")})),$("#"+e+"form_input_"+s).change((function(){this.checked?$(this).attr("checked","checked"):$(this).removeAttr("checked")}))}else"hidden"==settings[t].field_type&&(r.append("<input type='hidden' id='"+e+"form_input_"+s+"' class='"+e+"form_inputs' />"),settings[t].default&&$("#"+e+"form_input_"+s).val(settings[t].default));else r.append("<div id='"+e+"form_label_"+s+"' class='"+e+"form_labels "+e+"form_spacing'>"+settings[t].label+"<span id='"+e+"form_label_"+s+"_required' class='"+e+"form_labels_required'></span></div>"),r.append("<div id='"+e+"form_input_"+s+"_wrapper' class='"+e+"form_inputs_wrapper'><input type='text' id='"+e+"form_input_"+s+"' class='"+e+"form_inputs' /><div id='"+e+"form_input_"+s+"_help' class='"+e+"form_inputs_help'></div><div id='"+e+"form_input_"+s+"_error_text' class='"+e+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[t].placeholder&&$("#"+e+"form_input_"+s).attr("placeholder",settings[t].placeholder),settings[t].default&&$("#"+e+"form_input_"+s).val(settings[t].default);settings[t].hasOwnProperty("field_type")&&"hidden"===settings[t].field_type||(settings[t].require&&settings[e+"labels"].required.text.length>0&&$("#"+e+"form_label_"+s+"_required").text(settings[e+"labels"].required.text),settings[t].hasOwnProperty("label_subtext")&&settings[t].label_subtext&&$("#"+e+"form_label_"+s).after("<div id='"+e+"form_label_subtext_"+s+"' class='"+e+"form_labels' style=''>"+settings[t].label_subtext+"</div>"),"left"==settings[e+"labels"].position?($("#"+e+"form_label_"+s).addClass(e+"form_labels_left"),$("#"+e+"form_input_"+s+"_wrapper").addClass(e+"form_spacing"),$("#"+e+"form_label_subtext_"+s).addClass(e+"form_labels_hide").addClass(e+"form_labels_subtext").hide()):"above"==settings[e+"labels"].position||settings[t].hasOwnProperty("hide_label")&&"show"===settings[t].hide_label?($("#"+e+"form_label_"+s).addClass(e+"form_labels_above"),$("#"+e+"form_label_subtext_"+s).addClass(e+"form_labels_above").addClass(e+"form_labels_subtext"),UTIL.isNullOrWhitespace(settings[t].label)&&$("#"+e+"form_label_"+s).css({height:"0px"}),UTIL.isNullOrWhitespace(settings[t].label_subtext)&&$("#"+e+"form_label_subtext_"+s).css({height:"0px"})):($("#"+e+"form_label_"+s).addClass(e+"form_labels_hide"),$("#"+e+"form_input_"+s+"_wrapper").addClass(e+"form_spacing"),$("#"+e+"form_label_subtext_"+s).addClass(e+"form_labels_hide").addClass(e+"form_labels_subtext")),settings[t].display_help?$("#"+e+"form_input_"+s+"_help").text(settings[t].help):$("#"+e+"form_input_"+s+"_help").hide(),IS_MOBILE||$("#"+e+"form_input_"+s).hover((function(){$(this).addClass(e+"form_inputs_hover")}),(function(){$(this).removeClass(e+"form_inputs_hover")})),$("#"+e+"form_input_"+s).focus((function(){$(this).addClass(e+"form_inputs_focus")})).blur((function(){$(this).removeClass(e+"form_inputs_focus")})),settings[t].hasOwnProperty("field_type")&&"textbox"!=settings[t].field_type&&"dropdown"!=settings[t].field_type||$("#"+e+"form_input_"+s).keypress((function(t){13==t.which&&(t.preventDefault(),processSubmit(e,!1,!1,!0))})))}else settings.hasOwnProperty(t)&&r.append("<input type='hidden' id='"+e+"form_input_"+s+"' class='"+e+"form_inputs' />");if($("#"+e+"form_input_"+s).length&&settings[t].hasOwnProperty("metadata_kvps"))for(w=0;w<settings[t].metadata_kvps.length;w++)settings[t].metadata_kvps[w].k&&settings[t].metadata_kvps[w].v&&UTIL.trySetAttribute(e+"form_input_"+s,settings[t].metadata_kvps[w],$)}function initDatepicker(e,t,r){var s,n,i,o,a;try{if(IsDatepickerScriptLoaded){var l=settings[t].datepicker,_="",g="MM/DD/YYYY";!UTIL.isNullOrWhitespace(l.format)&&(l.format.indexOf("/")>0||l.format.indexOf("-")>0||l.format.indexOf(".")>0||l.format.indexOf(",")>0||l.format.indexOf(" ")>0)&&(g=l.format.trim().toUpperCase()),g.indexOf("/")>0?_="/":g.indexOf("-")>0?_="-":g.indexOf(".")>0?_=".":g.indexOf(",")>0?_=",":g.indexOf("_")>0?_="_":g.indexOf("|")>0?_="|":g.indexOf(" ")>0&&(_=" "),o=new Pikaday({field:document.getElementById(e+"form_input_"+r),yearRange:[1900,2050],toString:function(e){var t,r;try{var s=e.getDate(),n=e.getMonth()+1,i=e.getFullYear(),o="",a=g.split(_);for(t=0;t<a.length;t++)a[t].indexOf("D")>=0?o+=s+_:a[t].indexOf("M")>=0?o+=n+_:a[t].indexOf("Y")>=0&&(o+=i+_);return o&&(o=o.substr(0,o.length-1)),o}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"initDatepicker_1"),(r=new Date).getMonth()+1+_+r.getDate()+_+r.getFullYear()}},parse:function(e){var t,r,s;try{if(t=e.split(_),r=g.split(_),t.length!==r.length||0===t.length)return new Date;var n=-1,i=-1,o=-1;for(s=0;s<r.length;s++)r[s].indexOf("D")>=0?n=parseInt(t[s],10):r[s].indexOf("M")>=0?i=parseInt(t[s]-1,10):r[s].indexOf("Y")>=0&&(o=parseInt(t[s],10));return-1===n||-1===i||-1===o?new Date:new Date(o,i,n)}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"initDatepicker_2"),new Date}},onSelect:function(){DAPI.log(this.toString(g))}}),UTIL.isNullOrWhitespace(settings[t].default)||(a=settings[t].default.trim())&&(a.indexOf("/")>0||a.indexOf("-")>0||a.indexOf(".")>0||a.indexOf(",")>0||a.indexOf(" ")>0)&&o.setDate(a,!0),boxapi.hasOwnProperty("pikaday")||(boxapi.pikaday={}),boxapi.pikaday.hasOwnProperty(e+r)||(boxapi.pikaday[e+r]=o)}else{if(!IsDatepickerScriptLoading){IsDatepickerScriptLoading=!0,s="",settings[t].datepicker.theme&&"dark"===settings[t].datepicker.theme&&(s=BOX_BASE_URL+"/static/pikaday_dark.css");var p=document.head||document.getElementsByTagName("head")[0],u=(document.getElementsByTagName("body")[0],document.createElement("link"));u.type="text/css",u.rel="stylesheet",u.media="screen",u.href=BOX_BASE_URL+"/static/pikaday.css",p.appendChild(u),s&&((n=document.createElement("link")).type="text/css",n.rel="stylesheet",n.media="screen",n.href=s,p.appendChild(n)),(i=document.createElement("script")).type="text/javascript",i.src=BOX_BASE_URL+"/static/pikaday.js",p.appendChild(i)}"undefined"!=typeof Pikaday?(IsDatepickerScriptLoaded=!0,initDatepicker(e,t,r)):setTimeout((function(){initDatepicker(e,t,r)}),50)}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"initDatepicker_3")}}function getCustomJsGuidsToRun(e,t){for(var r,s,n,i,o,a=[],l=0;l<CUSTOM_JS_GUIDS_ARR.length;l++)if(CUSTOM_JS_BOX_EMBED.hasOwnProperty(CUSTOM_JS_GUIDS_ARR[l])&&CUSTOM_JS_BOX_EMBED[CUSTOM_JS_GUIDS_ARR[l]].trigger===e){var _=!1,g=!1,p=CUSTOM_JS_BOX_EMBED[CUSTOM_JS_GUIDS_ARR[l]];if("string"==typeof p.include_filter&&p.include_filter.trim().length>0)if((r=p.include_filter.split(",")).length>0)for(_=!0,g=!0,n=0;n<r.length;n++)(IS_VARIATION&&VARIATION_GUID.trim().toLowerCase()===r[n].trim().toLowerCase()&&-1===$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)||IS_VARIATION&&VARIATION_SHORT_ID.trim().toLowerCase()===r[n].trim().toLowerCase()&&-1===$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)||LIGHTBOX_GUID.trim().toLowerCase()===r[n].trim().toLowerCase()&&-1===$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)||LIGHTBOX_SHORT_ID.trim().toLowerCase()===r[n].trim().toLowerCase()&&-1===$.inArray(CUSTOM_JS_GUIDS_ARR[l],a))&&a.push(CUSTOM_JS_GUIDS_ARR[l]);else-1===$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)&&a.push(CUSTOM_JS_GUIDS_ARR[l]);else-1===$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)&&a.push(CUSTOM_JS_GUIDS_ARR[l]);if(!_&&"string"==typeof p.exclude_filter&&p.exclude_filter.trim().length>0&&(s=p.exclude_filter.split(",")).length>0)for(n=0;n<s.length;n++){if(IS_VARIATION&&VARIATION_GUID.trim().toLowerCase()===s[n].trim().toLowerCase()){-1!==$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)&&(o=$.inArray(CUSTOM_JS_GUIDS_ARR[l],a),a.splice(o,1)),g=!0;break}if(IS_VARIATION&&VARIATION_SHORT_ID.trim().toLowerCase()===s[n].trim().toLowerCase()){-1!==$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)&&(o=$.inArray(CUSTOM_JS_GUIDS_ARR[l],a),a.splice(o,1)),g=!0;break}if(LIGHTBOX_GUID.trim().toLowerCase()===s[n].trim().toLowerCase()){-1!==$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)&&(o=$.inArray(CUSTOM_JS_GUIDS_ARR[l],a),a.splice(o,1)),g=!0;break}if(LIGHTBOX_SHORT_ID.trim().toLowerCase()===s[n].trim().toLowerCase()){-1!==$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)&&(o=$.inArray(CUSTOM_JS_GUIDS_ARR[l],a),a.splice(o,1)),g=!0;break}}g||"function"!=typeof p.include_exclude_function?g||"function"==typeof p.include_exclude_function||-1===$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)&&a.push(CUSTOM_JS_GUIDS_ARR[l]):"boolean"==typeof(i=p.include_exclude_function(DAPI,STANDARD_OBJ,t))&&!0===i?-1===$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)&&a.push(CUSTOM_JS_GUIDS_ARR[l]):-1!==$.inArray(CUSTOM_JS_GUIDS_ARR[l],a)&&(o=$.inArray(CUSTOM_JS_GUIDS_ARR[l],a),a.splice(o,1))}return a.length,a}function calculateCustomJsResponses(e,t,r){return null==e?"temp"===t&&(t=!0):"boolean"==typeof e?!1!==e||"runCustomJsBeforeFormValidation"!=r&&"runCustomJsAfterFormValidation"!=r&&"runCustomJsBeforeSubmit"!=r&&"runCustomJsAfterSubmit"!=r?"temp"===t?t=e:("boolean"==typeof t||"number"==typeof t)&&(t=t&&e):t="short_circuit_break":"number"==typeof e?"temp"===t?t=e:"number"==typeof t&&(t+=e):"string"==typeof e?"temp"===t||"string"!=typeof t?t=e:t+=e:"object"==typeof e&&("temp"===t?t=e:"object"==typeof t&&(t=UTIL.mergeObjectData(t,e))),t}function runCustomJsSnippetsSync(e,t,r,s,n){var i,o,a="temp";try{if(null!=CJSAPPS_BOXES&&null!=CJSAPPS_ARR&&CJSAPPS_ARR.length>0)for(o=0;o<CJSAPPS_ARR.length;o++)if(i=CJSAPPS_ARR[o],CJSAPPS_BOXES.hasOwnProperty(i)&&CJSAPPS_BOXES[i].hasOwnProperty(t)&&"function"==typeof CJSAPPS_BOXES[i][t])if(logger("RUNNER: runCustomJsSnippetsSync(LINKED APP #"+i+" - "+t+", "+n+", BOX_ID="+boxapi.getId()+")"),"void"===n||""===n)CJSAPPS_BOXES[i][t](DAPI,STANDARD_OBJ,s);else if("string"==typeof(a=calculateCustomJsResponses(CJSAPPS_BOXES[i][t](DAPI,STANDARD_OBJ,s),a,e))&&"short_circuit_break"===a)return!1;if(r.length>0)for(o=0;o<r.length;o++)if("function"==typeof CUSTOM_JS_BOX_EMBED[r[o]].code)if(logger("RUNNER: runCustomJsSnippetsSync("+e+", "+n+")"),"void"===n||""===n)CUSTOM_JS_BOX_EMBED[r[o]].code(DAPI,STANDARD_OBJ,s);else if("string"==typeof(a=calculateCustomJsResponses(CUSTOM_JS_BOX_EMBED[r[o]].code(DAPI,STANDARD_OBJ,s),a,e))&&"short_circuit_break"===a)return!1;return"temp"===a||"void"===n||""===n||-1===n.indexOf(typeof a)?void 0:a}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsSnippetsSync"),"temp"===a||"void"===n||""===n||-1===n.indexOf(typeof a)?void 0:a}}function loadScript(e,t){var r=document.head,s=document.createElement("script");s.type="text/javascript",s.src=e,s.onreadystatechange=t,s.onload=t,r.appendChild(s)}async function loadUserScript(e,t){IS_QA?e=e.replace(/\.[^/.]+$/,"_qa.js"):IS_PREVIEW&&(e=e.replace(/\.[^/.]+$/,"_preview.js"));var r=DAPI.CONFIG.BOX_BASE_URL+"/vendor/"+VENDOR_GUID+"/"+e;return void 0!==t&&(r+="?cb="+t),new Promise((e=>{loadScript(r,(function(){e(r+" loaded")}))}))}var DIGIOH_CACHE_VERSION,bodInsert,ie9,html_ele,PageViewSequence;const DAPI=parent.DIGIOH_API,UTIL=parent.DIGIOH_API.UTIL,DUTIL=parent.DIGIOH_API.DUTIL,DLOG=parent.DIGIOH_API.DLOG,LBOX=parent.DIGIOH_API.LIGHTBOX;DIGIOH_CACHE_VERSION=CACHE_VERSION||"",PROTOCOL_USER_OVERRIDE=PROTOCOL_USER_OVERRIDE||"https://";const BOX_BASE_URL=DAPI.CONFIG.BOX_BASE_URL,SUBMIT_BASE_URL=DAPI.CONFIG.SUBMIT_BASE_URL,SUBMITCUS_BASE_URL=DAPI.CONFIG.SUBMITCUS_BASE_URL,API_BASE_URL=DAPI.CONFIG.API_BASE_URL,JSAPI_BASE_URL=DAPI.CONFIG.JSAPI_BASE_URL,COUPON_BASE_URL=DAPI.CONFIG.COUPON_BASE_URL,S3_BASE_URL=DAPI.CONFIG.S3_BASE_URL,customFieldsLimit=DAPI.CONFIG.CUSTOM_FIELDS_LIMIT;bodInsert="<div id='layout'></div>",bodInsert+="<div id='modal_loading'><div id='modal_loading_spinner'></div></div>",bodInsert+="<div class='bubble-container' id='bubble_container'>",bodInsert+="<span style='display: none;' class='error-bubble' id='error_bubble'>",bodInsert+="<span class='error-message' id='error_message'></span>",bodInsert+="<span id='error_close'>x</span>",bodInsert+="</span>",bodInsert+="<span style='display: none;' class='success-bubble' id='success_bubble'>",bodInsert+="<span class='success-message' id='success_message'></span>",bodInsert+="<span id='success_close'>x</span>",bodInsert+="</span>",bodInsert+="<span style='display: none;' class='warning-bubble' id='warning_bubble'>",bodInsert+="<span class='warning-message' id='warning_message'></span>",bodInsert+="<span id='warning_close'>x</span>",bodInsert+="</span>",bodInsert+="</div>",ie9="\x3c!--[if lte IE 9]>",ie9+="<scr",ie9+="ipt type='text/javascript'>",ie9+="IS_IE_9_OR_LESS = true;",ie9+="<",ie9+="/script>",ie9+="<![endif]--\x3e";var loaderBg="#modal_loading{display:none;position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:rgba(255,255,255,.8)}",loaderCss="#modal_loading_spinner{position:fixed;z-index:90001;color:#0078d7;font-size:15px;margin:0;width:1em;height:1em;border-radius:50%;text-indent:-9999em;-webkit-animation:load4 1.3s infinite linear;animation:load4 1.3s infinite linear;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0)}@-webkit-keyframes load4{0%,100%{box-shadow:0 -3em 0 .2em,2em -2em 0 0,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 0}12.5%{box-shadow:0 -3em 0 0,2em -2em 0 .2em,3em 0 0 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em 0 0,3em 0 0 .2em,2em 2em 0 0,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 0,2em 2em 0 .2em,0 3em 0 0,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 0,0 3em 0 .2em,-2em 2em 0 0,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 0,-2em 2em 0 .2em,-3em 0 0 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 .2em,-2em -2em 0 0}87.5%{box-shadow:0 -3em 0 0,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 0,-2em -2em 0 .2em}}@keyframes load4{0%,100%{box-shadow:0 -3em 0 .2em,2em -2em 0 0,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 0}12.5%{box-shadow:0 -3em 0 0,2em -2em 0 .2em,3em 0 0 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em 0 0,3em 0 0 .2em,2em 2em 0 0,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 0,2em 2em 0 .2em,0 3em 0 0,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 0,0 3em 0 .2em,-2em 2em 0 0,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 0,-2em 2em 0 .2em,-3em 0 0 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 .2em,-2em -2em 0 0}87.5%{box-shadow:0 -3em 0 0,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 0,-2em -2em 0 .2em}}",loaderImg="#modal_loading{display:none;position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url("+BOX_BASE_URL+"/static/loading_animation.gif) 50% 50% no-repeat rgba(255,255,255,.8)}",pgStyle="<style type='text/css'>.hidden_until_loaded, .hidden_until_loaded body, .hidden_until_loaded div {visibility: hidden !important;} body{margin:0;padding:0;border:none;}#bubble_container{position: fixed;top: 30px;left: 30px;z-index: 100001 !important}.error-bubble, .success-bubble, .warning-bubble{-webkit-border-radius: 3px;-moz-border-radius: 3px;-ms-border-radius: 3px;-o-border-radius: 3px;border-radius: 3px;padding: 12px 15px;margin: 0;text-align: left;color: red;background-color: #fff4f4;border: 1px solid #d58a8a;font-size: 13px;line-height: 18px;font-family: 'Open Sans', 'lucida grande', 'Segoe UI', arial, verdana, 'lucida sans unicode', tahoma, sans-serif;white-space: nowrap;font-weight: 400;display: block;margin-bottom:5px}.error-bubble .error-message{color: #d58a8a;font-size: inherit;line-height: inherit}.error-message {color: #dd3b38;font-size: 10px}.success-bubble {color: #000;background-color: #ddffdd;border: 1px solid #2dbe60 }.success-bubble .success-message, .warning-bubble .warning-message {color: #000;font-size: inherit;line-height: inherit}.success-message, .warning-message {color: #000;font-size: 10px;} .warning-bubble {color: #000;background-color: #ffeb3b;border: 1px solid #ff9800}#error_close, #success_close, #warning_close{color: #dd3b38;font-size: 18px;font-weight: 700;display: inline-block;float: right;cursor: pointer;margin-top: -2px}#success_close {color: #2dbe60}#warning_close {color: #ff9800}.error-bubble .error-bubble-arrow-border{display: block;border-color: #d58a8a transparent transparent;border-style: solid;border-width: 6px;height: 0;width: 0;position: absolute;bottom: -13px;left: 10px}"+loaderCss+loaderBg+"body.loading{overflow:hidden}body.loading #modal_loading{display:block}</style>";pgStyle+="<style id='element_styles' type='text/css'></style>",html_ele=document.getElementsByTagName("html")[0],"object"==typeof html_ele.classList&&null!==html_ele.classList&&html_ele.classList.add("hidden_until_loaded");var basic_fonts=["Arial, Helvetica, sans-serif","'Comic Sans MS', cursive, sans-serif","'lucida sans unicode', 'Lucida Grande', sans-serif","Tahoma, Geneva, sans-serif","Verdana, Geneva, sans-serif","'Courier New', Courier, monospace","'Lucida Console', Monaco, monospace","'Trebuchet MS', Helvetica, sans-serif","Impact, Charcoal, sans-serif"],google_fonts=[],custom_fonts=[];let postSubmissionResolution=[],submissionPromises=[];var TIME_OF_OPEN=(new Date).getTime(),KEEN_CLIENT,EVENT_GUID="",IS_SETTINGS_LOADED=!1,IS_SCRIPTS_LOADED=!1,BOX_CUSTOM_JS={},LIGHTBOX_OR_VARIATION_GUID="",STANDARD_OBJ={},CUSTOM_JS_GUIDS_ARR=[],CUSTOM_JS_BOX_EMBED={},CJSAPPS_ARR=[],CJSAPPS_BOXES={},COUPONS_FOR_SUBMIT={},COUPONS_FOR_DISPLAY={},CURRENT_PAGE="main",CURRENT_WIDTH=0,CURRENT_HEIGHT=0,PageAnswers=[];PageViewSequence=[""];var SELECTED_BUTTON_FORM_VALUES={},wasErrorBubbleAlreadyClosed=!1,BugsnagInitAttempts=0,processSubmitLock=!1,hasAfterDomReadyJsFinished=!1,settings,body,modal_loading,error_bubble,error_message,success_bubble,success_message,warning_bubble,warning_message,image_dims={},form_wrapper,form,thx_form_wrapper,thx_form,ep1_form_wrapper,ep1_form,ep2_form_wrapper,ep2_form,ep3_form_wrapper,ep3_form,ep4_form_wrapper,ep4_form,form_input_obj={},pref_form_input_full_name=!1,pref_form_input_first_name=!1,pref_form_input_last_name=!1,pref_form_input_email=!1,pref_form_input_phone=!1,pref_form_input_opt_in=!1,pref_form_input_customN=!1,form_input_full_name,form_input_first_name,form_input_last_name,form_input_email,form_input_phone,form_input_opt_in,thx_form_input_full_name,thx_form_input_first_name,thx_form_input_last_name,thx_form_input_email,thx_form_input_phone,thx_form_input_opt_in,ep1_form_input_full_name,ep1_form_input_first_name,ep1_form_input_last_name,ep1_form_input_email,ep1_form_input_phone,ep1_form_input_opt_in,ep2_form_input_full_name,ep2_form_input_first_name,ep2_form_input_last_name,ep2_form_input_email,ep2_form_input_phone,ep2_form_input_opt_in,ep3_form_input_full_name,ep3_form_input_first_name,ep3_form_input_last_name,ep3_form_input_email,ep3_form_input_phone,ep3_form_input_opt_in,ep4_form_input_full_name,ep4_form_input_first_name,ep4_form_input_last_name,ep4_form_input_email,ep4_form_input_phone,ep4_form_input_opt_in,using_form=!1,using_form_thx=!1,using_form_ep1=!1,using_form_ep2=!1,using_form_ep3=!1,using_form_ep4=!1,IsDatepickerScriptLoaded=!1,IsDatepickerScriptLoading=!1,AfterDomLoadedHasRun=!1,BuiltExtraPageStyles={},LoadedCustomFonts={},LoadedPageImages={},ImageSrcMap={},boxapi={},jQuery={},$={};function createDigiohPrqModule(n){function si(){nt&&(at||(at=!0,(k=!!ft("effects.quiz.enabled"))&&(r=ft("effects.quiz.settings")),ui("main"),t("DIGIOH_PRQ ==> init() ==> IsBoxPRQ = "+k+", LIGHTBOX_SHORT_ID = "+LIGHTBOX_SHORT_ID)))}function ct(){return"outcomes"===r.LogicMode}function hi(){try{var n=r.ProductsArrayURLOptimized;i.isPreview()?n=n.replace(".json","_preview.json"):i.isQaMode()&&(n=n.replace(".json","_qa.json")),vt=n,t("getProductFileURL: "+n)}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"getArrayFilePRQURL")}return vt}function ci(e){var s=hi(),n="true"===i.getWidgetMetadata("use_direct_product_csv_url");n&&(s=r.ProductCSVURL),$.ajax({url:s+"?cb="+CACHE_VERSION,success:function(t){n?li(t,e):ai(t,e)},error:function(r){t("parseArrayFilePRQ:failure: "+s+"?cb="+CACHE_VERSION),t("Array File Fetch Ajax Error: "+r.status+" "+r.statusText),e(!1)}})}function li(e,t){var r=a.csv.toArrays(e);pt(r,r[0],t)}function ai(e,t){var r=e,s=r[0];console.log("parseArrayFilePRQ"),pt(r,s,t)}function pt(e,r,s){for(var n,i,o,a,l,_,m,d,c=0;c<r.length;c++){for((void 0===r[c]||null==r[c])&&(r[c]=""),l=0;l<e.length;l++)e[l].length>c&&(void 0===e[l][c]||null==e[l][c])&&(e[l][c]="");"prq:id"==r[c].toLowerCase().trim()?p=c:"prq:available"==r[c].toLowerCase().trim()?PRQColAvailable=c:"prq:type"==r[c].toLowerCase().trim()&&(PRQColType=c)}var f=[],O={},y={};if(!ct()){for((n=ft("effects.quiz.weights"))&&""!=n||(n=[]),c=0;c<n.length;c++)n[c].hasOwnProperty("keyword_weights")&&(f=f.concat(n[c].keyword_weights));for(c=0;c<f.length;c++)if(i=f[c].column,o=f[c].text,i&&0!=i.trim().length&&!y.hasOwnProperty(i+"____"+o))if(y[i+"____"+o]=!0,"any"==i.toLowerCase())O.hasOwnProperty("any")||(O.any=[]),O.any.push(c);else for(l=0;l<r.length;l++)if(i==r[l]){O.hasOwnProperty(i)||(O[i]=[]),O[i].push(c);break}}for(a=0;a<e.length;a++)if(e[a][p].toString().indexOf("PRQ:")<0)for(u[e[a][p]]={id:e[a][p]},c=0;c<r.length;c++)if(e[a].length>c){if(u[e[a][p]][r[c].toString().toLowerCase().replace("prq:","")]=e[a][c],O.hasOwnProperty(r[c]))for(l=0;l<O[r[c]].length;l++){var w=f[O[r[c]][l]].column,P=f[O[r[c]][l]].text,x="contains";f[O[r[c]][l]].hasOwnProperty("operator")&&(x=f[O[r[c]][l]].operator),w&&P&&x&&(_=w+"____"+x+"____"+P,m=!1,("contains"==x&&e[a][c].toString().toLowerCase().indexOf(P.toString().toLowerCase().trim())>=0||"equals"==x&&e[a][c].toString().toLowerCase().trim()===P.toString().toLowerCase().trim()||"whole_word"==x&&new RegExp("\\b"+P.toString().toLowerCase()+"\\b").test(e[a][c].toString().toLowerCase())||"regex"==x&&new RegExp(P,"i").test(e[a][c].toString()))&&(m=!0),m&&(h.hasOwnProperty(_)||(h[_]=[]),h[_].push(e[a][p])))}if(O.hasOwnProperty("any")&&"PRQ:ID"!=r[c]&&"PRQ:Available"!=r[c]&&"PRQ:ProductId"!=r[c]&&"PRQ:URL"!=r[c]&&"PRQ:Image"!=r[c]&&"PRQ:CollectionIds"!=r[c])for(l=0;l<O.any.length;l++){w=f[O.any[l]].column,P=f[O.any[l]].text,x="contains";f[O.any[l]].hasOwnProperty("operator")&&(x=f[O.any[l]].operator),w&&P&&x&&(_=w+"____"+x+"____"+P,m=!1,("contains"==x&&e[a][c].toString().toLowerCase().indexOf(P.toString().toLowerCase().trim())>=0||"equals"==x&&e[a][c].toString().toLowerCase().trim()===P.toString().toLowerCase().trim()||"whole_word"==x&&new RegExp("\\b"+P.toString().toLowerCase()+"\\b").test(e[a][c].toString().toLowerCase())||"regex"==x&&new RegExp(P,"i").test(e[a][c].toString()))&&(m=!0),m&&(h.hasOwnProperty(_)||(h[_]=[]),h[_].push(e[a][p])))}}else u[e[a][p]][r[c].toString().toLowerCase().replace("prq:","")]="";for(d in h)h.hasOwnProperty(d)&&(h[d]=[...new Set(h[d])]);g=r,b=e,t("processFileData:complete"),t("PRQHeaders"),t(g),t("PRQObjects"),t(u),t("PRQKeywordsMap"),t(h),s(!0)}function vi(t,r,n,i){var o,a={};a.rule_prop=t,a.rule_operator=r,a.rule_val=i,a.rule_set=n,a.rule_message="",a.rule_result=!1;try{var l=0,_=0,g=[];const e=ht();for(o=!1,l=0;l<e.length;l++)if(v.getPlainPref(e[l].page)==v.getPlainPref(t)){for(_=0;_<e[l].entries.length;_++)"string"==typeof e[l].entries[_].value&&("button"!=e[l].entries[_].type||f.stringOrArrayContains(g,"b"+e[l].entries[_].num)?"custom"!=e[l].entries[_].type||f.stringOrArrayContains(g,e[l].entries[_].value.toString().toLowerCase().trim())||g.push(e[l].entries[_].value.toString().toLowerCase().trim()):g.push("b"+e[l].entries[_].num));o=!0;break}if(!o)return a.rule_message="(page="+(t||"main")+") ==> No answers found in PageAnswers for page, so setting page rule eval to false.",a.rule_result=!1,a;if(a.rule_message="(page="+(t||"main")+") ==> found in PageAnswers for page ==> "+JSON.stringify(g),"contains"==r)return 0!=i.length&&f.stringOrArrayContains(g,i.toString().toLowerCase().trim())?(a.rule_result=!0,a):(a.rule_result=!1,a);if("does_not_contain"==r)return 0==i.length||f.stringOrArrayContains(g,i.toString().toLowerCase().trim())?(a.rule_result=!1,a):(a.rule_result=!0,a);if("in_set_contains"==r){for(l=0;l<n.length;l++)if(n[l].toString().trim().length>0&&f.stringOrArrayContains(g,n[l].toString().toLowerCase().trim()))return a.rule_result=!0,a;return a.rule_result=!1,a}if("not_in_set_contains"==r){for(l=0;l<n.length;l++)if(n[l].toString().trim().length>0&&f.stringOrArrayContains(g,n[l].toString().toLowerCase().trim()))return a.rule_result=!1,a;return a.rule_result=!0,a}if("exact_in_set_contains"==r){if(0==n.length)return a.rule_result=!1,a;for(l=0;l<n.length;l++)if(0==n[l].toString().trim().length||!f.stringOrArrayContains(g,n[l].toString().toLowerCase().trim()))return a.rule_result=!1,a;return a.rule_result=!0,a}}catch(t){a.rule_error=!0,a.rule_error_message=t.message,e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"evalOutcomeRule")}return a}function yi(t){var r,s,n=t.conditions,i=[],o=[],a={};try{for(r=0;r<n.length;r++){for(i[r]=!0,o[r]=[],s=0;s<n[r].length;s++)if(a=vi(n[r][s].p,n[r][s].o,n[r][s].s,n[r][s].v),o[r].push(a),!a.rule_result){i[r]=!1;break}if(!0===i[r])return l+="---------------------------------\n",l+="Box #"+LIGHTBOX_SHORT_ID+", Quiz Outcome #"+t.id+" "+t.name+" -- RULES_SUCCEEDED\n",l+=JSON.stringify(o,null,2)+"\n",l+="---------------------------------\n",!0}}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: user.js -- "+t.message,console.error(t)),logError(t,"evalOutcomeConditions")}return l+="---------------------------------\n",l+="Box #"+LIGHTBOX_SHORT_ID+", Quiz Outcome #"+t.id+" "+t.name+" -- RULES_FAILED\n",l+=JSON.stringify(o,null,2)+"\n",l+="---------------------------------\n",!1}function wt(){var t,r;try{if(l="---------------------------------\n",l+="calcOutcomesPRQ\n",l+="---------------------------------\n",(t=ft("effects.quiz.outcomes")).length>0)for(r=0;r<t.length;r++)if(yi(t[r]))return bt(),t[r]}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"calcOutcomesPRQ")}return bt(),null}function bt(){try{console.log(l)}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"calcOutcomesPRQ")}}function pi(n){var l,_,p,m,d,c,O,P,x,S,I,R,T,v,A,D,E,C,L,$,k,B,M,U,G,N,H,F;try{if(!nt)return;const e=ht();var J={},j=0,X=0,Q=0,q="",V=!ct(),z="|true|1|yes|on|".indexOf("|"+(i.getWidgetMetadata("display_negative_weight_results")||"false").toLowerCase()+"|")>=0;t("PRQHeaders"),t(g),t("PRQRows"),t(b);var W=i.isPreview()||i.isQaMode()||"true"==f.getUrlParam("quiz_test_mode"),Y=r.ResultsPageUrlFull||i.getWidgetMetadata("results_redirect_url_shopify")||"",K=!0;for((Y&&Y.indexOf("hide_oos=false")>0||r.hasOwnProperty("HideOutOfStock")&&!1===r.HideOutOfStock)&&(K=!1),W&&V&&!o.hasOwnProperty("rerunExpandedCalcResultsPRQ")&&(o.rerunExpandedCalcResultsPRQ=function(){DIGIOH_PRQ.calcResultsPRQ(!0)}),t("calcResultsPRQ: ---------------------------------------------------------"),t("calcResultsPRQ: START"),t("calcResultsPRQ: ---------------------------------------------------------"),"",l=[],_=0;_<e.length;_++){var Z=e[_].page,ee={page:(Z||"main").toUpperCase(),page_answers:[],cumulative_weights:[]};for(settings.hasOwnProperty(Z+"layout")&&settings[Z+"layout"].hasOwnProperty("page_name")&&settings[Z+"layout"].page_name?(ee.page=settings[Z+"layout"].page_name+" ("+ee.page.toUpperCase()+")",settings[Z+"layout"].page_name.replace(/[^a-zA-Z0-9 ]/g,"").trim().split(" ").join("_").toLowerCase(),e[_].page_name=settings[Z+"layout"].page_name):("question_page_"+ee.page.toLowerCase(),e[_].page_name=""),j=0;j<e[_].entries.length;j++){var te=e[_].entries[j].type,re=e[_].entries[j].value,se=e[_].entries[j].num;if(V){if(p="","button"==te?p=Z+te+se:"custom"==te&&(p=(""==Z?"":Z+"_")+te+se),"custom"==te&&settings[p].hasOwnProperty("prq_weights")&&settings[p].prq_weights.length>0)for(m=0;m<settings[p].prq_weights.length;m++)if(di(settings[p].prq_weights[m].operator,settings[p].prq_weights[m].value,re)){if(settings[p].prq_weights[m].kvps)for(X=0;X<settings[p].prq_weights[m].kvps.length;X++){ot(J,ee,p,re,le=(ae=settings[p].prq_weights[m].kvps[X]).p,ae.w,"","custom","single",K,Y)}if(settings[p].prq_weights[m].keywords)for(X=0;X<settings[p].prq_weights[m].keywords.length;X++){var ne=(_e=settings[p].prq_weights[m].keywords[X]).column,ie=_e.text,oe="contains";if(_e.hasOwnProperty("operator")&&(oe=_e.operator),d=ne+"____"+oe+"____"+ie,_e.column&&_e.text&&_e.weight&&h.hasOwnProperty(d))for(Q=0;Q<h[d].length;Q++)ot(J,ee,p,re,le=h[d][Q],_e.weight,_e.text,"custom","keyword",K,Y)}}if("button"==te&&settings.hasOwnProperty(p)&&settings[p].hasOwnProperty("prq_kvps"))for(X=0;X<settings[p].prq_kvps.length;X++){var ae,le;ot(J,ee,p,re,le=(ae=settings[p].prq_kvps[X]).p,ae.w,"","button","single",K,Y)}if("button"==te&&settings.hasOwnProperty(p)&&settings[p].hasOwnProperty("prq_keywords"))for(X=0;X<settings[p].prq_keywords.length;X++){var _e;ne=(_e=settings[p].prq_keywords[X]).column,ie=_e.text,oe="contains";if(_e.hasOwnProperty("operator")&&(oe=_e.operator),d=ne+"____"+oe+"____"+ie,_e.column&&_e.text&&_e.weight&&h.hasOwnProperty(d))for(Q=0;Q<h[d].length;Q++)ot(J,ee,p,re,le=h[d][Q],_e.weight,_e.text,"button","keyword",K,Y)}}}if(W){for(P in J)J.hasOwnProperty(P)&&u.hasOwnProperty(P)&&(c=(c=tt(P,"PRQ:Name"))?"Product #"+P+" ("+c+")":"Product #"+P,ee.cumulative_weights.push({id:P,weight:J[P],title:c}));l.push(ee)}}if(W&&t("calcResultsPRQ: cumulativeProductWeightsByPage ==>"+JSON.stringify(l,void 0,2)),O=[],V)for(P in J)J.hasOwnProperty(P)&&u.hasOwnProperty(P)&&(z||J[P]>=0)&&(I={weight:J[P],id:P},O.push(I));else{if(y=wt(),t("calcResultsPRQ: outcome ==> "),t(y),y){if(y.products)for(x=0;x<y.products.length;x++)le=y.products[x],u.hasOwnProperty(le)&&(S=tt(le,"PRQ:Available"),K&&"false"==S.toString().toLowerCase().trim()?t("suppressOutOfStock_productOutcomes: "+le.toString()):(I={weight:1,id:le},O.push(I)));y.results&&y.results.action&&(q=y.results)}t("calcResultsPRQ: calcOutcomesPRQ: WeightedResults ==> "),t(O)}for(O=kt(O),50,O.length>50&&(O.length=50),m=0;m<O.length;m++)for(R in _e=O[m],u[_e.id])u[_e.id].hasOwnProperty(R)&&"id"!=R.toLowerCase()&&"weight"!=R.toLowerCase()&&(_e[R]=u[_e.id][R]);if(T="",v="",O.length>1)for(A in O[0])O[0].hasOwnProperty(A)&&("variant"==A||"variation"==A?v=A:("product_id"==A||"productid"==A)&&(T=A));if(T&&v){for(D="",E=[],Q=0;Q<O.length;Q++)O[Q].hasOwnProperty(T)&&D.indexOf("|"+O[Q][T]+"|")<0&&(E.push(O[Q]),D+="|"+O[Q][T]+"|");E.length>0&&(O=JSON.parse(JSON.stringify(E)))}if(t("calcResultsPRQ: WeightedResults ==> "),t(O),w={answers:e,results:O},t("calcResultsPRQ: DATA ==> "+JSON.stringify(w)),t("calcResultsPRQ: ---------------------------------------------------------"),t("calcResultsPRQ: END"),t("calcResultsPRQ: ---------------------------------------------------------"),W&&V){for(a("#quiz_test_results").length||(a("body").append('<div id="quiz_test_results" style="display: none; position: fixed; left: 0; top: 0; width: 100%; height: 100%; overflow-x: hidden; z-index: 999999999; background-color: white;"><table id="quiz_test_results_table" style="width:100%;"></table></div>'),a("body").append("<button id=\"show_quiz_test_results_button\" style=\"position: fixed; right: 10px; top: 10px; z-index: 99999999;\" onclick=\"javascript:document.getElementById('quiz_test_results').style.display = 'block';\">Show Results Calculation <button id=\"dismiss_button\" style=\"position: fixed; right: 183px; top: 10px; z-index: 99999999;\" onclick=\"document.getElementById('show_quiz_test_results_button').style.display = 'none'; document.getElementById('dismiss_button').style.display = 'none';\">X</button> </div>"),a("#quiz_test_results").append('<button id="close_quiz_test_results_button" style="position: fixed; bottom: 10px; left: 10px;" onclick="javascript:document.getElementById(\'quiz_test_results\').style.display = \'none\';">Close Results</button>'),a("#quiz_test_results").append('<button id="save_quiz_test_results_button" style="position: fixed; bottom: 10px; left: 150px;" onclick="javascript:window.DIGIOH_API.downloadQuizResultsTable();">Download Results</button>'),a("#quiz_test_results").append('<button id="save_quiz_test_results_button" style="position: fixed; bottom: 10px; left: 320px;" onclick="javascript:window.DIGIOH_API.rerunExpandedCalcResultsPRQ();">Full Results</button>'),"#quiz_test_results table td, #quiz_test_results table th { vertical-align: top; padding: 15px; border: 1px solid black; }","#quiz_test_results #quiz_test_answers_table td, #quiz_test_results #quiz_test_answers_table th { vertical-align: top; padding: 5px; border: 1px solid black; }","#quiz_test_results #quiz_test_cumulative_table td, #quiz_test_results #quiz_test_cumulative_table th { vertical-align: top; padding: 5px; border: 1px solid black; }",a("head").append('<style id="quiz_test_styles" type="text/css">#quiz_test_results table td, #quiz_test_results table th { vertical-align: top; padding: 15px; border: 1px solid black; }#quiz_test_results #quiz_test_answers_table td, #quiz_test_results #quiz_test_answers_table th { vertical-align: top; padding: 5px; border: 1px solid black; }#quiz_test_results #quiz_test_cumulative_table td, #quiz_test_results #quiz_test_cumulative_table th { vertical-align: top; padding: 5px; border: 1px solid black; }</style>')),a("#quiz_test_results_table").empty(),a("#quiz_test_results_table").append("<tr><th>Step</th><th>Page</th><th>Answers</th><th>Cumulative Weights</th></tr>"),C="",j=0;j<l.length;j++){for(L='<table id="quiz_test_answers_table">',L+="<tr><th>Answer</th><th>Product</th><th>Weight</th><th>Matching</th></tr>",$="",k=0,X=0;X<l[j].page_answers.length&&(B=l[j].page_answers[X].split("==>")[0].replace("Answered ",""),M="Single Product",l[j].page_answers[X].indexOf("matched keyword:")>0&&(M="Keyword="+l[j].page_answers[X].split("matched keyword:")[1].split(")")[0].trim()),L+=X>0&&$==B?"<tr><td></td><td>#"+l[j].page_answers[X].split("==>")[1].split("weight added to ID #")[1].trim().split("(")[0].trim()+"</td><td>"+l[j].page_answers[X].split("==>")[1].split("weight added to ID")[0].trim()+"</td><td>"+M+"</td></tr>":"<tr><td>"+B+"</td><td>#"+l[j].page_answers[X].split("==>")[1].split("weight added to ID #")[1].trim().split("(")[0].trim()+"</td><td>"+l[j].page_answers[X].split("==>")[1].split("weight added to ID")[0].trim()+"</td><td>"+M+"</td></tr>",$=B,!(++k>=20));X++);if(L+="</table>",0==l[j].page_answers.length&&(L=""),U=kt(l[j].cumulative_weights),!n&&U.length>20&&(U.length=20),!z){for(G=[],N=0;N<U.length;N++)U[N].weight>=0&&G.push(U[N]);U=G}for(H='<table id="quiz_test_cumulative_table">',H+="<tr><th>Product</th><th>Weight</th></tr>",X=0;X<U.length;X++)F="",r.ResultsOrderFields&&r.ResultsOrderFields.indexOf("PRQ:Quantity")>=0&&U[X].id&&u.hasOwnProperty(U[X].id)&&u[U[X].id].hasOwnProperty("quantity")&&(F+=" (QTY="+u[U[X].id].quantity+")"),r.ResultsOrderFields&&r.ResultsOrderFields.indexOf("PRQ:Price")>=0&&U[X].id&&u.hasOwnProperty(U[X].id)&&u[U[X].id].hasOwnProperty("price")&&(F+=" (Price="+u[U[X].id].price+")"),H+="<tr><td>"+U[X].title.replace("Product ","")+F+"</td><td>"+U[X].weight+"</td></tr>";H+="</table>",0==U.length&&(H=""),C+="<tr><td>"+(j+1).toString()+"</td><td>"+l[j].page+"</td><td>"+L+"</td><td>"+H+"</td></tr>"}a("#quiz_test_results_table").append(C)}return q}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"calcResultsPRQ")}return""}function kt(e){let t=[];if(r.ResultsOrderFields)for(let e of r.ResultsOrderFields.split(","))t.push({field:e.replace(/(PRQ:|asc|desc)\b/gi,"").trim().toLowerCase(),dir:/\sdesc$/gi.test(e)?"DESC":"ASC"});return e.sort(((e,s)=>{if("weights"==r.LogicMode&&e.weight!=s.weight)return s.weight-e.weight;if(!u.hasOwnProperty(e.id)||!u.hasOwnProperty(s.id)||0==t.length)return 0;let n=u[e.id],i=u[s.id];for(let e of t)if(n.hasOwnProperty(e.field)&&i.hasOwnProperty(e.field)){let t=n[e.field],r=i[e.field],s=0;if(t!==r&&(dt(t)&&dt(r)?s=gt(t)-gt(r):t<r?s=-1:t>r&&(s=1)),"DESC"===e.dir&&(s*=-1),0!=s)return s}return 0})),e}function dt(e){var t=e.toString().replace(/[$,]/g,"");return!isNaN(t)&&!isNaN(parseFloat(t))}function gt(e){return parseFloat(e.toString().replace(/[$,]/g,""))}function ot(e,r,s,n,i,o,a,l,_,g,u){var m,d,h,c,O="";if(t("calcResultsPRQAddProductWeights: "+s+", "+i+", "+o),0==i.trim().length||i.indexOf("PRQ:")>=0||0==o.trim().length||!f.isNumeric(o)||0===parseFloat(o))t("suppressInvalidProductIdOrWeight_productWeightsByPage: "+i.toString());else if(m=tt(i,"PRQ:Available"),g&&"false"==m.toString().toLowerCase().trim())t("suppressOutOfStock_productWeightsByPage: "+i.toString());else if(d=tt(i,"PRQ:Type")||"Product",u&&u.indexOf("http")>=0&&u.indexOf("&collections=")<0&&"collection"==d.toString().toLowerCase().trim()){for(t("calcResultsPRQAddProductWeights_collection: "+i),h=i.toString(),c=0;c<b.length;c++)if(b[c][p].toString()!==h){var y=b[c][p].toString(),w=tt(y,"PRQ:Type"),P=tt(y,"PRQ:CollectionIds");("Product"==w||"Variant"==w)&&P.length>0&&("|"+P+"|").indexOf("|"+h+"|")>=0?(t("calcResultsPRQAddProductWeights_collection: "+i+", HIT, rowProductId="+y+", rowProductType="+w+", rowProductCollectionIds="+P),e.hasOwnProperty(y)?e[y]+=parseFloat(o):e[y]=parseFloat(o),"button"==l&&"keyword"==_?(O="Answered Button "+s.split("utton")[1]+" ("+f.extractTextFromHTML(n,!0).trim()+") ==> "+o+" weight added to ID #"+y+" ("+w+" associated Collection #"+h+" matched keyword: "+a+")",r.page_answers.push(O),t("calcResultsPRQ: "+O),t("calcResultsPRQ: found CollectionId #"+h+" in "+w+"Id #"+y)):"button"==l&&"single"==_?(O="Answered Button "+s.split("utton")[1]+" ("+f.extractTextFromHTML(n,!0).trim()+") ==> "+o+" weight added to ID #"+y+" ("+w+" associated Collection #"+h+")",r.page_answers.push(O),t("calcResultsPRQ: "+O),t("calcResultsPRQ: found CollectionId #"+h+" in "+w+"Id #"+y)):"custom"==l&&"keyword"==_?(O="Answered Custom Field "+s.split("ustom")[1].replace("_","")+" ("+f.extractTextFromHTML(n,!0).trim()+") ==> "+o+" weight added to ID #"+y+" ("+w+" associated Collection #"+h+" matched keyword: "+a+")",r.page_answers.push(O),t("calcResultsPRQ: "+O),t("calcResultsPRQ: found CollectionId #"+h+" in "+w+"Id #"+y)):"custom"==l&&"single"==_?(O="Answered Custom Field "+s.split("ustom")[1].replace("_","")+" ("+f.extractTextFromHTML(n,!0).trim()+") ==> "+o+" weight added to ID #"+y+" ("+w+" associated Collection #"+h+")",r.page_answers.push(O),t("calcResultsPRQ: "+O),t("calcResultsPRQ: found CollectionId #"+h+" in "+w+"Id #"+y)):t("calcResultsPRQAddProductWeights_collection: did not match on eleType or weightMatchType for rowProductId="+y)):("Product"==w||"Variant"==w)&&t("calcResultsPRQAddProductWeights_collection: "+i+", MISS, rowProductId="+y+", rowProductType="+w+", rowProductCollectionIds="+P)}}else e.hasOwnProperty(i)?e[i]+=parseFloat(o):e[i]=parseFloat(o),"button"==l&&"keyword"==_?(O="Answered Button "+s.split("utton")[1]+" ("+f.extractTextFromHTML(n,!0).trim()+") ==> "+o+" weight added to ID #"+i+" ("+d+" matched keyword: "+a+")",r.page_answers.push(O),t("calcResultsPRQ: "+O)):"button"==l&&"single"==_?(O="Answered Button "+s.split("utton")[1]+" ("+f.extractTextFromHTML(n,!0).trim()+") ==> "+o+" weight added to ID #"+i+" ("+d+")",r.page_answers.push(O),t("calcResultsPRQ: "+O)):"custom"==l&&"keyword"==_?(O="Answered Custom Field "+s.split("ustom")[1].replace("_","")+" ("+f.extractTextFromHTML(n,!0).trim()+") ==> "+o+" weight added to ID #"+i+" ("+d+" matched keyword: "+a+")",r.page_answers.push(O),t("calcResultsPRQ: "+O)):"custom"==l&&"single"==_?(O="Answered Custom Field "+s.split("ustom")[1].replace("_","")+" ("+f.extractTextFromHTML(n,!0).trim()+") ==> "+o+" weight added to ID #"+i+" ("+d+")",r.page_answers.push(O),t("calcResultsPRQ: "+O)):t("calcResultsPRQAddProductWeights_product: did not match on eleType or weightMatchType"+i)}function wi(t){try{top.location.href="string"==typeof t&&t.indexOf("http")>=0?t:ni()}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"redirectToQuizResults")}}function ni(){var n,a,l,_,g,p,u,m;try{if(!(n=r.ResultsPageUrlFull))return t("ResultsPageUrlFull is empty"),"";var d={},h=lt(),f=ii();for(h.length<f&&(f=h.length),n=(n=(n=n.replace("[USER_ID]",o.getAccountId())).replace("[BOX_ID]",i.getId())).replace("[CACHE_BREAKER]",o.getCacheBreaker()),a="products","Digioh_Results_Page"==r.ResultsPageType&&"Shopify"==r.StoreType?0==r.ShopifyProductsType.indexOf("VARIANTS")&&(a="variants"):n.indexOf("&variants=")>0?a="variants":n.indexOf("&collections=")>0&&(a="collections"),l=0,u=0;u<f&&!(h.length<=u);u++)if(_="",h[u].hasOwnProperty("id")&&h[u].id&&(_=h[u].id),g="products",h[u].hasOwnProperty("type")&&h[u].type&&(g=h[u].type.toString().toLowerCase().trim()+"s"),p=!0,h[u].hasOwnProperty("available")&&"false"==h[u].available.toString().toLowerCase().trim()&&(p=!1),!r.HideOutOfStock||p)if(a===g){if(d["id_"+ ++l]=h[u].hasOwnProperty("id")&&h[u].id?h[u].id:"",d["handle_"+l]=h[u].hasOwnProperty("handle")&&h[u].handle?h[u].handle:"",d["sku_"+l]=h[u].hasOwnProperty("sku")&&h[u].sku?h[u].sku:"",h[u].hasOwnProperty("type")&&h[u].type?(d["product_id_"+l]=("Product"==h[u].type||"Variant"==h[u].type)&&h[u].hasOwnProperty("productid")&&h[u].productid?h[u].productid:"",d["variant_id_"+l]="Variant"==h[u].type&&h[u].hasOwnProperty("id")&&h[u].id?h[u].id:""):(d["product_id_"+l]="",d["variant_id_"+l]=""),l>=f)break}else t("getQuizResultsURL: result "+u+" is of type "+g+", but we need only "+a+", skipping..");else t("getQuizResultsURL: product "+_+" is Out of Stock, skipping result "+u);t("getQuizResultsURL (obj):"),t(d);var O=[],y=[],b=[],w=[],P=[];for(u=1;u<=f;u++)d.hasOwnProperty("handle_"+u)&&d["handle_"+u]&&O.push(d["handle_"+u]),d.hasOwnProperty("variant_id_"+u)&&d["variant_id_"+u]&&y.push(d["variant_id_"+u]),d.hasOwnProperty("id_"+u)&&d["id_"+u]&&b.push(d["id_"+u]),d.hasOwnProperty("product_id_"+u)&&d["product_id_"+u]&&w.push(d["product_id_"+u]),d.hasOwnProperty("sku_"+u)&&d["sku_"+u]&&P.push(d["sku_"+u]);return n=(n=(n=(n=(n=n.replace("[HANDLES]",O.join(","))).replace("[IDS]",b.join(","))).replace("[PRODUCT_IDS]",w.join(","))).replace("[VARIANT_IDS]",y.join(","))).replace("[SKUS]",P.join(",")),top.location.href.indexOf("?")>0&&((m=top.location.href.split("?")[1]).length>0&&m.length<1500&&(n=n+"&"+m)),n=c(n,!0),n+="&type="+(new Date).getTime(),t("getQuizResultsURL (w/domain/path): "+n),n}catch(t){return e.tryShowError(t)&&(t.message="DIGIOH_ERROR: module_digioh_.js -- "+t.message,console.error(t)),s(t,"getQuizResultsURL"),r.ResultsPageUrlFull}}function ti(n){var t,i;if(o.suppressBreakpoints=!0,t="",t=n||DIGIOH_PRQ.getQuizResultsURL(),localStorage.setItem("digioh_local_quiz_results",LBOX.LZString.compressToBase64(t)),settings.hasOwnProperty("thxlayout")&&loadExternalFonts("thx",!0),settings.hasOwnProperty("extra_pages")&&settings.extra_pages)for(i=1;i<=settings.extra_pages.length;i++)settings.extra_pages[i-1]&&1==settings.extra_pages[i-1].on&&settings.hasOwnProperty("ep"+i+"layout")&&loadExternalFonts("ep"+i,!0);/^localhost:/.test(window.parent.location.host)?t=t.replace("hosted.lightboxcdn.com","localhost:7074"):/^account-dev\.digioh\.com$/.test(window.parent.location.host)?t=t.replace("hosted.lightboxcdn.com","hosted-dev.lightboxcdn.com"):/^account\.digioh\.com$/.test(window.parent.location.host)||/^hosted\.digioh\.com$/.test(window.parent.location.host)||!/^.*\.digioh\.com$/.test(window.parent.location.host)?(/^digioh-managed-store\.myshopify\.com$/.test(window.parent.location.host)||window.parent.location.href.indexOf("digioh_beta")>0)&&(t=t.replace("hosted.lightboxcdn.com","hosted-beta.lightboxcdn.com")):t=t.replace("hosted.lightboxcdn.com","hosted-beta.lightboxcdn.com"),t=t.replace("/Quiz/ShopifyResults","/Quiz/Results");var f=t.replace(/^(https?:\/\/[^\/]+).*$/,"$1")+"/js/digioh_module_quiz_results.js?cb="+o.getCacheBreaker(),r="",u="",e=$.ajax({url:f,crossDomain:!0,dataType:"text"}).done((function(e){r=e})),s=$.ajax({url:t,crossDomain:!0,beforeSend:function(e){e.setRequestHeader("X-Requested-With","XmlHttpRequest")}}).done((function(e){u=e}));$.when(e,s).done((function(){$("body").html(u),eval(r)})),setInterval(bi,200)}function bi(){var e=LBOX.JQUERY_DIGIOH("iframe.box-"+i.getId()).parent().height(),t=$("#results_page_content").height();(t>e||t<e&&e-t>100)&&(LBOX.JQUERY_DIGIOH("iframe.box-"+i.getId()).parent().css({height:t+"px","max-height":t+"px","min-height":t+"px"}),LBOX.JQUERY_DIGIOH("iframe.box-"+i.getId()).css({height:t+"px","max-height":t+"px","min-height":t+"px"}))}function ki(){var n,a,l,_,g;try{if(n=localStorage.getItem("prq_results"),a=localStorage.getItem("digioh_local_quiz_results")||o.UTIL.getUrlParam("digioh_local_quiz_results"),"Digioh_Results_Page"==r.ResultsPageType){if(a&&a.length>10&&((l=LBOX.LZString.decompressFromBase64(a))&&0==l.indexOf("http"))){if((l=(l=l.replace("[USER_ID]",o.getAccountId())).replace("[BOX_ID]",i.getId())).indexOf("[CACHE_BREAKER]")>0)l=l.replace("[CACHE_BREAKER]",o.getCacheBreaker());else{for(_=l.split("&"),g=0;g<_.length;g++)0==_[g].indexOf("cb=")&&(_[g]="cb="+o.getCacheBreaker());l=_.join("&")}("Shopify"!==r.StoreType||"Shopify"==r.StoreType&&0==r.ShopifyProductsType.indexOf("VARIANTS")&&l.indexOf("&variants=")>0||"Shopify"==r.StoreType&&r.ShopifyProductsType.indexOf("VARIANTS")<0&&l.indexOf("&variants=")<0)&&(t("tryShowPreservedResultsPage - digioh_local_quiz_results: "+l),ti(l))}}else n&&((n=JSON.parse(n))&&n.hasOwnProperty("page")&&n.hasOwnProperty("answers")&&d(n.page)&&settings.hasOwnProperty(n.page+"layout")&&settings[n.page+"layout"].hasOwnProperty("prq_preserve_results_page")&&settings[n.page+"layout"].prq_preserve_results_page&&(ei(JSON.parse(JSON.stringify(n.answers))),n.hasOwnProperty("pageview_sequence")&&oi(JSON.parse(JSON.stringify(n.pageview_sequence))),i.showPage(n.page)))}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"tryShowPreservedResultsPage")}}function tt(t,r){try{if(u.hasOwnProperty(t)&&u[t].hasOwnProperty(r.toLowerCase().replace("prq:","")))return u[t][r.toLowerCase().replace("prq:","")]}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"getCellValueByProductId")}return""}function di(t,r,n){var i,o;try{if(!t)return!0;if("equals"==t)return""===r||r==n;if("equals_any"==t){for((o=r.split("|")).length<2&&(o=r.split(",")),i=0;i<o.length;i++)if(o[i]==n)return!0;return!1}if("not_equals"==t)return r!=n;if("not_equals_any"==t){for((o=r.split("|")).length<2&&(o=r.split(",")),i=0;i<o.length;i++)if(o[i]==n)return!1;return!0}if("contains"==t)return""===r||n.indexOf(r)>=0;if("contains_any"==t){for((o=r.split("|")).length<2&&(o=r.split(",")),i=0;i<o.length;i++)if(n.indexOf(o[i])>=0)return!0;return!1}if("not_contains"==t)return n.indexOf(r)<0;if("not_contains_any"==t){for((o=r.split("|")).length<2&&(o=r.split(",")),i=0;i<o.length;i++)if(n.indexOf(o[i])>=0)return!1;return!0}if("starts_with"==t)return n.startsWith(r);if("starts_with_any"==t){for((o=r.split("|")).length<2&&(o=r.split(",")),i=0;i<o.length;i++)if(n.startsWith(o[i]))return!0;return!1}if("not_starts_with"==t)return!n.startsWith(r);if("not_starts_with_any"==t){for((o=r.split("|")).length<2&&(o=r.split(",")),i=0;i<o.length;i++)if(n.startsWith(o[i]))return!1;return!0}if("ends_with"==t)return n.endsWith(r);if("ends_with_any"==t){for((o=r.split("|")).length<2&&(o=r.split(",")),i=0;i<o.length;i++)if(n.endsWith(o[i]))return!0;return!1}if("not_ends_with"==t)return!n.endsWith(r);if("not_ends_with_any"==t){for((o=r.split("|")).length<2&&(o=r.split(",")),i=0;i<o.length;i++)if(n.endsWith(o[i]))return!1;return!0}if("greater_than"==t)return parseFloat(n)>parseFloat(r);if("less_than"==t)return parseFloat(n)<parseFloat(r);if("in_range"==t&&(o=[],r.indexOf("-")>0?o=r.split("-"):r.indexOf(",")>0&&(o=r.split(",")),o[0].trim().length>0&&o[1].trim().length>0))return parseFloat(n)>=parseFloat(o[0].trim())&&parseFloat(n)<=parseFloat(o[1].trim())}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"checkCustomFieldConditionsPRQ")}return!1}function st(t,r){var n,i;try{if(w.hasOwnProperty("results")&&w.results.length>=r&&r>0){var o=w.results[r-1].id,a=0,l=0,_=0,p=!1;for(n=0;n<g.length;n++)g[n]==t&&(l=n,p=!0),"prq:id"==g[n].toLowerCase()&&(a=n);if(!p)return"";for(i=1;i<b.length;i++)if(b[i][a]==o){_=i;break}return _<1?"":b[_][l]}}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"getResultCellValuePRQ")}return""}function gi(r){var n,o,a,l,_,g,p;try{if(r=v.getPlainPref(r),it()&&d(r))for(t("buildTextPRQ("+r+")"),i.mergeTagOriginalsPRQ=i.mergeTagOriginalsPRQ||{buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}},n=1;n<=50;n++)if(settings.hasOwnProperty(r+"text"+n)&&settings[r+"text"+n].display&&(a=(o=settings[r+"text"+n]).text,i.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[r+"text"+n]=i.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[r+"text"+n]||{},o.hasOwnProperty("prq_is_results_text")&&o.prq_is_results_text&&o.prq_results_text&&o.prq_results_text.startsWith("PRQ:")?(l=o.prq_results_text,_=o.prq_results_rank?parseInt(o.prq_results_rank):1,t("buildTextPRQ("+r+") x="+n+", rowRank="+_+", headerName="+l+", results.length="+w.results.length),a=st(l,_),$("#"+r+"text"+n).text(a)):a.indexOf("[PRQ:")>=0&&(a=c(a),$("#"+r+"text"+n).text(a)),o.hasOwnProperty("metadata_kvps")&&o.metadata_kvps&&o.metadata_kvps.length>0&&JSON.stringify(o.metadata_kvps).indexOf("[PRQ:")>0))for(i.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[r+"text"+n].metadata_kvps=JSON.parse(JSON.stringify(o.metadata_kvps)),g=0;g<o.metadata_kvps.length;g++)p=!1,o.metadata_kvps[g].k.indexOf("[PRQ:")>=0&&(o.metadata_kvps[g].k=c(o.metadata_kvps[g].k),p=!0),o.metadata_kvps[g].v.indexOf("[PRQ:")>=0&&(o.metadata_kvps[g].v=c(o.metadata_kvps[g].v),p=!0),p&&f.trySetAttribute(r+"text"+n,o.metadata_kvps[g],ut)}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"buildTextPRQ")}}function nr(r){var n,o,a,l,_,g,p;try{if(r=v.getPlainPref(r),it()&&d(r))for(t("buildImagePRQ("+r+")"),i.mergeTagOriginalsPRQ=i.mergeTagOriginalsPRQ||{buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}},n=1;n<=50;n++)if(settings.hasOwnProperty(r+"image"+n)&&settings[r+"image"+n].display&&(a=(o=settings[r+"image"+n]).src,i.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[r+"image"+n]=i.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[r+"image"+n]||{},o.hasOwnProperty("prq_is_results_image")&&o.prq_is_results_image&&o.prq_results_src&&o.prq_results_src.startsWith("PRQ:")&&(a=st(l=o.prq_results_src,_=o.prq_results_rank?parseInt(o.prq_results_rank):1),t("buildImagePRQ("+r+") x="+n+", rowRank="+_+", headerName="+l+", result="+a),a&&a.startsWith("http")&&$("#"+r+"image"+n).attr("src",a)),o.hasOwnProperty("metadata_kvps")&&o.metadata_kvps&&o.metadata_kvps.length>0&&JSON.stringify(o.metadata_kvps).indexOf("[PRQ:")>0))for(i.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[r+"image"+n].metadata_kvps=JSON.parse(JSON.stringify(o.metadata_kvps)),g=0;g<o.metadata_kvps.length;g++)p=!1,o.metadata_kvps[g].k.indexOf("[PRQ:")>=0&&(o.metadata_kvps[g].k=c(o.metadata_kvps[g].k),p=!0),o.metadata_kvps[g].v.indexOf("[PRQ:")>=0&&(o.metadata_kvps[g].v=c(o.metadata_kvps[g].v),p=!0),p&&f.trySetAttribute(r+"image"+n,o.metadata_kvps[g],ut)}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"buildImagePRQ")}}function tr(r){var n,o,a,l,_;try{if(r=v.getPlainPref(r),it()&&d(r))for(t("buildHTMLPRQ("+r+")"),i.mergeTagOriginalsPRQ=i.mergeTagOriginalsPRQ||{buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}},n=1;n<=50;n++)if(settings.hasOwnProperty(r+"html"+n)&&settings[r+"html"+n].display&&(a=(o=settings[r+"html"+n]).html,i.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[r+"html"+n]=i.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[r+"html"+n]||{},o.hasOwnProperty("prq_is_results_html")&&o.prq_is_results_html&&a.indexOf("[PRQ:")>=0&&(i.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[r+"html"+n].html=a,a=c(a),$("#"+r+"html"+n).html(a)),o.hasOwnProperty("metadata_kvps")&&o.metadata_kvps&&o.metadata_kvps.length>0&&JSON.stringify(o.metadata_kvps).indexOf("[PRQ:")>0))for(i.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[r+"html"+n].metadata_kvps=JSON.parse(JSON.stringify(o.metadata_kvps)),l=0;l<o.metadata_kvps.length;l++)_=!1,o.metadata_kvps[l].k.indexOf("[PRQ:")>=0&&(o.metadata_kvps[l].k=c(o.metadata_kvps[l].k),_=!0),o.metadata_kvps[l].v.indexOf("[PRQ:")>=0&&(o.metadata_kvps[l].v=c(o.metadata_kvps[l].v),_=!0),_&&f.trySetAttribute(r+"html"+n,o.metadata_kvps[l],ut)}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"buildHTMLPRQ")}}function ir(r){var n,o,a,l,_,g,p;try{if(r=v.getPlainPref(r),it()&&d(r))for(t("buildButtonPRQ("+r+")"),i.mergeTagOriginalsPRQ=i.mergeTagOriginalsPRQ||{buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}},n=1;n<=50;n++)if(settings.hasOwnProperty(r+"button"+n)&&settings[r+"button"+n].display&&(o=settings[r+"button"+n],i.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[r+"button"+n]=i.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[r+"button"+n]||{},o.hasOwnProperty("prq_is_results_button")&&o.prq_is_results_button&&((a=o.text).indexOf("[PRQ:")>=0&&(i.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[r+"button"+n].text=a,a=c(a),$("#"+r+"button"+n).html(a)),(l=o.url).indexOf("[PRQ:")>=0&&(i.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[r+"button"+n].url=l,l=c(l),settings[r+"button"+n].url=l),(_=o.selected_value).indexOf("[PRQ:")>=0&&(i.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[r+"button"+n].selected_value=_,_=c(_),settings[r+"button"+n].selected_value=_)),o.hasOwnProperty("metadata_kvps")&&o.metadata_kvps&&o.metadata_kvps.length>0&&JSON.stringify(o.metadata_kvps).indexOf("[PRQ:")>0))for(i.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[r+"button"+n].metadata_kvps=JSON.parse(JSON.stringify(o.metadata_kvps)),g=0;g<o.metadata_kvps.length;g++)p=!1,o.metadata_kvps[g].k.indexOf("[PRQ:")>=0&&(o.metadata_kvps[g].k=c(o.metadata_kvps[g].k),p=!0),o.metadata_kvps[g].v.indexOf("[PRQ:")>=0&&(o.metadata_kvps[g].v=c(o.metadata_kvps[g].v),p=!0),p&&f.trySetAttribute(r+"button"+n,o.metadata_kvps[g],ut)}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"buildButtonPRQ")}}function rr(r){try{if(r=v.getPlainPref(r),it()&&d(r)&&(r=v.getUnfriendlyPagePrefix(r),t("buildFormPRQ("+r+")"),i.mergeTagOriginalsPRQ=i.mergeTagOriginalsPRQ||{buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}},settings.hasOwnProperty(r+"form")&&settings[r+"form"].display)){var n=settings[r+"form"];n.hasOwnProperty("redirect_url")&&n.redirect_url&&n.redirect_url.indexOf("[PRQ:")>=0&&(i.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[r+"form"]=i.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[r+"form"]||{},i.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[r+"form"].redirect_url=n.redirect_url,n.redirect_url=c(n.redirect_url))}}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"buildFormPRQ")}}function d(e){return e=v.getPlainPref(e),nt&&k&&settings.hasOwnProperty(e+"layout")&&settings[e+"layout"].hasOwnProperty("prq_is_results_page")&&settings[e+"layout"].prq_is_results_page}function it(){return nt&&k&&g.length>0&&b.length>1}function ur(){return k}function c(t,r){try{void 0===r&&(r=!1);const e=function(e,t){return"null"==e||"undefined"==e?"":!0===t?encodeURIComponent(e||""):e||""};let s=(t=(t=(t=(t=(t=(t=t.replace(/\[EMAIL\]/gi,e(o.getDataLayerValue("email"),r))).replace(/\[PHONE\]/gi,e(o.getDataLayerValue("phone"),r))).replace(/\[NAME\]/gi,e(o.getDataLayerValue("name"),r))).replace(/\[FIRST_NAME\]/gi,e(o.getDataLayerValue("first_name"),r))).replace(/\[LAST_NAME\]/gi,e(o.getDataLayerValue("last_name"),r))).replace(/\[OPT_IN\]/gi,e(o.getDataLayerValue("opt_in"),r))).matchAll(/\[CUSTOM_?(\d\d?)\]/gi);for(let n of s)t=t.replace(n[0],e(o.getDataLayerValue("custom_"+n[1]),r));let i=t.matchAll(/\[EP?(\d\d?)\_CUSTOM_?(\d\d?)\]/gi);for(let s of i)t=t.replace(s[0],e(o.getDataLayerValue("ep"+s[1]+"_custom_"+s[2]),r));let a=t.matchAll(/\[PRQ:([\w\s-]+):(\d\d?)\]/gi);for(let e of a){var n=st("PRQ:"+e[1],parseInt(e[2]));t=!0===r?t.replace(e[0],encodeURIComponent(n)):t.replace(e[0],n)}}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"replaceMergeTagsPRQ")}return t}function lt(){return w.results}function fr(e){w.results=e}function er(){var e=ii(),t=JSON.parse(JSON.stringify(w));return t.results.length>e&&(t.results.length=e),{prq:t}}function ii(){return r.MaxResults||fi}function ri(t,r){try{const e=t?t.toString():i.getId().toString(),s=o.getDataLayer(e)||{};for(const e in s){let t=s[e];if("string"==typeof t&&r.test(t))return!0}}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"isValInDataLayer")}return!1}function or(e){return ri(e,/\w+@\w+\.\w+/)}function sr(e){return ri(e,/^(\+\d{1,2}\s)?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}$/)}function rt(e,r){"function"==typeof i.trackEvent?(t("Event: "+e+JSON.stringify(r)),i.trackEvent(e,r)):(t("Tracking enabled but no tracking plugin installed, queueing"),i.trackEventQueue=i.trackEventQueue||[],i.trackEventQueue.push({eventName:e,propsObj:r}))}function ui(r){try{if(!k)return;const e=/^ep(\d\d?)$/;let s=i.getPageTitle(r);s||(!r||r.indexOf("main")>=0?s="p0":e.test(r)?s="p"+r.match(e)[1].replace("_",""):r.indexOf("extra_page_")>=0?s="p"+r.replace("extra_page_",""):r.indexOf("thx")>=0||r.indexOf("thank")>=0?s="thx":(s="unknown",rt("digioh_quiz_error",{error_msg:msg,error_context:"Don't know how to log page "+r})));const o={};o.digioh_box_page=s,o.digioh_quiz_question=s,rt("digioh_quiz_funnel",o);let a=null;var n=v.getPlainPref(r);if(""==n)a="start",i.startTimestamp=(new Date).getTime();else if(d(n)&&(a="result",i.startTimestamp)){let e=(new Date).getTime()-i.startTimestamp,t=Math.floor(e/1e3);o.digioh_quiz_secs_to_complete=t}if(t("trackPrqPage_isResultsPagePRQ("+n+") = "+d(n)+", conversionAction="+a),a){const e=JSON.parse(JSON.stringify(o));delete e.digioh_quiz_question,delete e.digioh_quiz_secs_to_complete,e.digioh_quiz_conversion_action=a,"result"==a&&(e.digioh_collected_email=or(),e.digioh_collected_phone=sr()),rt("digioh_quiz_conversion",e)}}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"trackPrqPage")}}function hr(t){try{if(!k)return;t||(t=CURRENT_PAGE);const e={},r=i.getPageTitle(t),s=v.getPlainPref(t),n=ht().filter((e=>e.page==s))[0];if(!n)return;et[s]=et[s]||{},e.digioh_box_page=r,e.digioh_quiz_question=e.digioh_box_page;for(const t of n.entries){if("custom"==t.type){if(n.entries.filter((e=>e!==t&&e.src==t.src&&"button"==e.type)).length)continue}const r=t.value;r.length>0&&!et[s][r]&&(et[s][r]=!0,e.digioh_quiz_answer=r.indexOf("<")>=0&&r.indexOf(">")>=0?f.extractTextFromHTML(r,!0):r,rt("digioh_quiz_answer",e))}}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"gaAnswer")}}function cr(){var r,n,i,o;try{if(!k)return;let e={};for(r=lt(),n=0;n<r.length;n++){if(n>=yt){t("Truncating track log to "+yt+" events to avoid suppression");break}i="",(o=r[n]).hasOwnProperty("id")&&(i+="("+o.id+") "),o.hasOwnProperty("name")?i+=o.name:o.hasOwnProperty("product")?i+=o.product:o.hasOwnProperty("sku")&&(i+=o.sku),e["digioh_quiz_result_"+(n+1)]=i}rt("digioh_quiz_result",e)}catch(t){e.tryShowError(t)&&(t.message="DIGIOH_ERROR: lightbox_builder.js -- "+t.message,console.error(t)),s(t,"gaResult")}}function lr(){return!1===y&&t("getOutcome: Outcome has not been set, Outcomes logic has not yet run."),y}var nt;const fi=10,o=n.DAPI||{},a=n.WINDOW_JQUERY_DIGIOH,ut=n.BOX_JQUERY_DIGIOH,f=n.UTIL,v=n.DUTIL,e=n.DLOG,i=n.boxapi,ft=n.getEffectsProp,ar=n.existsEffectsProp,ht=n.getPageAnswers,ei=n.setPageAnswers,oi=n.setPageViewSequence,s=n.boxLogError;nt=o.LIGHTBOX.USE_PRQ;const t=function(e){o.log(e,"DIGIOH_PRQ")};var w={answers:[],results:[]},h={},u={},g=[],b=[],p=0,at=!1,et={},k=!1,vt="",l="",y=!1,r={};const yt=10;return{USE:nt,HasResultsLoaded:!1,loadProductData:ci,isBoxPRQ:ur,calcResultsPRQ:pi,calcOutcomesPRQ:wt,isOutcomesLogicMode:ct,getOutcome:lr,getQuizResultsURL:ni,displayQuizLocalResultsPage:ti,redirectToQuizResults:wi,getResultCellValuePRQ:st,replaceMergeTagsPRQ:c,buildTextPRQ:gi,buildImagePRQ:nr,buildHTMLPRQ:tr,buildButtonPRQ:ir,buildFormPRQ:rr,isResultsPagePRQ:d,getResults:lt,setResults:fr,getSubmissionData:er,tryShowPreservedResultsPage:ki,trackPrqPage:ui,trackPrqAnswer:hr,trackPrqResult:cr,init:si}}window.jQuery=function(e){return LBOX.JQUERY_DIGIOH(e,document)},jQuery=LBOX.JQUERY_DIGIOH.extend(jQuery,LBOX.JQUERY_DIGIOH),window.$=window.jQuery,$=jQuery,String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Date.prototype.addDays=function(e){var t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t
/*@preserve [#######CUSTOM_JS_APPS_BOX_EMBED#######] */
/*@preserve [#######CUSTOM_JS_BOX_EMBED#######] */},BOX_CUSTOM_JS={runCustomJsBeforeDOMReady:function(){try{return runCustomJsSnippetsSync("runCustomJsBeforeDOMReady","Before DOM Ready",getCustomJsGuidsToRun("Before DOM Ready",{}),{},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeDOMReady"),!0}},runCustomJsAfterDOMReady:function(){try{clearFormData();runCustomJsSnippetsSync("runCustomJsAfterDOMReady","After DOM Ready",getCustomJsGuidsToRun("After DOM Ready",{}),{},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsAfterDOMReady"),!0}},runCustomJsBeforeDisplay:function(){try{return runCustomJsSnippetsSync("runCustomJsBeforeDisplay","Before Display",getCustomJsGuidsToRun("Before Display",{}),{},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeDisplay"),!0}},runCustomJsAfterDisplay:function(){try{clearFormData();runCustomJsSnippetsSync("runCustomJsAfterDisplay","After Display",getCustomJsGuidsToRun("After Display",{}),{},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsAfterDisplay"),!0}},runCustomJsBeforeFormValidation:function(e){try{return runCustomJsSnippetsSync("runCustomJsBeforeFormValidation","Before Form Validation",getCustomJsGuidsToRun("Before Form Validation",e),e,"boolean,string,object")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeFormValidation"),!0}},runCustomJsAfterFormValidation:function(e){try{return runCustomJsSnippetsSync("runCustomJsAfterFormValidation","After Form Validation",getCustomJsGuidsToRun("After Form Validation",e),e,"boolean,string,object")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsAfterFormValidation"),!0}},runCustomJsBeforeSubmit:function(e){try{return runCustomJsSnippetsSync("runCustomJsBeforeSubmit","Before Submit",getCustomJsGuidsToRun("Before Submit",e),e,"boolean,string,object")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeSubmit"),!0}},runCustomJsAfterSubmit:function(e){try{return runCustomJsSnippetsSync("runCustomJsAfterSubmit","After Submit",getCustomJsGuidsToRun("After Submit",e),e,"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsAfterSubmit"),!0}},runCustomJsBeforeRedirect:function(e,t){try{return runCustomJsSnippetsSync("runCustomJsBeforeRedirect","Before Redirect",getCustomJsGuidsToRun("Before Redirect",{element:e,trigger:t}),{element:e,trigger:t},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeRedirect"),!0}},runCustomJsAfterRedirect:function(e,t){try{return runCustomJsSnippetsSync("runCustomJsAfterRedirect","After Redirect",getCustomJsGuidsToRun("After Redirect",{element:e,trigger:t}),{element:e,trigger:t},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsAfterRedirect")}},runCustomJsBeforeDownload:function(e,t,r){try{return runCustomJsSnippetsSync("runCustomJsBeforeDownload","Before Download",getCustomJsGuidsToRun("Before Download",{page:e,name:t,element:r}),{page:e,name:t,element:r},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeDownload"),!0}},runCustomJsAfterDownload:function(e,t,r){try{return runCustomJsSnippetsSync("runCustomJsAfterDownload","After Download",getCustomJsGuidsToRun("After Download",{page:e,name:t,element:r}),{page:e,name:t,element:r},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsAfterDownload")}},runCustomJsBeforeOpenAnotherBox:function(e,t){try{return runCustomJsSnippetsSync("runCustomJsBeforeOpenAnotherBox","Before Open Another Box",getCustomJsGuidsToRun("Before Open Another Box",{target_lightbox_guid:e,trigger:t}),{target_lightbox_guid:e,trigger:t},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeOpenAnotherBox"),!0}},runCustomJsAfterOpenAnotherBox:function(e,t){try{return runCustomJsSnippetsSync("runCustomJsAfterOpenAnotherBox","After Open Another Box",getCustomJsGuidsToRun("After Open Another Box",{target_lightbox_guid:e,trigger:t}),{target_lightbox_guid:e,trigger:t},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsAfterOpenAnotherBox")}},runCustomJsBeforeChangePages:function(e,t,r,s,n){try{return clearFormData(),runCustomJsSnippetsSync("runCustomJsBeforeChangePages","Before Change Pages",getCustomJsGuidsToRun("Before Change Pages",{old_page:e,new_page:t,name:r,element:s,trigger:n}),{old_page:e,new_page:t,name:r,element:s,trigger:n},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeChangePages"),!0}},runCustomJsAfterChangePages:function(e,t,r,s,n){try{return runCustomJsSnippetsSync("runCustomJsAfterChangePages","After Change Pages",getCustomJsGuidsToRun("After Change Pages",{old_page:e,new_page:t,name:r,element:s,trigger:n}),{old_page:e,new_page:t,name:r,element:s,trigger:n},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsAfterChangePages")}},runCustomJsBeforeClose:function(){try{runCustomJsSnippetsSync("runCustomJsBeforeClose","Before Close",getCustomJsGuidsToRun("Before Close",{}),{},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeClose")}},runCustomJsAfterClose:function(){try{runCustomJsSnippetsSync("runCustomJsAfterClose","After Close",getCustomJsGuidsToRun("After Close",{}),{},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsAfterClose")}},log:function(e){try{DAPI.log(e,"CUSTOM_JS_BOXES (BoxID="+boxapi.getId()+")")}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e))}},logError:function(e,t){try{DAPI.log(e.message,"CUSTOM_JS_BOXES."+t+" (BoxID="+boxapi.getId()+")"),DLOG.logErrorFromBox(e,t)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e))}}},"undefined"!=typeof module&&void 0!==module.exports&&(module.exports={createDigiohPrqModule:createDigiohPrqModule});const DIGIOH_PRQ=createDigiohPrqModule({DAPI:DAPI,UTIL:UTIL,DUTIL:DUTIL,DLOG:DLOG,WINDOW_JQUERY_DIGIOH:LBOX.JQUERY_DIGIOH,BOX_JQUERY_DIGIOH:$,boxapi:boxapi,getEffectsProp:getEffectsProp,existsEffectsProp:existsEffectsProp,getPageAnswers:getPageAnswers,setPageAnswers:setPageAnswers,setPageViewSequence:setPageViewSequence,boxLogError:BOX_CUSTOM_JS.logError});function addSdkBoxapiModule(e,t){function r(e){e.preventDefault()}const s=t.DAPI||{},n=t.DUTIL||{},i=t.BOX_CUSTOM_JS||{},o=t.STANDARD_OBJ||{},a=t.DIGIOH_PRQ||{},l=function(e){return function(){throw new Error("Dependency function "+e+" not implemented")}},_=t.getCurrentPage||l("getCurrentPage"),g=t.changePages||l("changePages"),p=t.getSettings||l("getSettings"),u=t.processSubmitObj||l("processSubmitObj"),m=t.showLoading||l("showLoading"),d=t.hideLoading||l("hideLoading"),h=t.showError||l("showError"),c=t.showSuccess||l("showSuccess"),f=t.showWarning||l("showWarning"),O=t.showInlineError||l("showInlineError"),y=t.resetBox||l("resetBox"),b=t.resetPage||l("resetPage"),w=function(e,t){(function(e){try{return(void 0===e||null==e)&&(e={}),s.tryShowError()}catch(e){console.log("ERROR_LOG",e)}})(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),i.logError(e,"boxapi."+t)};return e.getName=function(){return o.lightbox_name},e.getId=function(){return o.lightbox_short_id},e.isVariation=function(){return o.is_variation},e.getVariationId=function(){return o.variation_short_id},e.getVariationGuid=function(){return o.variation_guid},e.getVariationName=function(){return o.variation_name},e.getBoxType=function(){return s.getBoxType(o.lightbox_or_variation_id)},e.getBoxFrameWrapper=function(){try{return s.LIGHTBOX.JQUERY_DIGIOH("#"+s.LIGHTBOX.getLightboxDomId(e.getGuid()))}catch(e){return w(e,"getBoxFrameWrapper"),null}},e.getBoxJQuery=function(){return $},e.getAccountMetadata=function(e){return s.getAccountMetadata(e)},e.getWidgetMetadata=function(t){return s.getWidgetMetadata(e.getId().toString(),t)},e.getPageMetadata=function(e,t){try{const s=p();if(e||(e=_()),"main"===e&&(e=""),e=n.getPlainPref(e),s.hasOwnProperty(e+"layout")&&s[e+"layout"].hasOwnProperty("metadata_kvps")){if("string"!=typeof t||!t)return s[e+"layout"].metadata_kvps;for(var r=0;r<s[e+"layout"].metadata_kvps.length;r++)if(s[e+"layout"].metadata_kvps[r].k===t)return s[e+"layout"].metadata_kvps[r].v}}catch(e){w(e,"getPageMetadata")}return null},e.getFieldMetadata=function(e,t,r){try{const i=p();if(e||(e=_()),"main"===e&&(e=""),!t)return null;if(e=n.getUnfriendlyPagePrefix(e),t.indexOf("custom")>=0&&t.indexOf("_")>=0&&(t=t.split("_").join("")),i.hasOwnProperty(e+t)&&i[e+t].hasOwnProperty("metadata_kvps")){if("string"!=typeof r||!r)return i[e+t].metadata_kvps;for(var s=0;s<i[e+t].metadata_kvps.length;s++)if(i[e+t].metadata_kvps[s].k===r)return i[e+t].metadata_kvps[s].v}}catch(e){w(e,"getFieldMetadata")}return null},e.getElementMetadata=function(e,t,r){try{p();if(e||(e=_()),"main"===e&&(e=""),!t)return null;if(settings.hasOwnProperty(e+t)&&settings[e+t].hasOwnProperty("metadata_kvps")){if("string"!=typeof r||!r)return settings[e+t].metadata_kvps;for(var s=0;s<settings[e+t].metadata_kvps.length;s++)if(settings[e+t].metadata_kvps[s].k===r)return settings[e+t].metadata_kvps[s].v}}catch(e){w(e,"getElementMetadata")}return null},e.showPage=function(e){try{_()!==e&&g(e,"",{},"api")}catch(e){w(e,"showPage")}},e.changePages=e.showPage,e.changePage=e.showPage,e.showMainPage=function(){e.showPage("main")},e.showThankYouPage=function(){e.showPage("thx")},e.showExtraPage=function(t){e.showPage("ep"+t)},e.isMainPage=function(){return"main"===_()||""===_()},e.isThankYouPage=function(){return"thx"===_()||"thx_"===_()},e.isExtraPage=function(e){return _()==="ep"+e||_()==="ep"+e+"_"},e.getPageName=function(){return(_()||"main").replace("_","")},e.getPageTitle=function(e){try{const r=p();var t=n.getPlainPref(e);if(r.hasOwnProperty(t+"layout")&&r[t+"layout"].hasOwnProperty("page_name")&&r[t+"layout"].page_name)return r[t+"layout"].page_name;if(""==t)return"Main Page";if("thx"==t)return"Thank You Page";if(t.indexOf("ep")>=0)return"Extra Page "+t.replace("ep","")}catch(e){w(e,"getPageTitle")}return""},e.getPageJQuery=function(){try{return $("#"+("main"==_()?"":_())+"layout")}catch(e){w(e,"getPageJQuery")}return null},e.processSubmit=function(e){try{("object"!=typeof e||null===e)&&(e={}),u(e)}catch(e){w(e,"processSubmit")}},e.getFormData=function(){return s.getFormData(o.lightbox_short_id)},e.setFormData=function(e){try{if(!e)return;s.LIGHTBOX.hasOwnProperty("SINGLE_PAGE_FORM_DATA")&&s.LIGHTBOX.SINGLE_PAGE_FORM_DATA||(s.LIGHTBOX.SINGLE_PAGE_FORM_DATA={}),s.LIGHTBOX.SINGLE_PAGE_FORM_DATA[o.lightbox_short_id.toString()]=JSON.parse(JSON.stringify(e))}catch(e){w(e,"setFormData")}},e.showLoading=function(){m(CURRENT_PAGE)},e.hideLoading=function(){d()},e.showError=function(e){h(e)},e.showSuccess=function(e){c(e)},e.showWarning=function(e){f(e)},e.showInlineError=function(e,t,r){var s=_();r&&r.hasOwnProperty("pageName")&&(s=r.pageName),O(s,t,e)},e.addBoxIntegration=function(e){s.addBoxIntegration(o.lightbox_or_variation_id,e)},e.removeBoxIntegration=function(e){s.removeBoxIntegration(o.lightbox_or_variation_id,e)},e.resetBoxIntegrations=function(){s.resetBoxIntegrations(o.lightbox_or_variation_id)},e.trackManualRedirect=function(){s.LIGHTBOX.registerAnalyticsManualRedirect(o.lightbox_or_variation_id)},e.setFormFieldValue=function(e,t,r){var s,i,o;try{const a=p();s=_(),r&&"object"==typeof r&&r.hasOwnProperty("pageName")&&(s=r.pageName),s=n.getUnfriendlyPagePrefix(s),e.indexOf("custom")>=0&&e.indexOf("_")>=0&&(e=e.split("_").join("")),"name"===e?($("#"+s+"form_input_first_and_last_name_wrapper").length&&(t.indexOf(" ")>0?(i=t.split(" ")[0],$("#"+s+"form_input_first_name").val(i),$("#"+s+"form_input_last_name").val(t.substr(i.length).trim())):$("#"+s+"form_input_first_name").val(t)),$("#"+s+"form_input_full_name_wrapper").length&&$("#"+s+"form_input_full_name").val(t),$("#"+s+"form_input_first_name_wrapper").length&&$("#"+s+"form_input_first_name").val(t)):"opt_in"===e?document.getElementById(s+"form_input_opt_in").checked=!0===t||"1"===t||1===t||"on"===t||"yes"===t||"checked"===t||"selected"===t:"checkbox"===a[s+e].field_type&&$("#"+s+"form_input_"+e+"_checkbox_wrapper").length?document.getElementById(s+"form_input_"+e).checked=t!=a[s+e].checkbox.uncheckedval&&(t==a[s+e].checkbox.checkedval||!0===t||"1"===t||1===t||"on"===t||"yes"===t||"checked"===t||"selected"===t):"radio"===a[s+e].field_type&&$("#"+s+"form_input_"+e+"_radio_wrapper").length?$('input[name="'+s+"form_input_"+e+'"]').length&&$('input[name="'+s+"form_input_"+e+'"]').each((function(){$(this).attr("value")===t&&$(this).prop("checked",!0)})):"datedrop"===a[s+e].field_type&&$("#"+s+"form_input_"+e+"_datedrop_mm").length?3===(o=t.split("/")).length&&($("#"+s+"form_input_"+e+"_datedrop_mm").val(o[0]),$("#"+s+"form_input_"+e+"_datedrop_dd").val(o[1]),$("#"+s+"form_input_"+e+"_datedrop_yyyy").val(o[2])):$("#"+s+"form_input_"+e).length&&$("#"+s+"form_input_"+e).val(t)}catch(e){w(e,"setFormFieldValue")}},e.getFormFieldValue=function(e,t){try{const s=p();var r=_();if(t&&"object"==typeof t&&t.hasOwnProperty("pageName")&&(r=t.pageName),r=n.getUnfriendlyPagePrefix(r),e.indexOf("custom")>=0&&e.indexOf("_")>=0&&(e=e.split("_").join("")),"name"===e){if($("#"+r+"form_input_first_and_last_name_wrapper").length)return($("#"+r+"form_input_first_name").val()+" "+$("#"+r+"form_input_last_name").val()).trim();if($("#"+r+"form_input_full_name_wrapper").length)return $("#"+r+"form_input_full_name").val();if($("#"+r+"form_input_first_name_wrapper").length)return $("#"+r+"form_input_first_name").val()}else{if("opt_in"===e)return document.getElementById(r+"form_input_opt_in").checked?"1":"0";if("checkbox"===s[r+e].field_type&&$("#"+r+"form_input_"+e+"_checkbox_wrapper").length)return document.getElementById(r+"form_input_"+e).checked?s[r+e].checkbox.checkedval:s[r+e].checkbox.uncheckedval;if("radio"===s[r+e].field_type&&$("#"+r+"form_input_"+e+"_radio_wrapper").length)return $('input[name="'+r+"form_input_"+e+'"]:checked').length?$('input[name="'+r+"form_input_"+e+'"]:checked').val():"";if("datedrop"===s[r+e].field_type&&$("#"+r+"form_input_"+e+"_datedrop_mm").length)return $("#"+r+"form_input_"+e+"_datedrop_mm").val()+"/"+$("#"+r+"form_input_"+e+"_datedrop_dd").val()+"/"+$("#"+r+"form_input_"+e+"_datedrop_yyyy").val();if($("#"+r+"form_input_"+e).length)return $("#"+r+"form_input_"+e).val()}}catch(e){w(e,"getFormFieldValue")}return""},e.addDropdownOption=function(e,t,r,s){try{var i=_();s&&"object"==typeof s&&s.hasOwnProperty("pageName")&&(i=s.pageName),i=n.getUnfriendlyPagePrefix(i),e.indexOf("custom")>=0&&e.indexOf("_")>=0&&(e=e.split("_").join("")),$("#"+i+"form_input_"+e).length&&$("#"+i+"form_input_"+e).is("select")&&$("#"+i+"form_input_"+e).append(new Option(r,t))}catch(e){w(e,"addDropdownOption")}},e.removeDropdownOption=function(e,t,r){try{var s=_();r&&"object"==typeof r&&r.hasOwnProperty("pageName")&&(s=r.pageName),s=n.getUnfriendlyPagePrefix(s),e.indexOf("custom")>=0&&e.indexOf("_")>=0&&(e=e.split("_").join("")),$("#"+s+"form_input_"+e).length&&$("#"+s+"form_input_"+e).is("select")&&$("#"+s+"form_input_"+e+" option[value='"+t+"']").each((function(){$(this).remove()}))}catch(e){w(e,"removeDropdownOption")}},e.removeAllDropdownOptions=function(e,t){try{var r=_();t&&"object"==typeof t&&t.hasOwnProperty("pageName")&&(r=t.pageName),r=n.getUnfriendlyPagePrefix(r),e.indexOf("custom")>=0&&e.indexOf("_")>=0&&(e=e.split("_").join("")),$("#"+r+"form_input_"+e).length&&$("#"+r+"form_input_"+e).is("select")&&$("#"+r+"form_input_"+e+" option").each((function(){$(this).remove()}))}catch(e){w(e,"removeAllDropdownOptions")}},e.hideFormField=function(e,t){try{const s=p();var r=_();t&&"object"==typeof t&&t.hasOwnProperty("pageName")&&(r=t.pageName),r=n.getUnfriendlyPagePrefix(r),e.indexOf("custom")>=0&&e.indexOf("_")>=0&&(e=e.split("_").join("")),"name"===e||e.indexOf("_name")>0?($("#"+r+"form_input_first_and_last_name_wrapper").length&&$("#"+r+"form_input_first_and_last_name_wrapper").hide(),$("#"+r+"form_input_full_name_wrapper").length&&$("#"+r+"form_input_full_name_wrapper").hide(),$("#"+r+"form_input_first_name_wrapper").length&&$("#"+r+"form_input_first_name_wrapper").hide()):"checkbox"===s[r+e].field_type&&$("#"+r+"form_input_"+e+"_checkbox_wrapper").length?$("#"+r+"form_input_"+e+"_checkbox_wrapper").hide():"radio"===s[r+e].field_type&&$("#"+r+"form_input_"+e+"_radio_wrapper").length?$("#"+r+"form_input_"+e+"_radio_wrapper").hide():$("#"+r+"form_input_"+e+"_wrapper").length&&$("#"+r+"form_input_"+e+"_wrapper").hide(),$("#"+r+"form_label_"+e).length&&$("#"+r+"form_label_"+e).hide(),s[r+e].require&&(s[r+e].require=!1)}catch(e){w(e,"hideFormField")}},e.showFormField=function(e,t){try{const s=p();var r=_();t&&"object"==typeof t&&t.hasOwnProperty("pageName")&&(r=t.pageName),r=n.getUnfriendlyPagePrefix(r),e.indexOf("custom")>=0&&e.indexOf("_")>=0&&(e=e.split("_").join("")),"name"===e||e.indexOf("_name")>0?($("#"+r+"form_input_first_and_last_name_wrapper").length&&$("#"+r+"form_input_first_and_last_name_wrapper").show(),$("#"+r+"form_input_full_name_wrapper").length&&$("#"+r+"form_input_full_name_wrapper").show(),$("#"+r+"form_input_first_name_wrapper").length&&$("#"+r+"form_input_first_name_wrapper").show()):"checkbox"===s[r+e].field_type&&$("#"+r+"form_input_"+e+"_checkbox_wrapper").length?$("#"+r+"form_input_"+e+"_checkbox_wrapper").show():"radio"===s[r+e].field_type&&$("#"+r+"form_input_"+e+"_radio_wrapper").length?$("#"+r+"form_input_"+e+"_radio_wrapper").show():$("#"+r+"form_input_"+e+"_wrapper").length&&$("#"+r+"form_input_"+e+"_wrapper").show(),$("#"+r+"form_label_"+e).length&&$("#"+r+"form_label_"+e).show()}catch(e){w(e,"showFormField")}},e.closeBox=function(){s.closeBox(o.lightbox_or_variation_id)},e.hideElement=function(e,t){try{if(t||(t=_()),"main"===t&&(t=""),!e)return;$("#"+t+e).hide()}catch(e){w(e,"hideElement")}},e.showElement=function(e,t){try{if(t||(t=_()),"main"===t&&(t=""),!e)return;$("#"+t+e).show()}catch(e){w(e,"showElement")}},e.reloadWebPage=function(e){var t=0;e&&"object"==typeof e&&e.hasOwnProperty("delayMsecs")&&(t=e.delayMsecs),t>0?setTimeout((function(){parent.location.reload()}),t):parent.location.reload()},e.disableScroll=function(){s.isMobile()?parent.document.addEventListener("touchmove",r,{passive:!1}):parent.document.addEventListener("scroll",r,{passive:!1})},e.enableScroll=function(){s.isMobile()?parent.document.removeEventListener("touchmove",r,{passive:!1}):parent.document.removeEventListener("scroll",r,{passive:!1})},e.resetBox=function(){y()},e.resetPage=function(e){b(e)},e.getQuizResults=function(){return a.getResults()},e.setQuizResults=function(e){return a.setResults(e)},e.isQuizResultsPage=function(e){return a.isResultsPagePRQ(e)},e.isPreview=function(){return s.isPreview()},e.getGuid=function(){return o.lightbox_guid},e.isQaMode=function(){return 1==parent.sessionStorage.getItem("xdibx_boxqamode")||s.getQueryString().indexOf("boxqamode")>-1},e.warnNotify=function(){},e.errorNotify=function(){},e.successNotify=function(){},e.infoNotify=function(){},e.warnNotifyApp=function(){},e.errorNotifyApp=function(){},e.successNotifyApp=function(){},e.infoNotifyApp=function(){},e.initAppNotifications=function(){return notifier={infoNotifyApp:e.infoNotifyApp,warnNotify:e.warnNotify,errorNotify:e.errorNotify,successNotify:e.successNotify,infoNotify:e.infoNotify,warnNotifyApp:e.warnNotifyApp,errorNotifyApp:e.errorNotifyApp,successNotifyApp:e.successNotifyApp}},e}"undefined"!=typeof module&&void 0!==module.exports&&(module.exports={addSdkBoxapiModule:addSdkBoxapiModule}),addSdkBoxapiModule(boxapi,{DAPI:DAPI,DUTIL:DUTIL,BOX_CUSTOM_JS:BOX_CUSTOM_JS,STANDARD_OBJ:STANDARD_OBJ,DIGIOH_PRQ:DIGIOH_PRQ,getCurrentPage:getCurrentPage,changePages:changePages,getSettings:getSettings,processSubmitObj:processSubmitObj,showLoading:showLoading,hideLoading:hideLoading,showError:showError,showSuccess:showSuccess,showWarning:showWarning,showInlineError:showInlineError,resetBox:resetBox,resetPage:resetPage}),loadUserScript("custom_box.js",DAPI.CONFIG.CACHE_VALUES.custom_box).then(checkJqLoaded);